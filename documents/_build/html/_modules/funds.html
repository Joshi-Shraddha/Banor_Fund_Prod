<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>funds &mdash; Banor Documents 1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Banor Documents
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../python_script_rst/modules.html">Funds</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Banor Documents</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Module code</a> &raquo;</li>
      <li>funds</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for funds</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Main script to call fund L/S type</span>
<span class="sd">@author: Shraddha Joshi</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<span class="kn">from</span> <span class="nn">DatafromBBG</span> <span class="kn">import</span> <span class="n">findbyBBGws01</span>
<span class="kn">from</span> <span class="nn">configuration</span> <span class="kn">import</span> <span class="n">database_dev</span><span class="p">,</span> <span class="n">get_current_date</span><span class="p">,</span> <span class="n">get_current_time</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">bbgdatafromdb</span> <span class="kn">import</span> <span class="n">get_bbg_records</span>
<span class="kn">from</span> <span class="nn">email_send_service</span> <span class="kn">import</span> <span class="n">sendemail</span><span class="p">,</span> <span class="n">Email_Send_ErrorAlarm</span><span class="p">,</span> <span class="n">Email_Send_Advisory</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">jsonify</span>


<div class="viewcode-block" id="logg_Handler"><a class="viewcode-back" href="../python_script_rst/funds.html#funds.logg_Handler">[docs]</a><span class="k">def</span> <span class="nf">logg_Handler</span><span class="p">(</span><span class="n">fund</span><span class="p">,</span> <span class="n">logger_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    This is log handler function used to create logger object.</span>

<span class="sd">    :param fund:  Fund No</span>
<span class="sd">    :param logger_name:  logger name</span>

<span class="sd">    :return: logger_sqlalchemy object.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;logg_Handler&quot;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">fundapi</span> <span class="kn">import</span> <span class="n">DatabaseHandler</span>
    <span class="c1"># logger_sqlalchemy = logging.getLogger(__name__)</span>
    <span class="n">logger_sqlalchemy</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">logger_name</span><span class="p">)</span>
    <span class="n">logger_sqlalchemy</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">logger_sqlalchemy</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
    <span class="n">logger_sqlalchemy</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">DatabaseHandler</span><span class="p">(</span><span class="n">fund</span><span class="p">,</span> <span class="n">logger_sqlalchemy</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">logger_sqlalchemy</span></div>


<div class="viewcode-block" id="Hex_To_Decimal"><a class="viewcode-back" href="../python_script_rst/funds.html#funds.Hex_To_Decimal">[docs]</a><span class="k">def</span> <span class="nf">Hex_To_Decimal</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param string: input para.</span>
<span class="sd">    :return:  convert Hex to decimal</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="s1">&#39;string to convert HEX to Decimal&#39;</span><span class="p">)</span>
    <span class="n">IntakeValue</span> <span class="o">=</span> <span class="n">string</span>
    <span class="c1"># IntakeValue = Index(string,&quot;E&quot;,startIndex:0,searchFromEnd:False,ignoreCase:True)</span>
    <span class="k">if</span> <span class="n">IntakeValue</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Decimal</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">IntakeValue</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Decimal</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">Decimal</span></div>


<div class="viewcode-block" id="Http_Server_wst01"><a class="viewcode-back" href="../python_script_rst/funds.html#funds.Http_Server_wst01">[docs]</a><span class="k">def</span> <span class="nf">Http_Server_wst01</span><span class="p">(</span><span class="n">TickerISIN</span><span class="p">,</span> <span class="n">fund</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetch data from bbg workstation. If workstation down fetching records from database.</span>

<span class="sd">    :param TickerISIN: TickerISIN (User input Ticker)</span>
<span class="sd">    :param fund: fund No (Fund Number to get fund)</span>

<span class="sd">    :return: return records into dict.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Http_Server_wst01&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">TickerISIN</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">TickerISIN</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span> <span class="ow">or</span> <span class="n">TickerISIN</span> <span class="o">==</span> <span class="s2">&quot;  &quot;</span>
            <span class="ow">or</span> <span class="n">TickerISIN</span> <span class="o">==</span> <span class="s2">&quot; Equity&quot;</span> <span class="ow">or</span> <span class="n">TickerISIN</span> <span class="o">==</span> <span class="s2">&quot; Corp&quot;</span> <span class="ow">or</span>
            <span class="n">TickerISIN</span> <span class="o">==</span> <span class="s2">&quot; Index&quot;</span> <span class="ow">or</span> <span class="n">TickerISIN</span> <span class="o">==</span> <span class="s2">&quot; Govt&quot;</span> <span class="ow">or</span>
            <span class="n">TickerISIN</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot; Govt CORP&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">or</span>
            <span class="n">TickerISIN</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot; Equity CORP&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">or</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">TickerISIN</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">findbyBBGws01</span><span class="p">(</span><span class="n">TickerISIN</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">get_bbg_records</span><span class="p">(</span><span class="n">TickerISIN</span><span class="p">,</span> <span class="n">fund</span><span class="p">)</span>
    <span class="n">value_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">values</span> <span class="o">!=</span> <span class="s1">&#39;BBG Workstation Down&#39;</span><span class="p">:</span>
        <span class="n">Error</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">39</span><span class="p">]</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">Error</span>
        <span class="n">SecurityName</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">Name</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">Short_Name</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">34</span><span class="p">]</span>
        <span class="n">Crncy</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">Country</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span>
        <span class="n">Id_Isin</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">Market_sector_des</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">35</span><span class="p">]</span>
        <span class="n">Security_typ</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">Ticker_And_Exch_Code</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">44</span><span class="p">]</span>
        <span class="n">Country_Iso</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span>
        <span class="n">Country_Full_Name</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">Issuer_Industry</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span>
        <span class="n">Parent_Ticker_Exchange</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">25</span><span class="p">]</span>
        <span class="n">Chg_Pct_Ytd</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">26</span><span class="p">]</span>
        <span class="n">Px_Last</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">TickerIsinUpperCase</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">45</span><span class="p">]</span>
        <span class="n">Eqy_Prim_Exch_Shrt</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">31</span><span class="p">]</span>
        <span class="n">Settle_Date</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
        <span class="n">Opt_Cont_Size</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span>
        <span class="n">Fut_Cont_Size</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
        <span class="n">MaturityDate</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">46</span><span class="p">]</span>
        <span class="n">StartTime</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">47</span><span class="p">]</span>
        <span class="n">EndTime</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">48</span><span class="p">]</span>
        <span class="n">lot_size</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">50</span><span class="p">]</span>
        <span class="n">UnderlayPrcie</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Hex_To_Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">49</span><span class="p">]))</span>
        <span class="n">Id_bb_Ultimate_Parent_Co</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
        <span class="n">Id_bb_Ultimate_Parent_Co_Name</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">33</span><span class="p">]</span>
        <span class="n">Eqy_sh_out</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span>
        <span class="n">Amt_Outstanding</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Hex_To_Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">17</span><span class="p">]))</span>
        <span class="n">Volume_avg_20d</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span>
        <span class="n">Cntry_of_Risk</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
        <span class="n">Payment_Rank</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">40</span><span class="p">]</span>
        <span class="n">Capital_Contingent_Security</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span>
        <span class="n">Registered_Country_Location</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span>
        <span class="n">Country_of_largest_Revenue</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span>
        <span class="n">Underlying_Isin</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span>
        <span class="n">Opt_strike_Px</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Hex_To_Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">39</span><span class="p">]))</span>
        <span class="n">Maturity_Date_Estimated</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">51</span><span class="p">]</span>
        <span class="n">Next_Call_Dt</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">52</span><span class="p">]</span>
        <span class="n">Delta</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Hex_To_Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">9</span><span class="p">]))</span>
        <span class="n">Opt_Put_Call</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Hex_To_Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">38</span><span class="p">]))</span>
        <span class="n">Error</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">43</span><span class="p">]</span>
        <span class="n">Industry_Group</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">33</span><span class="p">]</span>
        <span class="n">Industry_Sector</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
        <span class="n">Volume_avg_30D</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">42</span><span class="p">]</span>
        <span class="n">Cur_Mkt_Cap</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">24</span><span class="p">]</span>
        <span class="n">Volatility_30d</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">41</span><span class="p">]</span>
        <span class="n">Eqy_Beta</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">30</span><span class="p">]</span>
        <span class="n">Eqy_Alpha</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">29</span><span class="p">]</span>
        <span class="n">Cpn</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">27</span><span class="p">]</span>
        <span class="n">Int_Acc</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Hex_To_Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">28</span><span class="p">]))</span>

        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">err</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;SecurityName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SecurityName</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Name</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Short_Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Short_Name</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Crncy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Crncy</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Country&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Country</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Id_Isin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Id_Isin</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Market_sector_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Market_sector_des</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Security_typ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Security_typ</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Ticker_And_Exch_Code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ticker_And_Exch_Code</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Country_Iso&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Country_Iso</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Country_Full_Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Country_Full_Name</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Issuer_Industry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Issuer_Industry</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Parent_Ticker_Exchange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Parent_Ticker_Exchange</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Chg_Pct_Ytd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Chg_Pct_Ytd</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Px_Last&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Px_Last</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;TickerIsinUpperCase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TickerIsinUpperCase</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Eqy_Prim_Exch_Shrt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Eqy_Prim_Exch_Shrt</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Settle_Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Settle_Date</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Opt_Cont_Size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Opt_Cont_Size</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Fut_Cont_Size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Fut_Cont_Size</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;MaturityDate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MaturityDate</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;StartTime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">StartTime</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;EndTime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">EndTime</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;lot_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lot_size</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;UnderlayPrcie&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">UnderlayPrcie</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Id_bb_Ultimate_Parent_Co&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Id_bb_Ultimate_Parent_Co</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Id_bb_Ultimate_Parent_Co_Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Id_bb_Ultimate_Parent_Co_Name</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Eqy_sh_out&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Eqy_sh_out</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Amt_Outstanding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Amt_Outstanding</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Volume_avg_20d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Volume_avg_20d</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Cntry_of_Risk&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Cntry_of_Risk</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Payment_Rank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Payment_Rank</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Capital_Contingent_Security&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Capital_Contingent_Security</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Registered_Country_Location&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Registered_Country_Location</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Country_of_largest_Revenue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Country_of_largest_Revenue</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Underlying_Isin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Underlying_Isin</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Opt_strike_Px&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Opt_strike_Px</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Maturity_Date_Estimated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Maturity_Date_Estimated</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Next_Call_Dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Next_Call_Dt</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Delta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Delta</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Opt_Put_Call&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Opt_Put_Call</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Error</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Industry_Group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Industry_Group</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Industry_Sector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Industry_Sector</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Volume_avg_30D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Volume_avg_30D</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Cur_Mkt_Cap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Cur_Mkt_Cap</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Volatility_30d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Volatility_30d</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Eqy_Beta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Eqy_Beta</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Eqy_Alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Eqy_Alpha</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Cpn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Cpn</span>
        <span class="n">value_dict</span><span class="p">[</span><span class="s1">&#39;Int_Acc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Int_Acc</span>
    <span class="k">return</span> <span class="n">value_dict</span></div>


<div class="viewcode-block" id="col1_col2_with_auto_correction"><a class="viewcode-back" href="../python_script_rst/funds.html#funds.col1_col2_with_auto_correction">[docs]</a><span class="k">def</span> <span class="nf">col1_col2_with_auto_correction</span><span class="p">(</span><span class="n">Ticker</span><span class="p">,</span> <span class="n">FundNumber</span><span class="p">,</span> <span class="n">Col_1_Ready</span><span class="p">,</span> <span class="n">CurrencyIN</span><span class="p">,</span> <span class="n">ForcingInstrumentTypecol1</span><span class="p">,</span> <span class="n">FundName</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function assign col_1 and col_2 in case that they are in the portfolios.</span>

<span class="sd">    :param Ticker:  TickerISIN</span>
<span class="sd">    :param FundNumber:  FundNumber</span>
<span class="sd">    :param Col_1_Ready:  InstrumentType_1stCol</span>
<span class="sd">    :param CurrencyIN:  bbgCrncy</span>
<span class="sd">    :param ForcingInstrumentTypecol1:  ForcingTtype</span>
<span class="sd">    :param FundName:  fund</span>

<span class="sd">    :return: col_1, col_2, CurrencyOUT</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fund</span> <span class="o">=</span> <span class="n">FundName</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;col1_col2_with_auto_correction&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">database_dev</span><span class="p">()</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">CurrDate</span> <span class="o">=</span> <span class="n">get_current_date</span><span class="p">()</span>
        <span class="n">CurrencyOUT</span><span class="p">,</span> <span class="n">col_1</span><span class="p">,</span> <span class="n">col_2</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ForcingInstrumentTypecol1</span><span class="p">:</span>
            <span class="n">col_1</span> <span class="o">=</span> <span class="n">Col_1_Ready</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s2">&quot;SELECT [ENNORTHAMERICALS].[ID] o0, [ENNORTHAMERICALS].[DATE] o1, [ENNORTHAMERICALS].[INSTRTYPE] o2, [ENNORTHAMERICALS].[SECURITYTYPE] o3, [ENNORTHAMERICALS].[QUANTITY] o4, [ENNORTHAMERICALS].[TICKER_ISIN] o5, [ENNORTHAMERICALS].[NAME] o6, [ENNORTHAMERICALS].[COST] o7, [ENNORTHAMERICALS].[WEIGHT_ACTUAL] o8, [ENNORTHAMERICALS].[WEIGHT_TARGET] o9, [ENNORTHAMERICALS].[PAIRTRADE] o10, [ENNORTHAMERICALS].[TRADINGINDEX] o11, [ENNORTHAMERICALS].[ORDERSTAGE] o12, [ENNORTHAMERICALS].[ORDERUPDATE] o13, [ENNORTHAMERICALS].[CURRENCY] o14, [ENNORTHAMERICALS].[DB_LASTPRICE] o15, [ENNORTHAMERICALS].[FX] o16, [ENNORTHAMERICALS].[FXDATETIME] o17, [ENNORTHAMERICALS].[FXTICKER] o18, [ENNORTHAMERICALS].[FUNDCURRENCY] o19, [ENNORTHAMERICALS].[COUNTERVALUELOCAL] o20, [ENNORTHAMERICALS].[COUNTERVALUEFUNDCRNCY] o21, [ENNORTHAMERICALS].[HIST_PX_LASTMONTH] o22, [ENNORTHAMERICALS].[HIST_DATE] o23, [ENNORTHAMERICALS].[BROKERCODE] o24, [ENNORTHAMERICALS].[BBG_PARENTCOID] o25&quot;</span>
                        <span class="s2">&quot; FROM [outsys_prod_qa].DBO.[OSUSR_38P_NORTHAMERICALS] [ENNORTHAMERICALS] &quot;</span>
                        <span class="s2">&quot;WHERE ([ENNORTHAMERICALS].[DATE] = (convert(datetime, substring(&#39;&quot;</span> <span class="o">+</span> <span class="n">CurrDate</span> <span class="o">+</span> <span class="s2">&quot;&#39;, 1, 10), 120))) AND ([ENNORTHAMERICALS].[TICKER_ISIN] = &#39;&quot;</span> <span class="o">+</span> <span class="n">Ticker</span> <span class="o">+</span> <span class="s2">&quot;&#39;) ORDER BY [ENNORTHAMERICALS].[NAME] ASC &quot;</span><span class="p">)</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
                <span class="n">GetNorthAmericaLsByTickerISIN</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">GetNorthAmericaLsByTickerISIN</span><span class="p">):</span>
                    <span class="n">NAGetRec</span> <span class="o">=</span> <span class="n">GetNorthAmericaLsByTickerISIN</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">col_1</span> <span class="o">=</span> <span class="n">NAGetRec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">col_2</span> <span class="o">=</span> <span class="n">NAGetRec</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;SELECT [ENGREATERCHINALS].[ID] o0, [ENGREATERCHINALS].[DATE] o1, [ENGREATERCHINALS].[INSTRTYPE] o2, [ENGREATERCHINALS].[SECURITYTYPE] o3, [ENGREATERCHINALS].[QUANTITY] o4, [ENGREATERCHINALS].[TICKER_ISIN] o5, [ENGREATERCHINALS].[NAME] o6, [ENGREATERCHINALS].[COST] o7, [ENGREATERCHINALS].[WEIGHT_ACTUAL] o8, [ENGREATERCHINALS].[WEIGHT_TARGET] o9, [ENGREATERCHINALS].[PAIRTRADE] o10, [ENGREATERCHINALS].[ORDERSTAGE] o11, [ENGREATERCHINALS].[ORDERUPDATE] o12, [ENGREATERCHINALS].[CURRENCY] o13, [ENGREATERCHINALS].[DB_LASTPRICE] o14, [ENGREATERCHINALS].[FX] o15, [ENGREATERCHINALS].[FXDATETIME] o16, [ENGREATERCHINALS].[FXTICKER] o17, [ENGREATERCHINALS].[FUNDCURRENCY] o18, [ENGREATERCHINALS].[COUNTERVALUELOCAL] o19, [ENGREATERCHINALS].[COUNTERVALUEFUNDCRNCY] o20, [ENGREATERCHINALS].[HIST_PX_LASTMONTH] o21, [ENGREATERCHINALS].[HIST_DATE] o22, [ENGREATERCHINALS].[BROKERCODE] o23, [ENGREATERCHINALS].[BBG_PARENTCOID] o24 &quot;</span>
                            <span class="s2">&quot;FROM [outsys_prod_qa].DBO.[OSUSR_38P_GREATERCHINALS] [ENGREATERCHINALS] WHERE ([ENGREATERCHINALS].[DATE] = (convert(datetime, substring(&#39;&quot;</span> <span class="o">+</span> <span class="n">CurrDate</span> <span class="o">+</span> <span class="s2">&quot;&#39;, 1, 10), 120))) AND ([ENGREATERCHINALS].[TICKER_ISIN] = &#39;&quot;</span> <span class="o">+</span> <span class="n">Ticker</span> <span class="o">+</span> <span class="s2">&quot;&#39;) ORDER BY [ENGREATERCHINALS].[NAME] ASC &quot;</span><span class="p">)</span>
                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
                    <span class="n">GetGreaterChinaLsByTickerISIN</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">GetGreaterChinaLsByTickerISIN</span><span class="p">):</span>
                        <span class="n">NAGetRec</span> <span class="o">=</span> <span class="n">GetGreaterChinaLsByTickerISIN</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">col_1</span> <span class="o">=</span> <span class="n">NAGetRec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                        <span class="n">col_2</span> <span class="o">=</span> <span class="n">NAGetRec</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="s2">&quot;SELECT [ENITALYLS].[ID] o0, [ENITALYLS].[DATE] o1, [ENITALYLS].[INSTRTYPE] o2, [ENITALYLS].[SECURITYTYPE] o3, [ENITALYLS].[QUANTITY] o4, [ENITALYLS].[TICKER_ISIN] o5, [ENITALYLS].[NAME] o6, [ENITALYLS].[COST] o7, [ENITALYLS].[WEIGHT_ACTUAL] o8, [ENITALYLS].[WEIGHT_TARGET] o9, [ENITALYLS].[PAIRTRADE] o10, [ENITALYLS].[ORDERSTAGE] o11, [ENITALYLS].[ORDERUPDATE] o12, [ENITALYLS].[CURRENCY] o13, [ENITALYLS].[DB_LASTPRICE] o14, [ENITALYLS].[FUNDCURRENCY] o15, [ENITALYLS].[FX] o16, [ENITALYLS].[FXDATETIME] o17, [ENITALYLS].[FXTICKER] o18, [ENITALYLS].[COUNTERVALUELOCAL] o19, [ENITALYLS].[COUNTERVALUEFUNDCRNCY] o20, [ENITALYLS].[HIST_PX_LASTMONTH] o21, [ENITALYLS].[HIST_DATE] o22, [ENITALYLS].[BROKERCODE] o23, [ENITALYLS].[BBG_PARENTCOID] o24 &quot;</span>
                                <span class="s2">&quot;FROM [outsys_prod_qa].DBO.[OSUSR_38P_ITALYLS] [ENITALYLS] WHERE ([ENITALYLS].[DATE] = (convert(datetime, substring(&#39;&quot;</span> <span class="o">+</span> <span class="n">CurrDate</span> <span class="o">+</span> <span class="s2">&quot;&#39;, 1, 10), 120))) AND ([ENITALYLS].[TICKER_ISIN] = &#39;&quot;</span> <span class="o">+</span> <span class="n">Ticker</span> <span class="o">+</span> <span class="s2">&quot;&#39;) ORDER BY [ENITALYLS].[NAME] ASC &quot;</span><span class="p">)</span>
                        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
                        <span class="n">GetItalyLsByDate</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">GetItalyLsByDate</span><span class="p">):</span>
                            <span class="n">NAGetRec</span> <span class="o">=</span> <span class="n">GetItalyLsByDate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">col_1</span> <span class="o">=</span> <span class="n">NAGetRec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                            <span class="n">col_2</span> <span class="o">=</span> <span class="n">NAGetRec</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="s2">&quot;SELECT [ENEUROPEANVALUE].[ID] o0, [ENEUROPEANVALUE].[DATE] o1, [ENEUROPEANVALUE].[INSTRTYPE] o2, [ENEUROPEANVALUE].[SECURITYTYPE] o3, [ENEUROPEANVALUE].[QUANTITY] o4, [ENEUROPEANVALUE].[TICKER_ISIN] o5, [ENEUROPEANVALUE].[NAME] o6, [ENEUROPEANVALUE].[COST] o7, [ENEUROPEANVALUE].[WEIGHT_ACTUAL] o8, [ENEUROPEANVALUE].[WEIGHT_TARGET] o9, [ENEUROPEANVALUE].[PAIRTRADE] o10, [ENEUROPEANVALUE].[ORDERSTAGE] o11, [ENEUROPEANVALUE].[ORDERUPDATE] o12, [ENEUROPEANVALUE].[CURRENCY] o13, [ENEUROPEANVALUE].[DB_LASTPRICE] o14, [ENEUROPEANVALUE].[FX] o15, [ENEUROPEANVALUE].[FXDATETIME] o16, [ENEUROPEANVALUE].[FXTICKER] o17, [ENEUROPEANVALUE].[FUNDCURRENCY] o18, [ENEUROPEANVALUE].[COUNTERVALUELOCAL] o19, [ENEUROPEANVALUE].[COUNTERVALUEFUNDCRNCY] o20, [ENEUROPEANVALUE].[HIST_PX_LASTMONTH] o21, [ENEUROPEANVALUE].[HIST_DATE] o22, [ENEUROPEANVALUE].[BBG_PARENTCOID] o23, [ENEUROPEANVALUE].[BROKERCODE] o24 &quot;</span>
                                <span class="s2">&quot;FROM [outsys_prod_qa].DBO.[OSUSR_38P_EUROPEANVALUE] [ENEUROPEANVALUE] WHERE ([ENEUROPEANVALUE].[DATE] = (convert(datetime, substring(&#39;&quot;</span> <span class="o">+</span> <span class="n">CurrDate</span> <span class="o">+</span> <span class="s2">&quot;&#39;, 1, 10), 120))) AND ([ENEUROPEANVALUE].[TICKER_ISIN] = &#39;&quot;</span> <span class="o">+</span> <span class="n">Ticker</span> <span class="o">+</span> <span class="s2">&quot;&#39;) ORDER BY [ENEUROPEANVALUE].[NAME] ASC &quot;</span><span class="p">)</span>
                        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
                        <span class="n">GetEuropeanValuesByTickerISIN</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">GetEuropeanValuesByTickerISIN</span><span class="p">):</span>
                            <span class="n">NAGetRec</span> <span class="o">=</span> <span class="n">GetEuropeanValuesByTickerISIN</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">col_1</span> <span class="o">=</span> <span class="n">NAGetRec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                            <span class="n">col_2</span> <span class="o">=</span> <span class="n">NAGetRec</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="s2">&quot;SELECT [ENEUROBOND].[ID] o0, [ENEUROBOND].[DATE] o1, [ENEUROBOND].[INSTRTYPE] o2, [ENEUROBOND].[SECURITYTYPE] o3, [ENEUROBOND].[QUANTITY] o4, [ENEUROBOND].[TICKER_ISIN] o5, [ENEUROBOND].[NAME] o6, [ENEUROBOND].[COST] o7, [ENEUROBOND].[WEIGHT_ACTUAL] o8, [ENEUROBOND].[WEIGHT_TARGET] o9, [ENEUROBOND].[PAIRTRADE] o10, [ENEUROBOND].[ORDERSTAGE] o11, [ENEUROBOND].[ORDERUPDATE] o12, [ENEUROBOND].[CURRENCY] o13, [ENEUROBOND].[DB_LASTPRICE] o14, [ENEUROBOND].[FX] o15, [ENEUROBOND].[FXDATETIME] o16, [ENEUROBOND].[FXTICKER] o17, [ENEUROBOND].[FUNDCURRENCY] o18, [ENEUROBOND].[COUNTERVALUELOCAL] o19, [ENEUROBOND].[COUNTERVALUEFUNDCRNCY] o20, [ENEUROBOND].[ENDMONTH_PX] o21, [ENEUROBOND].[HIST_PX_LASTMONTH] o22, [ENEUROBOND].[HIST_DATE] o23, [ENEUROBOND].[BBG_PARENTCOID] o24 &quot;</span>
                                    <span class="s2">&quot;FROM [outsys_prod_qa].DBO.[OSUSR_BOL_EUROBOND] [ENEUROBOND] WHERE ([ENEUROBOND].[DATE] = (convert(datetime, substring(&#39;&quot;</span> <span class="o">+</span> <span class="n">CurrDate</span> <span class="o">+</span> <span class="s2">&quot;&#39;, 1, 10), 120))) AND ([ENEUROBOND].[TICKER_ISIN] = &#39;&quot;</span> <span class="o">+</span> <span class="n">Ticker</span> <span class="o">+</span> <span class="s2">&quot;&#39;) ORDER BY [ENEUROBOND].[DATE] ASC &quot;</span><span class="p">)</span>
                            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
                            <span class="n">GetEuroBondByTickerISIN</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">GetEuroBondByTickerISIN</span><span class="p">):</span>
                                <span class="n">EUGetRec</span> <span class="o">=</span> <span class="n">GetEuroBondByTickerISIN</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                                <span class="k">if</span> <span class="n">EUGetRec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="n">Col_1_Ready</span><span class="p">:</span>
                                    <span class="k">pass</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">Feedback_Message8</span> <span class="o">=</span> <span class="s2">&quot;This suggestion has a different INSTRUMENT TYPE of the position &quot;</span> \
                                                        <span class="s2">&quot;that we hold in the portfolio, the INSTRUMENT &quot;</span> \
                                                        <span class="s2">&quot;TYPE that will be used is: &quot;</span> <span class="o">+</span> <span class="n">EUGetRec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
                                    <span class="k">return</span> <span class="n">Feedback_Message8</span>
                                <span class="n">col_1</span> <span class="o">=</span> <span class="n">EUGetRec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                                <span class="n">col_2</span> <span class="o">=</span> <span class="n">EUGetRec</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">col_1</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">col_1</span> <span class="o">=</span> <span class="n">Col_1_Ready</span>

        <span class="k">if</span> <span class="n">CurrencyIN</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;SELECT [ENEQUITY].[ID] o0, [ENEQUITY].[DATE] o1, [ENEQUITY].[TICKER] o2, [ENEQUITY].[NAME] o3, [ENEQUITY].[SECURITYNAME] o4, [ENEQUITY].[ID_ISIN] o5, [ENEQUITY].[CNTRYOFRISK] o6, [ENEQUITY].[CRNCY] o7, [ENEQUITY].[CUR_MKT_CAP] o8, [ENEQUITY].[DVDEXDT] o9, [ENEQUITY].[EQY_DVD_YLD_IND] o10, [ENEQUITY].[GICS_SUB_INDUSTRY_NAME] o11, [ENEQUITY].[INDUSTRY_SECTOR] o12, [ENEQUITY].[LAST_PRICE] o13, [ENEQUITY].[PRIMARY_EXCHANGE_NAME] o14, [ENEQUITY].[PE_RATIO] o15, [ENEQUITY].[PX_TO_BOOK_RATIO] o16, [ENEQUITY].[PX_TO_SALES_RATIO] o17, [ENEQUITY].[CIE_DES_BULK] o18, [ENEQUITY].[COMPANY_WEB_ADDRESS] o19, [ENEQUITY].[EQY_BETA] o20, [ENEQUITY].[VOLUME_AVG_10D] o21, [ENEQUITY].[VOLUME_AVG_20D] o22, [ENEQUITY].[VOLUME_AVG_30D] o23, [ENEQUITY].[VOLUME_AVG_3M] o24, [ENEQUITY].[VOLUME_AVG_6M] o25, [ENEQUITY].[VOLATILITY_30D] o26, [ENEQUITY].[VOLATILITY_60D] o27, [ENEQUITY].[VOLATILITY_90D] o28, [ENEQUITY].[CHG_PCT_5D] o29, [ENEQUITY].[CHG_PCT_1D] o30, [ENEQUITY].[MARKET_SECTOR_DES] o31, [ENEQUITY].[GICS_SECTOR_NAME] o32, [ENEQUITY].[SECURITY_TYP] o33, [ENEQUITY].[SETTLE_DT] o34, [ENEQUITY].[ID_BB_ULTIMATE_PARENT_CO] o35, [ENEQUITY].[HIST_PX_ENDMONTH] o36, [ENEQUITY].[EQY_SH_OUT] o37, [ENEQUITY].[CNTRY_OF_RISK] o38, [ENEQUITY].[REGISTERED_COUNTRY_LOCATION] o39, [ENEQUITY].[COUNTRY_OF_LARGEST_REVENUE] o40, [ENEQUITY].[INDUSTRY_GROUP] o41, [ENEQUITY].[EQY_ALPHA] o42, [ENEQUITY].[FUND_GEO_FOCUS] o43, [ENEQUITY].[FUND_ASSET_CLASS_FOCUS] o44 &quot;</span>
                    <span class="s2">&quot;FROM [outsys_prod_qa].DBO.[OSUSR_38P_EQUITY] [ENEQUITY] WHERE ([ENEQUITY].[TICKER] = &#39;&quot;</span> <span class="o">+</span> <span class="n">Ticker</span> <span class="o">+</span> <span class="s2">&quot;&#39;) ORDER BY [ENEQUITY].[DATE] DESC &quot;</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="n">GetEquitiesByTicker2</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">GetEquitiesByTicker2</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s2">&quot;SELECT [ENDERIVATIVE].[ID] o0, [ENDERIVATIVE].[DATE] o1, [ENDERIVATIVE].[TICKER] o2, [ENDERIVATIVE].[NAME] o3, [ENDERIVATIVE].[CNTRY_OF_RISK] o4, [ENDERIVATIVE].[CRNCY] o5, [ENDERIVATIVE].[OPT_STRIKE_PX] o6, [ENDERIVATIVE].[OPT_EXPIRE_DT] o7, [ENDERIVATIVE].[OPT_PUT_CALL] o8, [ENDERIVATIVE].[ID_ISIN] o9, [ENDERIVATIVE].[COUNTRY] o10, [ENDERIVATIVE].[LAST_PRICE] o11, [ENDERIVATIVE].[OPT_UNDL_TICKER] o12, [ENDERIVATIVE].[OPT_UNDL_PX] o13, [ENDERIVATIVE].[OPT_DELTA_MID] o14, [ENDERIVATIVE].[OPT_CONT_SIZE] o15, [ENDERIVATIVE].[FUT_CONT_SIZE] o16, [ENDERIVATIVE].[PRIMARY_EXCHANGE_NAME] o17, [ENDERIVATIVE].[VOLUME_AVG_3M] o18, [ENDERIVATIVE].[VOLATILITY_90D] o19, [ENDERIVATIVE].[FUT_GEN_ROLL_DT] o20, [ENDERIVATIVE].[OPT_THETA] o21, [ENDERIVATIVE].[VEGA] o22, [ENDERIVATIVE].[OPT_RHO] o23, [ENDERIVATIVE].[GAMMA] o24, [ENDERIVATIVE].[MARKET_SECTOR_DES] o25, [ENDERIVATIVE].[SECURITY_TYP] o26, [ENDERIVATIVE].[SETTLE_DT] o27, [ENDERIVATIVE].[VOLUME_AVG_10D] o28, [ENDERIVATIVE].[VOLUME_AVG_20D] o29, [ENDERIVATIVE].[ID_BB_ULTIMATE_PARENT_CO] o30, [ENDERIVATIVE].[ISSUER_INDUSTRY] o31, [ENDERIVATIVE].[REGISTERED_COUNTRY_LOCATION] o32, [ENDERIVATIVE].[COUNTRY_OF_LARGEST_REVENUE] o33, [ENDERIVATIVE].[UNDERLYING_ISIN] o34, [ENDERIVATIVE].[INDUSTRY_GROUP] o35, [ENDERIVATIVE].[INDUSTRY_SECTOR] o36, [ENDERIVATIVE].[VOLUME_AVG_30D] o37, [ENDERIVATIVE].[CUR_MKT_CAP] o38 &quot;</span>
                        <span class="s2">&quot;FROM [outsys_prod_qa].DBO.[OSUSR_BOL_DERIVATIVE] [ENDERIVATIVE] WHERE ([ENDERIVATIVE].[TICKER] = &#39;&quot;</span> <span class="o">+</span> <span class="n">Ticker</span> <span class="o">+</span> <span class="s2">&quot;&#39;) ORDER BY [ENDERIVATIVE].[DATE] DESC &quot;</span><span class="p">)</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
                <span class="n">GetDerivativesByTicker2</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">GetDerivativesByTicker2</span><span class="p">:</span>
                    <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;SELECT [ENBOND].[ID] o0, [ENBOND].[DATE] o1, [ENBOND].[TICKER] o2, [ENBOND].[NAME] o3, [ENBOND].[CNTRY_OF_RISK] o4, [ENBOND].[CRCNY] o5, [ENBOND].[SECURITY_DES] o6, [ENBOND].[MATURITY] o7, [ENBOND].[CPN_TYP] o8, [ENBOND].[GICS_SUB_INDUSTRY_NAME] o9, [ENBOND].[ID_ISIN] o10, [ENBOND].[INDUSTRY_SECTOR] o11, [ENBOND].[PX_MID] o12, [ENBOND].[BB_COMPOSITE] o13, [ENBOND].[IS_SUBORDINATED] o14, [ENBOND].[INDUSTRY_GROUP] o15, [ENBOND].[INT_ACC] o16, [ENBOND].[CIE_DES_BULK] o17, [ENBOND].[COMPANY_WEB_ADDRESS] o18, [ENBOND].[YAS_ASW_SPREAD] o19, [ENBOND].[YLS_YTM_MID] o20, [ENBOND].[DUR_MID] o21, [ENBOND].[CPN] o22, [ENBOND].[MARKET_ISSUE] o23, [ENBOND].[NXT_CPN_DT] o24, [ENBOND].[RTG_MOODY] o25, [ENBOND].[CHG_PCT_1D] o26, [ENBOND].[CHG_PCT_5D] o27, [ENBOND].[RTG_SP] o28, [ENBOND].[MIN_PIECE] o29, [ENBOND].[MIN_INCREMENT] o30, [ENBOND].[PAYMENT_RANK] o31, [ENBOND].[AMT_ISSUED] o32, [ENBOND].[MARKET_SECTOR_DES] o33, [ENBOND].[GICS_SECTOR_NAME] o34, [ENBOND].[SECURITY_TYP] o35, [ENBOND].[SETTLE_DT] o36, [ENBOND].[VOLUME_AVG_10D] o37, [ENBOND].[VOLUME_AVG_20D] o38, [ENBOND].[ID_BB_ULTIMATE_PARENT_CO] o39, [ENBOND].[CAPITAL_CONTINGENT_SECURITY] o40, [ENBOND].[REGISTERED_COUNTRY_LOCATION] o41, [ENBOND].[COUNTRY_OF_LARGEST_REVENUE] o42, [ENBOND].[MATURITY_DATE_ESTIMATED] o43, [ENBOND].[VOLUME_AVG_30D] o44, [ENBOND].[CUR_MKT_CAP] o45, [ENBOND].[YELD] o46, [ENBOND].[ACCRUEDINTERESTS] o47, [ENBOND].[FUND_GEO_FOCUS] o48, [ENBOND].[FUND_ASSET_CLASS_FOCUS] o49 &quot;</span>
                            <span class="s2">&quot;FROM [outsys_prod_qa].DBO.[OSUSR_BOL_BOND] [ENBOND] WHERE ([ENBOND].[TICKER] = &#39;&quot;</span> <span class="o">+</span> <span class="n">Ticker</span> <span class="o">+</span> <span class="s2">&quot;&#39;) ORDER BY [ENBOND].[DATE] DESC &quot;</span><span class="p">)</span>
                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
                    <span class="n">GetBondsByTicker2</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">GetBondsByTicker2</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">GetBondsByTicker2</span><span class="p">):</span>
                            <span class="n">GBBT</span> <span class="o">=</span> <span class="n">GetBondsByTicker2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">CurrencyOUT</span> <span class="o">=</span> <span class="n">GBBT</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">GetDerivativesByTicker2</span><span class="p">):</span>
                        <span class="n">GDBT</span> <span class="o">=</span> <span class="n">GetDerivativesByTicker2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">CurrencyOUT</span> <span class="o">=</span> <span class="n">GDBT</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">GetEquitiesByTicker2</span><span class="p">):</span>
                    <span class="n">GEBT</span> <span class="o">=</span> <span class="n">GetEquitiesByTicker2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">CurrencyOUT</span> <span class="o">=</span> <span class="n">GEBT</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">col_1</span><span class="p">,</span> <span class="n">col_2</span><span class="p">,</span> <span class="n">CurrencyOUT</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger_sqlalchemy</span> <span class="o">=</span> <span class="n">logg_Handler</span><span class="p">(</span><span class="n">fund</span><span class="p">,</span> <span class="n">logger_name</span><span class="o">=</span><span class="s2">&quot;col1_col2_with_auto_correction Exception&quot;</span><span class="p">)</span>
        <span class="n">logger_sqlalchemy</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="n">exception_json</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="mi">412</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Error in api &quot;</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">exception_json</span><span class="p">)</span></div>


<div class="viewcode-block" id="Col_1_and_2_Using_Ticker_2"><a class="viewcode-back" href="../python_script_rst/funds.html#funds.Col_1_and_2_Using_Ticker_2">[docs]</a><span class="k">def</span> <span class="nf">Col_1_and_2_Using_Ticker_2</span><span class="p">(</span><span class="n">Ticker</span><span class="p">,</span> <span class="n">Col_1_Ready</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function assign col_1 and col_2 in case that they are in the portfolios.</span>

<span class="sd">    :param Ticker: Ticker</span>
<span class="sd">    :param Col_1_Ready: InstrumentType_1stCol</span>

<span class="sd">    :return: col_2, col_1</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">col_2</span><span class="p">,</span> <span class="n">col_1</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Col_1_and_2_Using_Ticker_2&quot;</span><span class="p">)</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">database_dev</span><span class="p">()</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

    <span class="n">WriteTicker</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;SELECT * FROM [outsys_prod_qa].DBO.[OSUSR_38P_SR] [ENSR] WHERE ([ENSR].[ID] = (1)) ORDER BY [ENSR].[SUB_OR_RED] ASC &quot;</span><span class="p">)</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">WriteTicker</span><span class="p">)</span>
    <span class="n">GetWriteTickerRecords</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="n">Ticker</span> <span class="o">=</span> <span class="n">GetWriteTickerRecords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">UpdateSr</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;UPDATE [outsys_prod_qa].DBO.[OSUSR_38P_SR] set TICKERCHECK = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Ticker</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; where ID = (1)&quot;</span><span class="p">)</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">UpdateSr</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="n">CheckIfOptionEquity</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SELECT * FROM [outsys_prod_qa].DBO.[OSUSR_38P_SR] [ENSR] WHERE (((([ENSR].[TICKERCHECK] &quot;</span>
                           <span class="s2">&quot;LIKE ((N&#39;%&#39; + N&#39; C&#39;) + N&#39;%&#39;)) AND ([ENSR].[TICKERCHECK] LIKE ((N&#39;%&#39; + N&#39; Equity&#39;) + N&#39;%&#39;))) AND ([ENSR].[TICKERCHECK] LIKE&quot;</span>
                           <span class="s2">&quot; ((N&#39;%&#39; + N&#39;/&#39;) + N&#39;%&#39;))) OR ((([ENSR].[TICKERCHECK] LIKE ((N&#39;%&#39; + N&#39; P&#39;) + N&#39;%&#39;)) AND ([ENSR].[TICKERCHECK] LIKE &quot;</span>
                           <span class="s2">&quot;((N&#39;%&#39; + N&#39; Equity&#39;) + N&#39;%&#39;))) AND ([ENSR].[TICKERCHECK] LIKE ((N&#39;%&#39; + N&#39;/&#39;) + N&#39;%&#39;)))) ORDER BY [ENSR].[SUB_OR_RED] ASC &quot;</span><span class="p">)</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">CheckIfOptionEquity</span><span class="p">)</span>
    <span class="n">CheckIfOptionEquityRecords</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">CheckIfOptionEquityRecords</span><span class="p">:</span>
        <span class="n">CheckIfOptionIndex</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;SELECT * FROM [outsys_prod_qa].DBO.[OSUSR_38P_SR] [ENSR] WHERE (((([ENSR].[TICKERCHECK] LIKE ((N&#39;%&#39; + N&#39; C&#39;) + N&#39;%&#39;)) AND ([ENSR].[TICKERCHECK] LIKE (N&#39;%&#39; + N&#39; Index&#39;))) AND ([ENSR].[TICKERCHECK] LIKE ((N&#39;%&#39; + N&#39;/&#39;) + N&#39;%&#39;))) OR ((([ENSR].[TICKERCHECK] LIKE ((N&#39;%&#39; + N&#39; P&#39;) + N&#39;%&#39;)) AND ([ENSR].[TICKERCHECK] &quot;</span>
            <span class="s2">&quot;LIKE (N&#39;%&#39; + N&#39; Index&#39;))) AND ([ENSR].[TICKERCHECK] LIKE ((N&#39;%&#39; + N&#39;/&#39;) + N&#39;%&#39;)))) ORDER BY [ENSR].[SUB_OR_RED] ASC&quot;</span><span class="p">)</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">CheckIfOptionIndex</span><span class="p">)</span>
        <span class="n">CheckIfOptionIndexRecords</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">CheckIfOptionIndexRecords</span><span class="p">:</span>
            <span class="n">CheckIfFuture</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SELECT * FROM [outsys_prod_qa].DBO.[OSUSR_38P_SR] [ENSR] WHERE ([ENSR].[TICKERCHECK] &quot;</span>
                             <span class="s2">&quot;LIKE ((N&#39;%&#39; + N&#39; Index&#39;) + N&#39;%&#39;)) ORDER BY [ENSR].[SUB_OR_RED] ASC &quot;</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">CheckIfFuture</span><span class="p">)</span>
            <span class="n">CheckIfFutureRecords</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">CheckIfFutureRecords</span><span class="p">:</span>
                <span class="n">CheckBond</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SELECT * FROM [outsys_prod_qa].DBO.[OSUSR_38P_SR] [ENSR] WHERE ([ENSR].[TICKERCHECK] &quot;</span>
                             <span class="s2">&quot;LIKE ((N&#39;%&#39; + N&#39; Corp&#39;) + N&#39;%&#39;)) ORDER BY [ENSR].[SUB_OR_RED] ASC &quot;</span><span class="p">)</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">CheckBond</span><span class="p">)</span>
                <span class="n">CheckBondRecords</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">CheckBondRecords</span><span class="p">:</span>
                    <span class="n">col_2</span> <span class="o">=</span> <span class="s2">&quot;Bond&quot;</span>
                    <span class="n">col_1</span> <span class="o">=</span> <span class="s2">&quot;C&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">col_2</span> <span class="o">=</span> <span class="s2">&quot;Future Index&quot;</span>
                <span class="n">col_1</span> <span class="o">=</span> <span class="s2">&quot;C&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">col_2</span> <span class="o">=</span> <span class="s2">&quot;Option Equity&quot;</span>
            <span class="n">col_1</span> <span class="o">=</span> <span class="s2">&quot;C&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">col_2</span> <span class="o">=</span> <span class="s2">&quot;Option Equity&quot;</span>
        <span class="n">col_1</span> <span class="o">=</span> <span class="s2">&quot;C&quot;</span>

    <span class="k">if</span> <span class="n">col_1</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">col_1</span> <span class="o">=</span> <span class="n">Col_1_Ready</span>

    <span class="k">return</span> <span class="n">col_1</span><span class="p">,</span> <span class="n">col_2</span></div>


<div class="viewcode-block" id="Create_2ColumnActionReusable"><a class="viewcode-back" href="../python_script_rst/funds.html#funds.Create_2ColumnActionReusable">[docs]</a><span class="k">def</span> <span class="nf">Create_2ColumnActionReusable</span><span class="p">(</span><span class="n">Ticker</span><span class="p">,</span> <span class="n">Name</span><span class="p">,</span> <span class="n">SkeepDB</span><span class="p">,</span> <span class="n">bbgSecurityType</span><span class="p">,</span> <span class="n">TransactionType_1stCol</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param Ticker: TickerSINI</span>
<span class="sd">    :param Name: Name</span>
<span class="sd">    :param SkeepDB:</span>
<span class="sd">    :param bbgSecurityType:</span>
<span class="sd">    :param TransactionType_1stCol:</span>
<span class="sd">    :return: Currency, DB_LastPrice, SecurityType_2stCol, idISIN, id_bb_Ultimate_Parent_Co, DatePrice, Country, Sector, \</span>
<span class="sd">           Coupon, Maturity, AccruedInterests, Yeld, NameOut</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">database_dev</span><span class="p">()</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">Currency</span><span class="p">,</span> <span class="n">DB_LastPrice</span><span class="p">,</span> <span class="n">idISIN</span><span class="p">,</span> <span class="n">id_bb_Ultimate_Parent_Co</span><span class="p">,</span> <span class="n">DatePrice</span><span class="p">,</span> <span class="n">Country</span><span class="p">,</span> <span class="n">Sector</span><span class="p">,</span> <span class="n">Coupon</span><span class="p">,</span> <span class="n">Maturity</span><span class="p">,</span> <span class="n">AccruedInterests</span><span class="p">,</span> \
    <span class="n">Yeld</span><span class="p">,</span> <span class="n">NameOut</span><span class="p">,</span> <span class="n">Crncy</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">SkeepDB</span><span class="p">:</span>
        <span class="n">Security_Typ</span> <span class="o">=</span> <span class="n">bbgSecurityType</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Equ_ByTicker_query</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SELECT Top (1) * FROM [outsys_prod_qa].DBO.[OSUSR_38P_EQUITY] [ENEQUITY] WHERE &quot;</span>
                              <span class="s2">&quot;([ENEQUITY].[TICKER] = &quot;</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Ticker</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;) ORDER BY [ENEQUITY].[DATE] DESC&quot;</span><span class="p">)</span>

        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">Equ_ByTicker_query</span><span class="p">)</span>
        <span class="n">Equ_ByTicker</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Equ_ByTicker</span><span class="p">:</span>
            <span class="n">Currencies_ByTicker_query</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;SELECT Top (1) * FROM [outsys_prod_qa].DBO.[OSUSR_BOL_CURRENCY] [ENCURRENCY] WHERE &quot;</span>
                    <span class="s2">&quot;([ENCURRENCY].[TICKER] = &quot;</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">Ticker</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;) AND ([ENCURRENCY].[PX_LAST] != 0) ORDER BY [ENCURRENCY].[DATE] DESC&quot;</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">Currencies_ByTicker_query</span><span class="p">)</span>
            <span class="n">Currencies_ByTicker</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">Currencies_ByTicker</span><span class="p">:</span>
                <span class="n">Derivatives_ByTicker_query</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s2">&quot;SELECT [ENCURRENCY].[ID] o0, [ENCURRENCY].[DATE] o1, [ENCURRENCY].[TIME] o2,[ENCURRENCY].[TICKER] o3, [ENCURRENCY].[NAME] o4, [ENCURRENCY].[PX_LAST] o5, [ENCURRENCY].[MARKET_SECOTR_DES] o6, &quot;</span>
                        <span class="s2">&quot;[ENCURRENCY].[SECURITY_TYP] o7, [ENCURRENCY].[SETTLE_DT] o8, [ENCURRENCY].[CURRENCY1] o9, [ENCURRENCY].[CURRENCY2] o10 FROM [outsys_prod_qa].DBO.[OSUSR_BOL_CURRENCY] [ENCURRENCY] &quot;</span>
                        <span class="s2">&quot;WHERE ([ENCURRENCY].[TICKER] = &quot;</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">Ticker</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;) AND ([ENCURRENCY].[PX_LAST] != 0) ORDER BY [ENCURRENCY].[DATE] DESC&quot;</span><span class="p">)</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">Derivatives_ByTicker_query</span><span class="p">)</span>
                <span class="n">Derivatives_ByTicker</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">Derivatives_ByTicker</span><span class="p">:</span>
                    <span class="n">BondsBy_Ticker_Query</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;SELECT [ENDERIVATIVE].[ID] o0, [ENDERIVATIVE].[DATE] o1,[ENDERIVATIVE].[TICKER] o2, [ENDERIVATIVE].[NAME] o3, &quot;</span>
                            <span class="s2">&quot;[ENDERIVATIVE].[CNTRY_OF_RISK] o4, [ENDERIVATIVE].[CRNCY] o5, [ENDERIVATIVE].[OPT_STRIKE_PX] o6, [ENDERIVATIVE].[OPT_EXPIRE_DT] o7, &quot;</span>
                            <span class="s2">&quot;[ENDERIVATIVE].[OPT_PUT_CALL] o8, [ENDERIVATIVE].[ID_ISIN] o9, [ENDERIVATIVE].[COUNTRY] o10, [ENDERIVATIVE].[LAST_PRICE] o11, &quot;</span>
                            <span class="s2">&quot;[ENDERIVATIVE].[OPT_UNDL_TICKER] o12, [ENDERIVATIVE].[OPT_UNDL_PX] o13,[ENDERIVATIVE].[OPT_DELTA_MID] o14, [ENDERIVATIVE].[OPT_CONT_SIZE] o15, &quot;</span>
                            <span class="s2">&quot;[ENDERIVATIVE].[FUT_CONT_SIZE] o16, [ENDERIVATIVE].[PRIMARY_EXCHANGE_NAME] o17,[ENDERIVATIVE].[VOLUME_AVG_3M] o18, [ENDERIVATIVE].[VOLATILITY_90D] o19,&quot;</span>
                            <span class="s2">&quot; [ENDERIVATIVE].[FUT_GEN_ROLL_DT] o20, [ENDERIVATIVE].[OPT_THETA] o21,[ENDERIVATIVE].[VEGA] o22, [ENDERIVATIVE].[OPT_RHO] o23, &quot;</span>
                            <span class="s2">&quot;[ENDERIVATIVE].[GAMMA] o24, [ENDERIVATIVE].[MARKET_SECTOR_DES] o25, &quot;</span>
                            <span class="s2">&quot;[ENDERIVATIVE].[SECURITY_TYP] o26, [ENDERIVATIVE].[SETTLE_DT] o27, &quot;</span>
                            <span class="s2">&quot;[ENDERIVATIVE].[VOLUME_AVG_10D] o28, [ENDERIVATIVE].[VOLUME_AVG_20D] o29, &quot;</span>
                            <span class="s2">&quot;[ENDERIVATIVE].[ID_BB_ULTIMATE_PARENT_CO] o30, [ENDERIVATIVE].[ISSUER_INDUSTRY] o31, &quot;</span>
                            <span class="s2">&quot;[ENDERIVATIVE].[REGISTERED_COUNTRY_LOCATION] o32, &quot;</span>
                            <span class="s2">&quot;[ENDERIVATIVE].[COUNTRY_OF_LARGEST_REVENUE] o33,[ENDERIVATIVE].[UNDERLYING_ISIN] o34, [ENDERIVATIVE].[INDUSTRY_GROUP] o35,&quot;</span>
                            <span class="s2">&quot; [ENDERIVATIVE].[INDUSTRY_SECTOR] o36, [ENDERIVATIVE].[VOLUME_AVG_30D] o37,[ENDERIVATIVE].[CUR_MKT_CAP] o38 &quot;</span>
                            <span class="s2">&quot;FROM [outsys_prod_qa].DBO.[OSUSR_BOL_DERIVATIVE] [ENDERIVATIVE] WHERE ([ENDERIVATIVE].[TICKER] = &quot;</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                        <span class="n">Ticker</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;) ORDER BY [ENDERIVATIVE].[DATE] DESC &quot;</span><span class="p">)</span>
                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">BondsBy_Ticker_Query</span><span class="p">)</span>
                    <span class="n">BondsBy_Ticker</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">BondsBy_Ticker</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">q</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">BondsBy_Ticker</span><span class="p">):</span>
                            <span class="n">Security_Typ</span> <span class="o">=</span> <span class="n">BondsBy_Ticker</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="mi">35</span><span class="p">]</span>
                            <span class="n">isBond</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="n">Currency</span> <span class="o">=</span> <span class="n">BondsBy_Ticker</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
                            <span class="n">DB_LastPrice</span> <span class="o">=</span> <span class="n">BondsBy_Ticker</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="mi">12</span><span class="p">]</span>
                            <span class="n">CntryOfRisk</span> <span class="o">=</span> <span class="n">BondsBy_Ticker</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
                            <span class="n">Crncy</span> <span class="o">=</span> <span class="n">BondsBy_Ticker</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
                            <span class="n">idISIN</span> <span class="o">=</span> <span class="n">BondsBy_Ticker</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span>
                            <span class="n">id_bb_Ultimate_Parent_Co</span> <span class="o">=</span> <span class="n">BondsBy_Ticker</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="mi">39</span><span class="p">]</span>
                            <span class="n">DatePrice</span> <span class="o">=</span> <span class="n">BondsBy_Ticker</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">Yeld</span> <span class="o">=</span> <span class="n">BondsBy_Ticker</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="mi">46</span><span class="p">]</span>
                            <span class="n">AccruedInterests</span> <span class="o">=</span> <span class="n">BondsBy_Ticker</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="mi">47</span><span class="p">]</span>
                            <span class="n">Country</span> <span class="o">=</span> <span class="n">BondsBy_Ticker</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
                            <span class="n">Maturity</span> <span class="o">=</span> <span class="n">BondsBy_Ticker</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span>
                            <span class="n">Coupon</span> <span class="o">=</span> <span class="n">BondsBy_Ticker</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="mi">22</span><span class="p">]</span>
                            <span class="n">Sector</span> <span class="o">=</span> <span class="n">BondsBy_Ticker</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="mi">11</span><span class="p">]</span>
                            <span class="n">NameOut</span> <span class="o">=</span> <span class="n">BondsBy_Ticker</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Derivatives_ByTicker</span><span class="p">):</span>
                        <span class="n">Security_Typ</span> <span class="o">=</span> <span class="n">Derivatives_ByTicker</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">26</span><span class="p">]</span>
                        <span class="n">isDerivative</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">Currency</span> <span class="o">=</span> <span class="n">Derivatives_ByTicker</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
                        <span class="n">DB_LastPrice</span> <span class="o">=</span> <span class="n">Derivatives_ByTicker</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">11</span><span class="p">]</span>
                        <span class="n">CntryOfRisk</span> <span class="o">=</span> <span class="n">Derivatives_ByTicker</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
                        <span class="n">Crncy</span> <span class="o">=</span> <span class="n">Derivatives_ByTicker</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
                        <span class="n">idISIN</span> <span class="o">=</span> <span class="n">Derivatives_ByTicker</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">9</span><span class="p">]</span>
                        <span class="n">id_bb_Ultimate_Parent_Co</span> <span class="o">=</span> <span class="n">Derivatives_ByTicker</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">30</span><span class="p">]</span>
                        <span class="n">DatePrice</span> <span class="o">=</span> <span class="n">Derivatives_ByTicker</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">Country</span> <span class="o">=</span> <span class="n">Derivatives_ByTicker</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
                        <span class="n">NameOut</span> <span class="o">=</span> <span class="n">Derivatives_ByTicker</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Currencies_ByTicker</span><span class="p">):</span>
                    <span class="n">Security_Typ</span> <span class="o">=</span> <span class="n">Currencies_ByTicker</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span>
                    <span class="n">isCurrency</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">DatePrice</span> <span class="o">=</span> <span class="n">Currencies_ByTicker</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">NameOut</span> <span class="o">=</span> <span class="n">Currencies_ByTicker</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
                    <span class="n">DB_LastPrice</span> <span class="o">=</span> <span class="n">Currencies_ByTicker</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Equ_ByTicker</span><span class="p">):</span>
                <span class="n">Security_Typ</span> <span class="o">=</span> <span class="n">Equ_ByTicker</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">28</span><span class="p">]</span>
                <span class="n">isEquity</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">Currency</span> <span class="o">=</span> <span class="n">Equ_ByTicker</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
                <span class="n">DB_LastPrice</span> <span class="o">=</span> <span class="n">Equ_ByTicker</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">12</span><span class="p">]</span>
                <span class="n">CntryOfRisk</span> <span class="o">=</span> <span class="n">Equ_ByTicker</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">Crncy</span> <span class="o">=</span> <span class="n">Equ_ByTicker</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
                <span class="n">idISIN</span> <span class="o">=</span> <span class="n">Equ_ByTicker</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span>
                <span class="n">id_bb_Ultimate_Parent_Co</span> <span class="o">=</span> <span class="n">Equ_ByTicker</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">35</span><span class="p">]</span>
                <span class="n">DatePrice</span> <span class="o">=</span> <span class="n">Equ_ByTicker</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">Sector</span> <span class="o">=</span> <span class="n">Equ_ByTicker</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">11</span><span class="p">]</span>
                <span class="n">Country</span> <span class="o">=</span> <span class="n">Equ_ByTicker</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">NameOut</span> <span class="o">=</span> <span class="n">Equ_ByTicker</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;Corp&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;Govt&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Bond&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;ETP&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;ETF&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Name</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;ETF&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;Open-End Fund&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;Closed-End Fund&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Fund&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Comdty&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;Financial commodity future.&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Future Bond&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;IS&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;Common Stock&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Future Equity&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Index&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;Index Future&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;Index&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;Physical index future.&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Future Index&quot;</span>
    <span class="k">elif</span> <span class="n">Ticker</span> <span class="o">==</span> <span class="s2">&quot;There is no reason to use it, we wil use Forward instead that is exactly the same thing!!!!&quot;</span><span class="p">:</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Future Currency&quot;</span>
    <span class="k">elif</span> <span class="n">Ticker</span> <span class="o">==</span> <span class="s2">&quot;We have never traded these instruments!&quot;</span><span class="p">:</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Option Bond&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">Ticker</span> <span class="ow">and</span> <span class="s2">&quot; P&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">Ticker</span> <span class="ow">and</span> <span class="s2">&quot; C&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;Equity Option&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Option Equity&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Index&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">Ticker</span> <span class="ow">or</span> <span class="s2">&quot;Index Option&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Option Index&quot;</span>
    <span class="k">elif</span> <span class="n">Ticker</span> <span class="o">==</span> <span class="s2">&quot;We never traded this kind of instruments&quot;</span><span class="p">:</span>  <span class="c1"># 11</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Option Currency&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;Equity WRT&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Warrant&quot;</span>
    <span class="k">elif</span> <span class="n">TransactionType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;FX&quot;</span><span class="p">:</span>  <span class="c1"># 13</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Forward&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">Ticker</span> <span class="ow">and</span> <span class="s2">&quot; CH&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> \
            <span class="s2">&quot;CNY&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Crncy</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;Common Stock&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span> <span class="ow">or</span> <span class="s2">&quot;Savings Share&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> \
            <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;Dutch Cert&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;Foreign Sh.&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> \
            <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;Unit&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>  <span class="c1"># 14</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Equity&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">Ticker</span> <span class="ow">and</span> <span class="s2">&quot; CH&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;REIT&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>  <span class="c1"># 15</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Equity - REIT&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">Ticker</span> <span class="ow">and</span> <span class="s2">&quot; CH&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;ADR&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Equity - ADR&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">Ticker</span> <span class="ow">and</span> <span class="s2">&quot; CH&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;Savings Share&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Equity - Savings Share&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot; CH&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;CN&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">CntryOfRisk</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> \
            <span class="ow">and</span> <span class="s2">&quot;USD&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Crncy</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot; CH&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> \
            <span class="ow">and</span> <span class="s2">&quot;CN&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">CntryOfRisk</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;HKD&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Crncy</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> \
            <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot; C1&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;CN&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">CntryOfRisk</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> \
            <span class="ow">and</span> <span class="s2">&quot;HKD&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Crncy</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;USD&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Crncy</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Equity B-Shares&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot; CH&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;CN&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">CntryOfRisk</span><span class="o">.</span><span class="n">upper</span> \
            <span class="ow">and</span> <span class="s2">&quot;CNY&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Crncy</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot; C1&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> \
            <span class="ow">and</span> <span class="s2">&quot;CN&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">CntryOfRisk</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;CNY&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Crncy</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Equity A-Shares&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">Ticker</span> <span class="ow">and</span> <span class="s2">&quot; CH&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;MLP&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="p">:</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Equity - MLP&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;Preference&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>  <span class="c1"># 21</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Equity Preference&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot; CH&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> \
            <span class="ow">and</span> <span class="s2">&quot;Right&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>  <span class="c1"># 22</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Equity - Right&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">Ticker</span> <span class="ow">and</span> <span class="s2">&quot; CH&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> \
            <span class="s2">&quot;Receipt&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;ETP&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>  <span class="c1"># 23</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Equity - ETP&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">Ticker</span> <span class="ow">and</span> <span class="s2">&quot;ADR&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>  <span class="c1"># 24</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Equity - ADR&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">Ticker</span> <span class="ow">and</span> <span class="s2">&quot;Receipt&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>  <span class="c1"># 25</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Equity - Receipt&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;Fund of Funds&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>  <span class="c1"># 26</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Fund of Funds&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;Hedge Fund&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>  <span class="c1"># 27</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Hedge Fund&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">Ticker</span> <span class="ow">and</span> <span class="s2">&quot;GDR&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>  <span class="c1"># 28</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Equity - GDR&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;SINGLE STOCK FUTURE&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Security_Typ</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>  <span class="c1"># 29</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;Single stock future&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">SecurityType_2stCol</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Currency</span><span class="p">,</span> <span class="n">DB_LastPrice</span><span class="p">,</span> <span class="n">SecurityType_2stCol</span><span class="p">,</span> <span class="n">idISIN</span><span class="p">,</span> <span class="n">id_bb_Ultimate_Parent_Co</span><span class="p">,</span> <span class="n">DatePrice</span><span class="p">,</span> <span class="n">Country</span><span class="p">,</span> <span class="n">Sector</span><span class="p">,</span> \
           <span class="n">Coupon</span><span class="p">,</span> <span class="n">Maturity</span><span class="p">,</span> <span class="n">AccruedInterests</span><span class="p">,</span> <span class="n">Yeld</span><span class="p">,</span> <span class="n">NameOut</span></div>


<div class="viewcode-block" id="Col_1_and_2_Using_Weight_3"><a class="viewcode-back" href="../python_script_rst/funds.html#funds.Col_1_and_2_Using_Weight_3">[docs]</a><span class="k">def</span> <span class="nf">Col_1_and_2_Using_Weight_3</span><span class="p">(</span><span class="n">Ticker</span><span class="p">,</span> <span class="n">Weight</span><span class="p">,</span> <span class="n">CashORswap</span><span class="p">,</span> <span class="n">StockName</span><span class="p">,</span> <span class="n">BbgSecurityTyp</span><span class="p">,</span> <span class="n">FundName</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function assign col_1 and col_2 in case that they are in the portfolios.</span>

<span class="sd">    :param Ticker: TickerISIN</span>
<span class="sd">    :param Weight: WeightTarget</span>
<span class="sd">    :param CashORswap: gcashORswap</span>
<span class="sd">    :param StockName: sStockName</span>
<span class="sd">    :param BbgSecurityTyp: bbg_Security_Typ</span>
<span class="sd">    :param FundName: fund</span>

<span class="sd">    :return:col_1, col_2</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fund</span> <span class="o">=</span> <span class="n">FundName</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Col_1_and_2_Using_Weight_3&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">Name</span> <span class="o">=</span> <span class="n">StockName</span>
        <span class="n">SkeepDB</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">bbgSecurityType</span> <span class="o">=</span> <span class="n">BbgSecurityTyp</span>
        <span class="n">TransactionType_1stCol</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># Unknown variable need to find its its root</span>
        <span class="k">if</span> <span class="n">Weight</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">CashORswap</span> <span class="o">==</span> <span class="s2">&quot;SWAP&quot;</span><span class="p">:</span>
            <span class="n">col_1</span> <span class="o">=</span> <span class="s2">&quot;SW&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">col_1</span> <span class="o">=</span> <span class="s2">&quot;C&quot;</span>

        <span class="n">Currency</span><span class="p">,</span> <span class="n">DB_LastPrice</span><span class="p">,</span> <span class="n">SecurityType_2stCol</span><span class="p">,</span> <span class="n">idISIN</span><span class="p">,</span> <span class="n">id_bb_Ultimate_Parent_Co</span><span class="p">,</span> <span class="n">DatePrice</span><span class="p">,</span> <span class="n">Country</span><span class="p">,</span> <span class="n">Sector</span><span class="p">,</span> <span class="n">Coupon</span><span class="p">,</span> \
        <span class="n">Maturity</span><span class="p">,</span> <span class="n">AccruedInterests</span><span class="p">,</span> <span class="n">Yeld</span><span class="p">,</span> <span class="n">NameOut</span> <span class="o">=</span> <span class="n">Create_2ColumnActionReusable</span><span class="p">(</span><span class="n">Ticker</span><span class="p">,</span> <span class="n">Name</span><span class="p">,</span> <span class="n">SkeepDB</span><span class="p">,</span>
                                                                                 <span class="n">bbgSecurityType</span><span class="p">,</span>
                                                                                 <span class="n">TransactionType_1stCol</span><span class="p">)</span>
        <span class="n">col_2</span> <span class="o">=</span> <span class="n">SecurityType_2stCol</span>
        <span class="k">return</span> <span class="n">col_1</span><span class="p">,</span> <span class="n">col_2</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger_sqlalchemy</span> <span class="o">=</span> <span class="n">logg_Handler</span><span class="p">(</span><span class="n">fund</span><span class="p">,</span> <span class="n">logger_name</span><span class="o">=</span><span class="s2">&quot;Col_1_and_2_Using_Weight_3 Exception&quot;</span><span class="p">)</span>
        <span class="n">logger_sqlalchemy</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="n">exception_json</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="mi">412</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                          <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Error Message in Col_1_and_2_Using_Weight_3 process&quot;</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">exception_json</span><span class="p">)</span></div>


<div class="viewcode-block" id="Order_Type_A_B"><a class="viewcode-back" href="../python_script_rst/funds.html#funds.Order_Type_A_B">[docs]</a><span class="k">def</span> <span class="nf">Order_Type_A_B</span><span class="p">(</span><span class="n">IDcontactSuggestedBroker</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    This function check for BrokerType_A_B</span>

<span class="sd">    :param IDcontactSuggestedBroker:  IDcontactSuggestedBroker</span>

<span class="sd">    :return: BrokerType_A_B, NeedComment, BrokerSelReason, ExecutorFactor_Cost</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">IDcontactSuggestedBroker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">IDcontactSuggestedBroker</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">BrokerType_A_B</span> <span class="o">=</span> <span class="s2">&quot;B&quot;</span>
        <span class="n">NeedComment</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">BrokerSelReason</span> <span class="o">=</span> <span class="s2">&quot;Selected by the user, additional information needed.&quot;</span>
        <span class="n">ExecutorFactor_Cost</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">BrokerType_A_B</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span>
        <span class="n">NeedComment</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">BrokerSelReason</span> <span class="o">=</span> <span class="s2">&quot;System automatic selection&quot;</span>
        <span class="n">ExecutorFactor_Cost</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="k">return</span> <span class="n">BrokerType_A_B</span><span class="p">,</span> <span class="n">NeedComment</span><span class="p">,</span> <span class="n">BrokerSelReason</span><span class="p">,</span> <span class="n">ExecutorFactor_Cost</span></div>


<div class="viewcode-block" id="Trading_Equity_Fund_ETF_Cash"><a class="viewcode-back" href="../python_script_rst/funds.html#funds.Trading_Equity_Fund_ETF_Cash">[docs]</a><span class="k">def</span> <span class="nf">Trading_Equity_Fund_ETF_Cash</span><span class="p">(</span><span class="n">FundNumber</span><span class="p">,</span> <span class="n">Ticker</span><span class="p">,</span> <span class="n">IDcontactSuggestedBroker</span><span class="p">,</span> <span class="n">Col_2</span><span class="p">,</span> <span class="n">PortfolioBrokerCode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    This function is used for Trading_Equity_Fund_ETF_Cash process</span>

<span class="sd">    :param FundNumber:  FundNumber</span>
<span class="sd">    :param Ticker: TickerISIN</span>
<span class="sd">    :param IDcontactSuggestedBroker: IDcontactSuggestedBroker</span>
<span class="sd">    :param Col_2:  ProductType_2ndCol</span>
<span class="sd">    :param PortfolioBrokerCode:  PortfolioBrokerCode</span>
<span class="sd">    :return:  Trading_Equity_Fund_ETF_Cash</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trading_Equity_Fund_ETF_Cash&quot;</span><span class="p">)</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">database_dev</span><span class="p">()</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">BrokerName</span><span class="p">,</span> <span class="n">BrokerShortCode</span><span class="p">,</span> <span class="n">Custodian</span><span class="p">,</span> <span class="n">Account</span><span class="p">,</span> <span class="n">BrokerID</span><span class="p">,</span> <span class="n">JP_MorganAccount</span><span class="p">,</span> <span class="n">C4FBrokerName</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">PortfolioBrokerCode</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Fund&quot;</span><span class="p">:</span>
                <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">56</span><span class="p">)</span>
                <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;BDL&quot;</span>
                <span class="n">Account</span> <span class="o">=</span> <span class="mi">1747967</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
                <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;BDL&quot;</span>
                <span class="n">Account</span> <span class="o">=</span> <span class="mi">1967945</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">PortfolioBrokerCode</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Fund&quot;</span><span class="p">:</span>
                <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">56</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;US&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                <span class="n">SearchByName</span> <span class="o">=</span> <span class="s2">&quot;Goldman Sachs ELECTRONIC&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">SearchByName</span> <span class="o">=</span> <span class="s2">&quot;Goldman Sachs ELECTRONIC&quot;</span>

    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">PortfolioBrokerCode</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot; US&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                <span class="n">SearchByName</span> <span class="o">=</span> <span class="s2">&quot;Goldman Sachs ELECTRONIC&quot;</span>
            <span class="k">elif</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity A-Shares&quot;</span> <span class="ow">or</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity B-Shares&quot;</span> <span class="ow">or</span> <span class="s2">&quot; CH &quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                <span class="n">SearchByName</span> <span class="o">=</span> <span class="s2">&quot;CICC&quot;</span>
                <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">Account</span> <span class="o">=</span> <span class="mi">2259651</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">34</span><span class="p">)</span>
                <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;BDL&quot;</span>
                <span class="n">Account</span> <span class="o">=</span> <span class="mi">2259651</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">PortfolioBrokerCode</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Fund&quot;</span><span class="p">:</span>
                <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">56</span><span class="p">)</span>
                <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;BDL&quot;</span>
                <span class="n">Account</span> <span class="o">=</span> <span class="mi">1747967</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">SearchByName</span> <span class="o">=</span> <span class="s2">&quot;Goldman Sachs ELECTRONIC&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">PortfolioBrokerCode</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Fund&quot;</span><span class="p">:</span>
                <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">56</span><span class="p">)</span>
                <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;BDL&quot;</span>
                <span class="n">Account</span> <span class="o">=</span> <span class="mi">1747967</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;BDL&quot;</span>
                <span class="n">Account</span> <span class="o">=</span> <span class="s2">&quot;1747967&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">PortfolioBrokerCode</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Fund&quot;</span><span class="p">:</span>
                <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">44</span><span class="p">)</span>
                <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;BNP&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;BNP&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">PortfolioBrokerCode</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Fund&quot;</span><span class="p">:</span>
                <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">56</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">SearchByName</span> <span class="o">=</span> <span class="s2">&quot;Goldman Sachs&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">PortfolioBrokerCode</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;Us&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                <span class="n">SearchByName</span> <span class="o">=</span> <span class="s2">&quot;Goldman Sachs DESK&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">11</span> <span class="ow">or</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">PortfolioBrokerCode</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Fund&quot;</span><span class="p">:</span>
                <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">56</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">SearchByName</span> <span class="o">=</span> <span class="s2">&quot;Goldman Sachs&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">subject</span> <span class="o">=</span> <span class="s2">&quot;La determinazione del broker Equity cash non ha funzionato&quot;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Cerca di risolvere andando ad editare la selezione del Broker Cash&quot;</span>
        <span class="n">sendemail</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">IDcontactSuggestedBroker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">IDcontactSuggestedBroker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="n">IDcontactSuggestedBroker</span>
            <span class="n">SearchByName</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">PortfolioBrokerCode</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">ByBROKER_CODE_query</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;SELECT [ENBROKER].[ID] o0, [ENBROKER].[RELATIONTIPE] o1, [ENBROKER].[MACROFUNCTION] o2, [ENBROKER].[NAME] o3, [ENBROKER].[C4F_FUNDSBROKERCODE] o4, [ENBROKER].[SHORTCODE] o5, &quot;</span>
                    <span class="s2">&quot;[ENBROKER].[ASSETCLASS] o6, [ENBROKER].[PHONE] o7, [ENBROKER].[ADDRESS] o8, [ENBROKER].[INFO] o9,[ENBROKER].[MAILINGLIST] o10, [ENBROKER].[MAILINGLIST_SIT_BANORCAP] o11, [ENBROKER].[CREATEDON] o12, &quot;</span>
                    <span class="s2">&quot;[ENBROKER].[UPDATEDON] o13, [ENBROKER].[FAX] o14, [ENBROKER].[CONSISTENCYISSUE] o15, [ENBROKER].[UPDATEDBY] o16, [ENBROKER].[LASTSYSTOSALSEFORCECON] o17, [ENBROKER].[IDWITHISSUES] o18, &quot;</span>
                    <span class="s2">&quot;[ENBROKER].[SF_ID] o19, [ENBROKER].[DELETEDONSF] o20, [ENBROKER].[SF_LASTUPDATING] o21,[ENBROKER].[HEADQUARTER] o22, [ENBROKER].[COMPANYSIZE] o23, [ENBROKER].[WEBSITE] o24, &quot;</span>
                    <span class="s2">&quot;[ENBROKER].[DO_CREATE] o25, [ENBROKER].[DO_UPDATE] o26, [ENBROKER].[KEYWORD] o27, [ENBROKER].[EMAIL] o28, [ENBROKER].[ACTIVEINCONSISTENCY] o29, [ENBROKER].[CREATEDBY] o30, &quot;</span>
                    <span class="s2">&quot;[ENBROKER].[ISDA] o31, [ENBROKER].[SWAPEXPOSURE] o32, [ENBROKER].[SWAPPOOL] o33,[ENBROKER].[DELETEDFROMCRM] o34, [ENBROKER].[SUPPLIER] o35, [ENBROKER].[BIC_CODE_LEVEURO] o36, &quot;</span>
                    <span class="s2">&quot;[ENBROKER].[LEIREPORTINGCODE] o37, [ENBROKER].[BROKERCODE] o38, [ENBROKER].[MASTERAGREEMENT] o39,[ENBROKER].[MASTERAGREEMENTVERSION_DATE] o40, [ENBROKER].[LEIEXPIRYDATE] o41, [ENBROKER].[COUNTRY] o42,&quot;</span>
                    <span class="s2">&quot; [ENBROKER].[SBJREPORTING] o43, [ENBROKER].[NDG] o44 FROM [outsys_prod_qa].DBO.[OSUSR_38P_BROKER] [ENBROKER] &quot;</span>
                    <span class="s2">&quot;WHERE ([ENBROKER].[SHORTCODE] = &quot;</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">PortfolioBrokerCode</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;) AND ([ENBROKER].[RELATIONTIPE] = N&#39;Broker&#39;) &quot;</span>
                                             <span class="s2">&quot;ORDER BY [ENBROKER].[NAME] ASC &quot;</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">ByBROKER_CODE_query</span><span class="p">)</span>
            <span class="n">ByBROKER_CODE</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ByBROKER_CODE</span><span class="p">):</span>
                <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="n">ByBROKER_CODE</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">GetContactById_query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;SELECT [ENBROKER].[ID] o0, [ENBROKER].[RELATIONTIPE] o1, [ENBROKER].[MACROFUNCTION] o2, [ENBROKER].[NAME] o3, &quot;</span>
            <span class="s2">&quot;[ENBROKER].[C4F_FUNDSBROKERCODE] o4, [ENBROKER].[SHORTCODE] o5, &quot;</span>
            <span class="s2">&quot;[ENBROKER].[ASSETCLASS] o6, [ENBROKER].[PHONE] o7, [ENBROKER].[ADDRESS] o8, [ENBROKER].[INFO] o9&quot;</span>
            <span class="s2">&quot; FROM [outsys_prod_qa].DBO.[OSUSR_38P_BROKER] [ENBROKER] WHERE &quot;</span>
            <span class="s2">&quot;([ENBROKER].[RELATIONTIPE] = N&#39;Broker&#39;) AND ( [ENBROKER].[ID] = &quot;</span> <span class="o">+</span> <span class="n">IDcontactForBroker</span> <span class="o">+</span> <span class="s2">&quot; ORDER BY [ENBROKER].[NAME] ASC&quot;</span><span class="p">)</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GetContactById_query</span><span class="p">)</span>
    <span class="n">GetContactById</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">GetContactById</span><span class="p">):</span>
        <span class="n">BrokerName</span> <span class="o">=</span> <span class="n">GetContactById</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">BrokerShortCode</span> <span class="o">=</span> <span class="n">GetContactById</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">C4FBrokerName</span> <span class="o">=</span> <span class="n">GetContactById</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">BrokerID</span> <span class="o">=</span> <span class="n">GetContactById</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">GetFundById_query</span> <span class="o">=</span> <span class="s2">&quot;SELECT [ENFUNDS].[ID] o0, [ENFUNDS].[SIMPLENAME] o1, [ENFUNDS].[NAME] o2, &quot;</span> \
                        <span class="s2">&quot;[ENFUNDS].[TICKER] o3, [ENFUNDS].[CRNCY] o4, [ENFUNDS].[CLASS] o5, [ENFUNDS].[FUND_CODE] o6, &quot;</span> \
                        <span class="s2">&quot;[ENFUNDS].[ID_ISIN] o7, [ENFUNDS].[FRONT_LOAD_FEE] o8, [ENFUNDS].[BACK_LOAD_FEE] o9, &quot;</span> \
                        <span class="s2">&quot;[ENFUNDS].[MNG_FEE] o10, [ENFUNDS].[PERF_FEE] o11, [ENFUNDS].[MNG_FEETILLJUNE14] o12,&quot;</span> \
                        <span class="s2">&quot; [ENFUNDS].[PERC_FEETILLJUNE14] o13, [ENFUNDS].[COLLOCAMENTOUBS] o14, &quot;</span> \
                        <span class="s2">&quot;[ENFUNDS].[COLLOCAMENTOBANORSIM] o15, [ENFUNDS].[MINFIRSTTIME_INVESTMENT] o16, &quot;</span> \
                        <span class="s2">&quot;[ENFUNDS].[STRATEGY] o17, [ENFUNDS].[GEOFOCUSREGION] o18, [ENFUNDS].[ASSETCLASS] o19, &quot;</span> \
                        <span class="s2">&quot;[ENFUNDS].[INCEPTIONDATE] o20, [ENFUNDS].[SICAV] o21, [ENFUNDS].[BENCHMARK] o22, &quot;</span> \
                        <span class="s2">&quot;[ENFUNDS].[DETAILSCUSTOMBENCHMARKS] o23, [ENFUNDS].[SETTLEMENT] o24, &quot;</span> \
                        <span class="s2">&quot;[ENFUNDS].[MORNINGSTARCATEGORY] o25, [ENFUNDS].[CUTOFF] o26, [ENFUNDS].[DEALINGPERIOD] o27, &quot;</span> \
                        <span class="s2">&quot;[ENFUNDS].[ADVISOR] o28, [ENFUNDS].[FX_BDL_ACCOUNT] o29, [ENFUNDS].[FX_BNP_ACCOUNT] o30, &quot;</span> \
                        <span class="s2">&quot;[ENFUNDS].[BASECURRENCY] o31, [ENFUNDS].[CASA4FUND_FUNDNAME] o32, [ENFUNDS].[JPMORGANACCOUNT] o33, &quot;</span> \
                        <span class="s2">&quot;[ENFUNDS].[UBSACCOUNT] o34 FROM [outsys_prod_qa].DBO.[OSUSR_38P_FUNDS] [ENFUNDS] WHERE &quot;</span> \
                        <span class="s2">&quot;([ENFUNDS].[FUND_CODE] = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">FundNumber</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) ORDER BY [ENFUNDS].[NAME] ASC &quot;</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GetFundById_query</span><span class="p">)</span>
    <span class="n">GetFundById</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">GetFundById</span><span class="p">):</span>
        <span class="n">JP_MorganAccount</span> <span class="o">=</span> <span class="n">GetFundById</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">33</span><span class="p">]</span>
    <span class="n">BrokerType_A_B</span><span class="p">,</span> <span class="n">NeedComment</span><span class="p">,</span> <span class="n">BrokerSelReason</span><span class="p">,</span> <span class="n">ExecutorFactor_Cost</span> <span class="o">=</span> <span class="n">Order_Type_A_B</span><span class="p">(</span><span class="n">IDcontactSuggestedBroker</span><span class="p">)</span>
    <span class="n">BrokerType_A_B</span> <span class="o">=</span> <span class="n">BrokerType_A_B</span>
    <span class="n">NeedComment</span> <span class="o">=</span> <span class="n">NeedComment</span>
    <span class="n">BrokerSelReason</span> <span class="o">=</span> <span class="n">BrokerSelReason</span>
    <span class="n">ExecutorFactor_Cost</span> <span class="o">=</span> <span class="n">ExecutorFactor_Cost</span>
    <span class="k">return</span> <span class="n">BrokerName</span><span class="p">,</span> <span class="n">BrokerShortCode</span><span class="p">,</span> <span class="n">Custodian</span><span class="p">,</span> <span class="n">Account</span><span class="p">,</span> <span class="n">C4FBrokerName</span><span class="p">,</span> <span class="n">BrokerID</span><span class="p">,</span> \
           <span class="n">BrokerType_A_B</span><span class="p">,</span> <span class="n">NeedComment</span><span class="p">,</span> <span class="n">BrokerSelReason</span><span class="p">,</span> <span class="n">ExecutorFactor_Cost</span><span class="p">,</span> <span class="n">JP_MorganAccount</span></div>


<div class="viewcode-block" id="Trading_Bond_Cash"><a class="viewcode-back" href="../python_script_rst/funds.html#funds.Trading_Bond_Cash">[docs]</a><span class="k">def</span> <span class="nf">Trading_Bond_Cash</span><span class="p">(</span><span class="n">FundNumber</span><span class="p">,</span> <span class="n">Ticker</span><span class="p">,</span> <span class="n">IDcontactSuggestedBroker</span><span class="p">,</span> <span class="n">PortfolioBrokerCode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    This fuction get called when InstrumentType_1stCol is C and  ProductType_2ndCol is Bond.</span>

<span class="sd">    :param FundNumber: FundNumber</span>
<span class="sd">    :param Ticker: Ticker</span>
<span class="sd">    :param IDcontactSuggestedBroker: IDcontactSuggestedBroker</span>
<span class="sd">    :param PortfolioBrokerCode: PortfolioBrokerCode</span>

<span class="sd">    :return: Trading_Bond_Cash</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trading_Bond_Cash&quot;</span><span class="p">)</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">database_dev</span><span class="p">()</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">IDcontactForBroker</span><span class="p">,</span> <span class="n">BrokerName</span><span class="p">,</span> <span class="n">BrokerShortCode</span><span class="p">,</span> <span class="n">Custodian</span><span class="p">,</span> <span class="n">C4FBrokerName</span><span class="p">,</span> <span class="n">Account</span><span class="p">,</span> <span class="n">BrokerID</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;BDL&quot;</span>
        <span class="n">Account</span> <span class="o">=</span> <span class="s2">&quot;1967945&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;BDL&quot;</span>
        <span class="n">Account</span> <span class="o">=</span> <span class="s2">&quot;2259669&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Ticker</span> <span class="o">==</span> <span class="s2">&quot;%&quot;</span> <span class="o">+</span> <span class="s2">&quot;US&quot;</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span><span class="p">:</span>
            <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;BDL&quot;</span>
            <span class="n">Account</span> <span class="o">=</span> <span class="s2">&quot;2259651&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">34</span><span class="p">)</span>
            <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;BDL&quot;</span>
            <span class="n">Account</span> <span class="o">=</span> <span class="s2">&quot;061781QB&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;BDL&quot;</span>
        <span class="n">Account</span> <span class="o">=</span> <span class="s2">&quot;1747967&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;BDL&quot;</span>
        <span class="n">Account</span> <span class="o">=</span> <span class="s2">&quot;1795430&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
        <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;BNP&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;BDL&quot;</span>
        <span class="n">Account</span> <span class="o">=</span> <span class="s2">&quot;2259669&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
        <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;BDL&quot;</span>
        <span class="n">Account</span> <span class="o">=</span> <span class="s2">&quot;2259669&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
        <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;PKB&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">13</span><span class="p">:</span>
        <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;BNP&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">subject</span> <span class="o">=</span> <span class="s2">&quot;La determinazione del broker Equity cash non ha funzionato&quot;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Cerca di risolvere andando ad editare la selezione del Broker Cash&quot;</span>
        <span class="n">sendemail</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">IDcontactSuggestedBroker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="n">IDcontactSuggestedBroker</span>

    <span class="n">GetContactById_query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;SELECT [ENBROKER].[ID] o0, [ENBROKER].[RELATIONTIPE] o1, [ENBROKER].[MACROFUNCTION] o2, [ENBROKER].[NAME] o3, &quot;</span>
            <span class="s2">&quot;[ENBROKER].[C4F_FUNDSBROKERCODE] o4, [ENBROKER].[SHORTCODE] o5, [ENBROKER].[ASSETCLASS]&quot;</span>
            <span class="s2">&quot; FROM [outsys_prod_qa].DBO.[OSUSR_38P_BROKER] [ENBROKER] WHERE &quot;</span>
            <span class="s2">&quot;([ENBROKER].[ID] = &quot;</span> <span class="o">+</span> <span class="n">IDcontactForBroker</span> <span class="o">+</span> <span class="s2">&quot;) ORDER BY [ENBROKER].[NAME] ASC&quot;</span><span class="p">)</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GetContactById_query</span><span class="p">)</span>
    <span class="n">GetContactById</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

    <span class="n">BrokerType_A_B</span><span class="p">,</span> <span class="n">NeedComment</span><span class="p">,</span> <span class="n">BrokerSelReason</span><span class="p">,</span> <span class="n">ExecutorFactor_Cost</span> <span class="o">=</span> <span class="n">Order_Type_A_B</span><span class="p">(</span><span class="n">IDcontactSuggestedBroker</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">GetContactById</span><span class="p">):</span>
        <span class="n">BrokerName</span> <span class="o">=</span> <span class="n">GetContactById</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">BrokerShortCode</span> <span class="o">=</span> <span class="n">GetContactById</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">C4FBrokerName</span> <span class="o">=</span> <span class="n">GetContactById</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">BrokerID</span> <span class="o">=</span> <span class="n">GetContactById</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">BrokerType_A_B</span> <span class="o">=</span> <span class="n">BrokerType_A_B</span>
    <span class="n">NeedComment</span> <span class="o">=</span> <span class="n">NeedComment</span>
    <span class="n">BrokerSelReason</span> <span class="o">=</span> <span class="n">BrokerSelReason</span>
    <span class="n">ExecutorFactor_Cost</span> <span class="o">=</span> <span class="n">ExecutorFactor_Cost</span>
    <span class="k">return</span> <span class="n">BrokerName</span><span class="p">,</span> <span class="n">BrokerShortCode</span><span class="p">,</span> <span class="n">Custodian</span><span class="p">,</span> <span class="n">C4FBrokerName</span><span class="p">,</span> <span class="n">Account</span><span class="p">,</span> <span class="n">BrokerID</span><span class="p">,</span> <span class="n">BrokerType_A_B</span><span class="p">,</span> <span class="n">NeedComment</span><span class="p">,</span> \
           <span class="n">BrokerSelReason</span><span class="p">,</span> <span class="n">ExecutorFactor_Cost</span></div>


<div class="viewcode-block" id="Trading_Swap"><a class="viewcode-back" href="../python_script_rst/funds.html#funds.Trading_Swap">[docs]</a><span class="k">def</span> <span class="nf">Trading_Swap</span><span class="p">(</span><span class="n">FundNumber</span><span class="p">,</span> <span class="n">IDcontactSuggestedBroker</span><span class="p">,</span> <span class="n">PortfolioBrokerCode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param FundNumber:  FundNumber</span>
<span class="sd">    :param IDcontactSuggestedBroker:  IDcontactSuggestedBroker</span>
<span class="sd">    :param PortfolioBrokerCode:  PortfolioBrokerCode</span>

<span class="sd">    :return:  BrokerName, BrokerShortCode, Custodian, Account, C4FBroker, BrokerID, BrokerType_A_B, \</span>
<span class="sd">                   NeedComment, BrokerSelReason, ExecutorFactor_Cost, JP_MorganAccount</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trading_Swap&quot;</span><span class="p">)</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">database_dev</span><span class="p">()</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">SearchByName</span><span class="p">,</span> <span class="n">SearchByName</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="n">IDcontactForBroker</span><span class="p">,</span> <span class="n">BrokerName</span><span class="p">,</span> <span class="n">BrokerShortCode</span><span class="p">,</span> <span class="n">Custodian</span><span class="p">,</span> <span class="n">Account</span><span class="p">,</span> <span class="n">C4FBroker</span><span class="p">,</span> <span class="n">BrokerID</span><span class="p">,</span> <span class="n">JP_MorganAccount</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">PortfolioBrokerCode</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">34</span><span class="p">)</span>
            <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;MSIL&quot;</span>
            <span class="n">Account</span> <span class="o">=</span> <span class="s2">&quot;061781QA1&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">PortfolioBrokerCode</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">34</span><span class="p">)</span>
            <span class="n">Account</span> <span class="o">=</span> <span class="s2">&quot;061781QC7&quot;</span>
            <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;MSIL&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">PortfolioBrokerCode</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">34</span><span class="p">)</span>
            <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;MSIL&quot;</span>
            <span class="n">Account</span> <span class="o">=</span> <span class="s2">&quot;061781QB9&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">PortfolioBrokerCode</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">SearchByName</span> <span class="o">=</span> <span class="s2">&quot;UBS&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">PortfolioBrokerCode</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">34</span><span class="p">)</span>
            <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;MSIL&quot;</span>
            <span class="n">Account</span> <span class="o">=</span> <span class="s2">&quot;061781QA1&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">PortfolioBrokerCode</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">IDcontactSuggestedBroker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="n">IDcontactSuggestedBroker</span>
                <span class="n">SearchByName</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">34</span><span class="p">)</span>
                <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;MSIL&quot;</span>
                <span class="n">Account</span> <span class="o">=</span> <span class="s2">&quot;061781QA1&quot;</span>

    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">10</span> <span class="ow">or</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">PortfolioBrokerCode</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">735</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">subject</span> <span class="o">=</span> <span class="s2">&quot;La determinazione del broker Equity cash non ha funzionato&quot;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Cerca di risolvere andando ad editare la selezione del Broker Cash&quot;</span>
        <span class="n">sendemail</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">IDcontactSuggestedBroker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="n">IDcontactSuggestedBroker</span>
        <span class="n">SearchByName</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">PortfolioBrokerCode</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">ByBROKER_CODE_query</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;SELECT [ENBROKER].[ID] o0, [ENBROKER].[RELATIONTIPE] o1, [ENBROKER].[MACROFUNCTION] o2,&quot;</span>
                    <span class="s2">&quot; [ENBROKER].[NAME] o3, [ENBROKER].[C4F_FUNDSBROKERCODE] o4, [ENBROKER].[SHORTCODE] o5 &quot;</span>
                    <span class="s2">&quot;FROM [outsys_prod_qa].DBO.[OSUSR_38P_BROKER] [ENBROKER] WHERE &quot;</span>
                    <span class="s2">&quot;([ENBROKER].[SHORTCODE] = &quot;</span> <span class="o">+</span> <span class="n">PortfolioBrokerCode</span> <span class="o">+</span> <span class="s2">&quot;) AND ([ENBROKER].[RELATIONTIPE] = N&#39;Broker&#39;) ORDER BY [ENBROKER].[NAME] ASC &quot;</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">ByBROKER_CODE_query</span><span class="p">)</span>
            <span class="n">ByBROKER_CODE</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ByBROKER_CODE</span><span class="p">):</span>
                <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="n">ByBROKER_CODE</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">IDcontactSuggestedBroker</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">SearchByName</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">IDcontactForBroker</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">GetFundById_query</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;SELECT [ENFUNDS].[ID] o0, [ENFUNDS].[SIMPLENAME] o1, [ENFUNDS].[NAME] o2, [ENFUNDS].[TICKER] o3,&quot;</span>
                    <span class="s2">&quot; [ENFUNDS].[CRNCY] o4, [ENFUNDS].[CLASS] o5,[ENFUNDS].[BASECURRENCY] o31, [ENFUNDS].[CASA4FUND_FUNDNAME] o32&quot;</span>
                    <span class="s2">&quot;[ENFUNDS].[JPMORGANACCOUNT] o33, [ENFUNDS].[UBSACCOUNT] o34 FROM [outsys_prod_qa].DBO.[OSUSR_38P_FUNDS] [ENFUNDS] &quot;</span>
                    <span class="s2">&quot;WHERE ([ENFUNDS].[FUND_CODE] = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">FundNumber</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) ORDER BY [ENFUNDS].[NAME] ASC&quot;</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GetFundById_query</span><span class="p">)</span>
            <span class="n">GetFundById</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">GetFundById</span><span class="p">):</span>
                <span class="n">JP_MorganAccount</span> <span class="o">=</span> <span class="n">GetFundById</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">33</span><span class="p">]</span>

            <span class="n">GetContactById_query</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;SELECT [ENBROKER].[ID] o0, [ENBROKER].[RELATIONTIPE] o1, [ENBROKER].[MACROFUNCTION] o2, &quot;</span>
                    <span class="s2">&quot;[ENBROKER].[NAME] o3, [ENBROKER].[C4F_FUNDSBROKERCODE] o4, [ENBROKER].[SHORTCODE] o5,&quot;</span>
                    <span class="s2">&quot; [ENBROKER].[ASSETCLASS] o6, [ENBROKER].[PHONE] o7, [ENBROKER].[ADDRESS] o8, &quot;</span>
                    <span class="s2">&quot;[ENBROKER].[INFO] o9, [ENBROKER].[MAILINGLIST] o10 FROM [outsys_prod_qa].DBO.[OSUSR_38P_BROKER] [ENBROKER] &quot;</span>
                    <span class="s2">&quot;WHERE ([ENBROKER].[RELATIONTIPE] = N&#39;Broker&#39;) AND ([ENBROKER].[ID] = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">IDcontactForBroker</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) ORDER BY [ENBROKER].[NAME] ASC &quot;</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GetContactById_query</span><span class="p">)</span>
            <span class="n">GetContactById</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">GetContactById</span><span class="p">):</span>
                <span class="n">BrokerName</span> <span class="o">=</span> <span class="n">GetContactById</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">BrokerShortCode</span> <span class="o">=</span> <span class="n">GetContactById</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
                <span class="n">C4FBroker</span> <span class="o">=</span> <span class="n">GetContactById</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">BrokerID</span> <span class="o">=</span> <span class="n">GetContactById</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">BrokerType_A_B</span><span class="p">,</span> <span class="n">NeedComment</span><span class="p">,</span> <span class="n">BrokerSelReason</span><span class="p">,</span> <span class="n">ExecutorFactor_Cost</span> <span class="o">=</span> <span class="n">Order_Type_A_B</span><span class="p">(</span><span class="n">IDcontactSuggestedBroker</span><span class="p">)</span>
            <span class="n">BrokerType_A_B</span> <span class="o">=</span> <span class="n">BrokerType_A_B</span>
            <span class="n">NeedComment</span> <span class="o">=</span> <span class="n">NeedComment</span>
            <span class="n">BrokerSelReason</span> <span class="o">=</span> <span class="n">BrokerSelReason</span>
            <span class="n">ExecutorFactor_Cost</span> <span class="o">=</span> <span class="n">ExecutorFactor_Cost</span>
            <span class="k">return</span> <span class="n">BrokerName</span><span class="p">,</span> <span class="n">BrokerShortCode</span><span class="p">,</span> <span class="n">Custodian</span><span class="p">,</span> <span class="n">Account</span><span class="p">,</span> <span class="n">C4FBroker</span><span class="p">,</span> <span class="n">BrokerID</span><span class="p">,</span> <span class="n">BrokerType_A_B</span><span class="p">,</span> \
                   <span class="n">NeedComment</span><span class="p">,</span> <span class="n">BrokerSelReason</span><span class="p">,</span> <span class="n">ExecutorFactor_Cost</span><span class="p">,</span> <span class="n">JP_MorganAccount</span></div>


<div class="viewcode-block" id="Trading_Derivative_Cash"><a class="viewcode-back" href="../python_script_rst/funds.html#funds.Trading_Derivative_Cash">[docs]</a><span class="k">def</span> <span class="nf">Trading_Derivative_Cash</span><span class="p">(</span><span class="n">FundNumber</span><span class="p">,</span> <span class="n">PortfolioBrokerCode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    This function calculating values of IDcontactForBroker,Custodian,Account based on fundNumber</span>

<span class="sd">    :param FundNumber: FundNumber</span>
<span class="sd">    :param PortfolioBrokerCode: PortfolioBrokerCode</span>

<span class="sd">    :return:  IDcontactForBroker,Custodian,Account based on fundNumber</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trading_Derivative_Cash&quot;</span><span class="p">)</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">database_dev</span><span class="p">()</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">IDcontactForBroker</span><span class="p">,</span> <span class="n">IDcontactSuggestedBroker</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="n">Custodian</span><span class="p">,</span> <span class="n">Account</span><span class="p">,</span> <span class="n">C4FBroker</span><span class="p">,</span> <span class="n">BrokerName</span><span class="p">,</span> <span class="n">BrokerShortCode</span><span class="p">,</span> <span class="n">C4FBrokerName</span><span class="p">,</span> <span class="n">BrokerID</span><span class="p">,</span> <span class="n">BrokerType_A_B</span><span class="p">,</span> <span class="n">NeedComment</span><span class="p">,</span> \
    <span class="n">BrokerSelReason</span><span class="p">,</span> <span class="n">ExecutorFactor_Cost</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;NE&quot;</span>
        <span class="n">Account</span> <span class="o">=</span> <span class="s2">&quot;22701395&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;NE&quot;</span>
        <span class="n">Account</span> <span class="o">=</span> <span class="mi">22773802</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;NE&quot;</span>
        <span class="n">Account</span> <span class="o">=</span> <span class="mi">22773801</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;NE&quot;</span>
        <span class="n">Account</span> <span class="o">=</span> <span class="s2">&quot;22773804&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;NE&quot;</span>
        <span class="n">Account</span> <span class="o">=</span> <span class="s2">&quot;22773803&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
        <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;NE&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;NE&quot;</span>
        <span class="n">Account</span> <span class="o">=</span> <span class="mi">22773802</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
        <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;NE&quot;</span>
    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
        <span class="n">IDcontactForBroker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">Custodian</span> <span class="o">=</span> <span class="s2">&quot;NE&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">subject</span> <span class="o">=</span> <span class="s2">&quot;La determinazione del broker Equity cash non ha funzionato&quot;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Cerca di risolvere andando ad editare la selezione del Broker Cash&quot;</span>
        <span class="n">sendemail</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>

    <span class="n">GetContactById_query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;SELECT [ENBROKER].[ID] o0, [ENBROKER].[RELATIONTIPE] o1,[ENBROKER].[MACROFUNCTION] o2, [ENBROKER].[NAME] o3, [ENBROKER].[C4F_FUNDSBROKERCODE] o4,&quot;</span>
            <span class="s2">&quot; [ENBROKER].[SHORTCODE] o5, [ENBROKER].[ASSETCLASS] o6, [ENBROKER].[PHONE] o7, &quot;</span>
            <span class="s2">&quot;[ENBROKER].[ADDRESS] o8, [ENBROKER].[INFO] o9, [ENBROKER].[MAILINGLIST] o10 FROM [outsys_prod_qa].DBO.[OSUSR_38P_BROKER] [ENBROKER] &quot;</span>
            <span class="s2">&quot;WHERE ([ENBROKER].[ID] = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">IDcontactForBroker</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) ORDER BY [ENBROKER].[NAME] ASC &quot;</span><span class="p">)</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GetContactById_query</span><span class="p">)</span>
    <span class="n">GetContactById</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">GetContactById</span><span class="p">):</span>
        <span class="n">BrokerName</span> <span class="o">=</span> <span class="n">GetContactById</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">BrokerShortCode</span> <span class="o">=</span> <span class="n">GetContactById</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">C4FBrokerName</span> <span class="o">=</span> <span class="n">GetContactById</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">BrokerID</span> <span class="o">=</span> <span class="n">GetContactById</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">BrokerType_A_B</span><span class="p">,</span> <span class="n">NeedComment</span><span class="p">,</span> <span class="n">BrokerSelReason</span><span class="p">,</span> <span class="n">ExecutorFactor_Cost</span> <span class="o">=</span> <span class="n">Order_Type_A_B</span><span class="p">(</span><span class="n">IDcontactSuggestedBroker</span><span class="p">)</span>
    <span class="n">BrokerType_A_B</span> <span class="o">=</span> <span class="n">BrokerType_A_B</span>
    <span class="n">NeedComment</span> <span class="o">=</span> <span class="n">NeedComment</span>
    <span class="n">BrokerSelReason</span> <span class="o">=</span> <span class="n">BrokerSelReason</span>
    <span class="n">ExecutorFactor_Cost</span> <span class="o">=</span> <span class="n">ExecutorFactor_Cost</span>
    <span class="k">return</span> <span class="n">BrokerName</span><span class="p">,</span> <span class="n">BrokerShortCode</span><span class="p">,</span> <span class="n">C4FBrokerName</span><span class="p">,</span> <span class="n">BrokerID</span><span class="p">,</span> <span class="n">BrokerType_A_B</span><span class="p">,</span> <span class="n">NeedComment</span><span class="p">,</span> <span class="n">BrokerSelReason</span><span class="p">,</span> \
           <span class="n">ExecutorFactor_Cost</span><span class="p">,</span> <span class="n">Custodian</span><span class="p">,</span> <span class="n">Account</span><span class="p">,</span> <span class="n">C4FBroker</span></div>


<div class="viewcode-block" id="CodesGeneration_Arbor"><a class="viewcode-back" href="../python_script_rst/funds.html#funds.CodesGeneration_Arbor">[docs]</a><span class="k">def</span> <span class="nf">CodesGeneration_Arbor</span><span class="p">(</span><span class="n">Col_1</span><span class="p">,</span> <span class="n">Col_2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function return ArborProductType</span>

<span class="sd">    :param Col_1: Col_1</span>
<span class="sd">    :param Col_2: Col_2</span>

<span class="sd">    :return: ArborProductType</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CodesGeneration_Arbor&quot;</span><span class="p">)</span>
    <span class="n">ArborProductType</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Option Equity&quot;</span> <span class="ow">or</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Option Index&quot;</span><span class="p">:</span>
        <span class="n">ArborProductType</span> <span class="o">=</span> <span class="s2">&quot;OP&quot;</span>

    <span class="k">elif</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Future Index&quot;</span> <span class="ow">and</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">or</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Single stock future&quot;</span> <span class="ow">and</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span>
        <span class="n">ArborProductType</span> <span class="o">=</span> <span class="s2">&quot;FU&quot;</span>

    <span class="k">elif</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Bond&quot;</span><span class="p">:</span>
        <span class="n">ArborProductType</span> <span class="o">=</span> <span class="s2">&quot;Bond&quot;</span>

    <span class="k">elif</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;SW&quot;</span><span class="p">:</span>
        <span class="n">ArborProductType</span> <span class="o">=</span> <span class="s2">&quot;CFD&quot;</span>

    <span class="k">elif</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity&quot;</span> <span class="ow">or</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity - REIT&quot;</span> <span class="ow">or</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity - Savings Share&quot;</span> <span class="ow">or</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity - ADR&quot;</span> <span class="ow">or</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;ETF&quot;</span> <span class="ow">or</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Warrant&quot;</span> <span class="ow">or</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity - MLP&quot;</span> <span class="ow">or</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity Preference&quot;</span> <span class="ow">or</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity A-Shares&quot;</span> <span class="ow">or</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity B-Shares&quot;</span><span class="p">:</span>
        <span class="n">ArborProductType</span> <span class="o">=</span> <span class="s2">&quot;CFD&quot;</span>

    <span class="k">elif</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Fund&quot;</span><span class="p">:</span>
        <span class="n">ArborProductType</span> <span class="o">=</span> <span class="s2">&quot;Fund&quot;</span>

    <span class="k">return</span> <span class="n">ArborProductType</span></div>


<div class="viewcode-block" id="Swap_Exposure"><a class="viewcode-back" href="../python_script_rst/funds.html#funds.Swap_Exposure">[docs]</a><span class="k">def</span> <span class="nf">Swap_Exposure</span><span class="p">(</span><span class="n">FundCode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param FundCode: FundCode</span>
<span class="sd">    :return: ExposureTradeID</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">database_dev</span><span class="p">()</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">CurDate</span> <span class="o">=</span> <span class="n">get_current_date</span><span class="p">()</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">BrokerExposure</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SELECT Max([ENBROKEREXPOSURE].[EXPOSURETRADEID]) [EXPOSURETRADEIDMAX]&quot;</span>
                      <span class="s2">&quot; FROM [outsys_prod_qa].DBO.[OSUSR_SKP_BROKEREXPOSURE] [ENBROKEREXPOSURE]&quot;</span><span class="p">)</span>

    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">BrokerExposure</span><span class="p">)</span>
    <span class="n">resultBrokerExposure</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

    <span class="n">ExposureTradeID</span> <span class="o">=</span> <span class="n">resultBrokerExposure</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">GetBrokerExposures</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;SELECT [ENBROKEREXPOSURE].[ID] o0, [ENBROKEREXPOSURE].[DATETIME] o1, [ENBROKEREXPOSURE].[FUNDID] o2, [ENBROKEREXPOSURE].[BROKERID] o3, [ENBROKEREXPOSURE].[ORDERID] o4, [ENBROKEREXPOSURE].[WEIGHT] o5, [ENBROKEREXPOSURE].[BROKERSHORTCODE] o6, [ENBROKEREXPOSURE].[EXPOSURETRADEID] o7, [ENBROKEREXPOSURE].[SYSTEMCOMMENT] o8, [ENBROKEREXPOSURE].[FUNDNAME] o9&quot;</span>
        <span class="s2">&quot; FROM [outsys_prod_qa].DBO.[OSUSR_SKP_BROKEREXPOSURE] [ENBROKEREXPOSURE]&quot;</span><span class="p">)</span>

    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GetBrokerExposures</span><span class="p">)</span>
    <span class="n">resultGetBrokerExposures</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultGetBrokerExposures</span><span class="p">):</span>
        <span class="n">resGetBrokerExposures</span> <span class="o">=</span> <span class="n">resultGetBrokerExposures</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">FundCode</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">FundCode</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">FundCode</span> <span class="o">==</span> <span class="mi">7</span> <span class="ow">or</span> <span class="n">FundCode</span> <span class="o">==</span> <span class="mi">8</span> <span class="ow">or</span> <span class="n">FundCode</span> <span class="o">==</span> <span class="mi">11</span> <span class="ow">or</span> <span class="n">FundCode</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Nav</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; SELECT  [OUTSYS_PROD].DBO.[OSUSR_38P_GREATERCHINALS].[QUANTITY] AS Q&quot;</span>
                   <span class="s2">&quot; FROM  [OUTSYS_PROD].DBO.[OSUSR_38P_GREATERCHINALS]&quot;</span>
                   <span class="s2">&quot; WHERE [INSTRTYPE] = &#39;NAV&#39; AND [DATE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">CurDate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; &quot;</span><span class="p">)</span>

            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">Nav</span><span class="p">)</span>
            <span class="n">resultNav</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">resultNav</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">rNav</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rNav</span> <span class="o">=</span> <span class="n">resultNav</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># GREATER CHINA</span>
            <span class="n">GreaterChina</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; SELECT [BROKERCODE], &quot;</span>
                            <span class="s2">&quot; SUM (ABS([WEIGHT_ACTUAL])) AS WeightTot &quot;</span>
                            <span class="s2">&quot; FROM  [OUTSYS_PROD].DBO.[OSUSR_38P_GREATERCHINALS] &quot;</span>
                            <span class="s2">&quot; WHERE  [OUTSYS_PROD].DBO.[OSUSR_38P_GREATERCHINALS].[DATE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">CurDate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;  and  [OUTSYS_PROD].DBO.[OSUSR_38P_GREATERCHINALS].[INSTRTYPE] = &#39;SW&#39; &quot;</span>
                           <span class="s2">&quot; GROUP BY [BROKERCODE] &quot;</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GreaterChina</span><span class="p">)</span>
            <span class="n">resultGreaterChina</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">resultGreaterChina</span> <span class="o">!=</span> <span class="p">[]:</span>

                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultGreaterChina</span><span class="p">):</span>
                    <span class="n">resGreaterChina</span> <span class="o">=</span> <span class="n">resultGreaterChina</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">BrokerShortCode</span> <span class="o">=</span> <span class="n">resGreaterChina</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">WeightTot</span> <span class="o">=</span> <span class="n">resGreaterChina</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                    <span class="n">FundID</span> <span class="o">=</span> <span class="mi">3</span>

                    <span class="n">GetBrokersByShortCode</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;SELECT  [ENBROKER].[ID] o0, [ENBROKER].[RELATIONTIPE] o1, [ENBROKER].[MACROFUNCTION] o2, [ENBROKER].[NAME] o3, [ENBROKER].[C4F_FUNDSBROKERCODE] o4, [ENBROKER].[SHORTCODE] o5, [ENBROKER].[ASSETCLASS] o6, [ENBROKER].[PHONE] o7, [ENBROKER].[ADDRESS] o8, [ENBROKER].[INFO] o9, [ENBROKER].[MAILINGLIST] o10, [ENBROKER].[MAILINGLIST_SIT_BANORCAP] o11, [ENBROKER].[CREATEDON] o12, [ENBROKER].[UPDATEDON] o13, [ENBROKER].[FAX] o14, [ENBROKER].[CONSISTENCYISSUE] o15, [ENBROKER].[UPDATEDBY] o16, [ENBROKER].[LASTSYSTOSALSEFORCECON] o17, [ENBROKER].[IDWITHISSUES] o18, [ENBROKER].[SF_ID] o19, [ENBROKER].[DELETEDONSF] o20, [ENBROKER].[SF_LASTUPDATING] o21, [ENBROKER].[HEADQUARTER] o22, [ENBROKER].[COMPANYSIZE] o23, [ENBROKER].[WEBSITE] o24, [ENBROKER].[DO_CREATE] o25, [ENBROKER].[DO_UPDATE] o26, [ENBROKER].[KEYWORD] o27, [ENBROKER].[EMAIL] o28, [ENBROKER].[ACTIVEINCONSISTENCY] o29, [ENBROKER].[CREATEDBY] o30, [ENBROKER].[ISDA] o31, [ENBROKER].[SWAPEXPOSURE] o32, [ENBROKER].[SWAPPOOL] o33, [ENBROKER].[DELETEDFROMCRM] o34, [ENBROKER].[SUPPLIER] o35, [ENBROKER].[BIC_CODE_LEVEURO] o36, [ENBROKER].[LEIREPORTINGCODE] o37, [ENBROKER].[BROKERCODE] o38, [ENBROKER].[MASTERAGREEMENT] o39, [ENBROKER].[MASTERAGREEMENTVERSION_DATE] o40, [ENBROKER].[LEIEXPIRYDATE] o41, [ENBROKER].[COUNTRY] o42, [ENBROKER].[SBJREPORTING] o43, [ENBROKER].[NDG] o44 &quot;</span>
                            <span class="s2">&quot;FROM [OUTSYS_PROD].DBO.[OSUSR_38P_BROKER] [ENBROKER] &quot;</span>
                            <span class="s2">&quot;WHERE ([ENBROKER].[SHORTCODE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BrokerShortCode</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;) &quot;</span>
                                                                                         <span class="s2">&quot;ORDER BY [ENBROKER].[NAME] ASC &quot;</span><span class="p">)</span>

                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GetBrokersByShortCode</span><span class="p">)</span>
                    <span class="n">resultGetBrokersByShortCode</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">resultGetBrokersByShortCode</span> <span class="o">!=</span> <span class="p">[]:</span>
                        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultGetBrokersByShortCode</span><span class="p">):</span>
                            <span class="n">resGetBrokersByShortCode</span> <span class="o">=</span> <span class="n">resultGetBrokersByShortCode</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="n">BE_BrokerId</span> <span class="o">=</span> <span class="n">resGetBrokersByShortCode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">BE_FundId</span> <span class="o">=</span> <span class="n">FundID</span>
                            <span class="n">BE_ShortCode</span> <span class="o">=</span> <span class="n">BrokerShortCode</span>
                            <span class="n">BE_Weight</span> <span class="o">=</span> <span class="n">WeightTot</span>
                            <span class="n">BE_DateTime</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m-</span><span class="si">%d</span><span class="s2">-%Y %H:%M:%S.000&quot;</span><span class="p">)</span>
                            <span class="n">BE_ExposureTradeID</span> <span class="o">=</span> <span class="n">ExposureTradeID</span>
                            <span class="n">BE_FundName</span> <span class="o">=</span> <span class="s1">&#39;Greater China LS&#39;</span>

                            <span class="k">if</span> <span class="n">BrokerShortCode</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                                <span class="n">BrokerShortCode</span> <span class="o">=</span> <span class="s1">&#39; - No Broker defined - &#39;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">CreateBrokerExposure</span> <span class="o">=</span> <span class="p">(</span>
                                        <span class="s2">&quot;INSERT INTO [outsys_prod_qa].DBO.[OSUSR_SKP_BROKEREXPOSURE](BROKERID, FUNDID, BROKERSHORTCODE, WEIGHT, DATETIME, EXPOSURETRADEID, FUNDNAME)values(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">BE_BrokerId</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BE_FundId</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BE_ShortCode</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">BE_Weight</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BE_DateTime</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">BE_ExposureTradeID</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BE_FundName</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;)&quot;</span><span class="p">)</span>
                                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">CreateBrokerExposure</span><span class="p">)</span>
                                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>


            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="c1"># AMERICA</span>
            <span class="n">Nav2</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; (SELECT  [OUTSYS_PROD].DBO.[OSUSR_38P_NORTHAMERICALS].[QUANTITY] AS Q&quot;</span>
                    <span class="s2">&quot; FROM  [OUTSYS_PROD].DBO.[OSUSR_38P_NORTHAMERICALS]&quot;</span>
                    <span class="s2">&quot; WHERE [INSTRTYPE] = &#39;NAV&#39; AND [DATE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">CurDate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;) &quot;</span><span class="p">)</span>

            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">Nav2</span><span class="p">)</span>
            <span class="n">resultNav2</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">resultNav2</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">rNav2</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rNav2</span> <span class="o">=</span> <span class="n">resultNav2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">America</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; SELECT [BROKERCODE], &quot;</span>
                       <span class="s2">&quot; SUM (ABS([WEIGHT_ACTUAL])) AS WeightTot &quot;</span>
                       <span class="s2">&quot; FROM  [OUTSYS_PROD].DBO.[OSUSR_38P_NORTHAMERICALS] &quot;</span>
                       <span class="s2">&quot; WHERE  [OUTSYS_PROD].DBO.[OSUSR_38P_NORTHAMERICALS].[DATE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">CurDate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; and  [OUTSYS_PROD].DBO.[OSUSR_38P_NORTHAMERICALS].[INSTRTYPE] = &#39;SW&#39; &quot;</span>
                           <span class="s2">&quot; GROUP BY [BROKERCODE] &quot;</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">America</span><span class="p">)</span>
            <span class="n">resultAmerica</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">resultAmerica</span> <span class="o">!=</span> <span class="p">[]:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultAmerica</span><span class="p">):</span>
                    <span class="n">resAmerica</span> <span class="o">=</span> <span class="n">resultAmerica</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">BrokerShortCode2</span> <span class="o">=</span> <span class="n">resAmerica</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">WeightTot2</span> <span class="o">=</span> <span class="n">resAmerica</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">FundID2</span> <span class="o">=</span> <span class="mi">2</span>
                    <span class="n">GetBrokersByShortCode2</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;SELECT  [ENBROKER].[ID] o0, [ENBROKER].[RELATIONTIPE] o1, [ENBROKER].[MACROFUNCTION] o2, [ENBROKER].[NAME] o3, [ENBROKER].[C4F_FUNDSBROKERCODE] o4, [ENBROKER].[SHORTCODE] o5, [ENBROKER].[ASSETCLASS] o6, [ENBROKER].[PHONE] o7, [ENBROKER].[ADDRESS] o8, [ENBROKER].[INFO] o9, [ENBROKER].[MAILINGLIST] o10, [ENBROKER].[MAILINGLIST_SIT_BANORCAP] o11, [ENBROKER].[CREATEDON] o12, [ENBROKER].[UPDATEDON] o13, [ENBROKER].[FAX] o14, [ENBROKER].[CONSISTENCYISSUE] o15, [ENBROKER].[UPDATEDBY] o16, [ENBROKER].[LASTSYSTOSALSEFORCECON] o17, [ENBROKER].[IDWITHISSUES] o18, [ENBROKER].[SF_ID] o19, [ENBROKER].[DELETEDONSF] o20, [ENBROKER].[SF_LASTUPDATING] o21, [ENBROKER].[HEADQUARTER] o22, [ENBROKER].[COMPANYSIZE] o23, [ENBROKER].[WEBSITE] o24, [ENBROKER].[DO_CREATE] o25, [ENBROKER].[DO_UPDATE] o26, [ENBROKER].[KEYWORD] o27, [ENBROKER].[EMAIL] o28, [ENBROKER].[ACTIVEINCONSISTENCY] o29, [ENBROKER].[CREATEDBY] o30, [ENBROKER].[ISDA] o31, [ENBROKER].[SWAPEXPOSURE] o32, [ENBROKER].[SWAPPOOL] o33, [ENBROKER].[DELETEDFROMCRM] o34, [ENBROKER].[SUPPLIER] o35, [ENBROKER].[BIC_CODE_LEVEURO] o36, [ENBROKER].[LEIREPORTINGCODE] o37, [ENBROKER].[BROKERCODE] o38, [ENBROKER].[MASTERAGREEMENT] o39, [ENBROKER].[MASTERAGREEMENTVERSION_DATE] o40, [ENBROKER].[LEIEXPIRYDATE] o41, [ENBROKER].[COUNTRY] o42, [ENBROKER].[SBJREPORTING] o43, [ENBROKER].[NDG] o44 &quot;</span>
                            <span class="s2">&quot;FROM [OUTSYS_PROD].DBO.[OSUSR_38P_BROKER] [ENBROKER] &quot;</span>
                            <span class="s2">&quot;WHERE ([ENBROKER].[SHORTCODE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BrokerShortCode2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;) &quot;</span>
                                                                                          <span class="s2">&quot;ORDER BY [ENBROKER].[NAME] ASC &quot;</span><span class="p">)</span>
                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GetBrokersByShortCode2</span><span class="p">)</span>
                    <span class="n">resultGetBrokersByShortCode2</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">resultGetBrokersByShortCode2</span> <span class="o">!=</span> <span class="p">[]:</span>
                        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultGetBrokersByShortCode2</span><span class="p">):</span>
                            <span class="n">resGetBrokersByShortCode2</span> <span class="o">=</span> <span class="n">resultGetBrokersByShortCode2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="n">BE_BrokerId2</span> <span class="o">=</span> <span class="n">resGetBrokersByShortCode2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">BE_FundId2</span> <span class="o">=</span> <span class="n">FundID2</span>
                            <span class="n">BE_ShortCode2</span> <span class="o">=</span> <span class="n">BrokerShortCode2</span>
                            <span class="n">BE_Weight2</span> <span class="o">=</span> <span class="n">WeightTot2</span>
                            <span class="n">BE_DateTime2</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m-</span><span class="si">%d</span><span class="s2">-%Y %H:%M:%S.000&quot;</span><span class="p">)</span>
                            <span class="n">BE_ExposureTradeID2</span> <span class="o">=</span> <span class="n">ExposureTradeID</span>
                            <span class="n">BE_FundName2</span> <span class="o">=</span> <span class="s1">&#39;North America LS&#39;</span>
                            <span class="k">if</span> <span class="n">BrokerShortCode2</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                                <span class="n">BrokerShortCode2</span> <span class="o">=</span> <span class="s1">&#39; - No Broker defined - &#39;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">CreateBrokerExposure2</span> <span class="o">=</span> <span class="p">(</span>
                                        <span class="s2">&quot;INSERT INTO [outsys_prod_qa].DBO.[OSUSR_SKP_BROKEREXPOSURE](BROKERID, FUNDID, BROKERSHORTCODE, WEIGHT, DATETIME, EXPOSURETRADEID, FUNDNAME)values(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">BE_BrokerId2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BE_FundId2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BE_ShortCode2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">BE_Weight2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BE_DateTime2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">BE_ExposureTradeID2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BE_FundName2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;)&quot;</span><span class="p">)</span>
                                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">CreateBrokerExposure2</span><span class="p">)</span>
                                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="c1"># Italy</span>
            <span class="n">Nav3</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; (SELECT  [OUTSYS_PROD].DBO.[OSUSR_38P_ITALYLS].[QUANTITY] AS Q&quot;</span>
                    <span class="s2">&quot; FROM  [OUTSYS_PROD].DBO.[OSUSR_38P_ITALYLS]&quot;</span>
                    <span class="s2">&quot; WHERE [INSTRTYPE] = &#39;NAV&#39; AND [DATE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">CurDate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;) &quot;</span><span class="p">)</span>

            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">Nav3</span><span class="p">)</span>
            <span class="n">resultNav3</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">resultNav3</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">rNav3</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rNav3</span> <span class="o">=</span> <span class="n">resultNav3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Italy</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; SELECT [BROKERCODE], SUM (ABS([WEIGHT_ACTUAL])) AS WeightTot &quot;</span>
                     <span class="s2">&quot; FROM  [OUTSYS_PROD].DBO.[OSUSR_38P_ITALYLS].[QUANTITY] &quot;</span>
                     <span class="s2">&quot; WHERE  [OUTSYS_PROD].DBO.[OSUSR_38P_ITALYLS].[QUANTITY].[DATE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">CurDate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; and  [OUTSYS_PROD].DBO.[OSUSR_38P_ITALYLS].[QUANTITY].[INSTRTYPE] = &#39;NAV&#39; &quot;</span>
                           <span class="s2">&quot; GROUP BY [BROKERCODE] &quot;</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">Italy</span><span class="p">)</span>
            <span class="n">resultItaly</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">resultItaly</span> <span class="o">!=</span> <span class="p">[]:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultItaly</span><span class="p">):</span>
                    <span class="n">resItaly</span> <span class="o">=</span> <span class="n">resultItaly</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">BrokerShortCode3</span> <span class="o">=</span> <span class="n">resItaly</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">WeightTot3</span> <span class="o">=</span> <span class="n">resItaly</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">FundID3</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">GetBrokersByShortCode3</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;SELECT  [ENBROKER].[ID] o0, [ENBROKER].[RELATIONTIPE] o1, [ENBROKER].[MACROFUNCTION] o2, [ENBROKER].[NAME] o3, [ENBROKER].[C4F_FUNDSBROKERCODE] o4, [ENBROKER].[SHORTCODE] o5, [ENBROKER].[ASSETCLASS] o6, [ENBROKER].[PHONE] o7, [ENBROKER].[ADDRESS] o8, [ENBROKER].[INFO] o9, [ENBROKER].[MAILINGLIST] o10, [ENBROKER].[MAILINGLIST_SIT_BANORCAP] o11, [ENBROKER].[CREATEDON] o12, [ENBROKER].[UPDATEDON] o13, [ENBROKER].[FAX] o14, [ENBROKER].[CONSISTENCYISSUE] o15, [ENBROKER].[UPDATEDBY] o16, [ENBROKER].[LASTSYSTOSALSEFORCECON] o17, [ENBROKER].[IDWITHISSUES] o18, [ENBROKER].[SF_ID] o19, [ENBROKER].[DELETEDONSF] o20, [ENBROKER].[SF_LASTUPDATING] o21, [ENBROKER].[HEADQUARTER] o22, [ENBROKER].[COMPANYSIZE] o23, [ENBROKER].[WEBSITE] o24, [ENBROKER].[DO_CREATE] o25, [ENBROKER].[DO_UPDATE] o26, [ENBROKER].[KEYWORD] o27, [ENBROKER].[EMAIL] o28, [ENBROKER].[ACTIVEINCONSISTENCY] o29, [ENBROKER].[CREATEDBY] o30, [ENBROKER].[ISDA] o31, [ENBROKER].[SWAPEXPOSURE] o32, [ENBROKER].[SWAPPOOL] o33, [ENBROKER].[DELETEDFROMCRM] o34, [ENBROKER].[SUPPLIER] o35, [ENBROKER].[BIC_CODE_LEVEURO] o36, [ENBROKER].[LEIREPORTINGCODE] o37, [ENBROKER].[BROKERCODE] o38, [ENBROKER].[MASTERAGREEMENT] o39, [ENBROKER].[MASTERAGREEMENTVERSION_DATE] o40, [ENBROKER].[LEIEXPIRYDATE] o41, [ENBROKER].[COUNTRY] o42, [ENBROKER].[SBJREPORTING] o43, [ENBROKER].[NDG] o44 &quot;</span>
                            <span class="s2">&quot;FROM [outsys_prod_qa].DBO.[OSUSR_38P_BROKER] [ENBROKER] &quot;</span>
                            <span class="s2">&quot;WHERE ([ENBROKER].[SHORTCODE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BrokerShortCode3</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;) &quot;</span>
                                                                                          <span class="s2">&quot;ORDER BY [ENBROKER].[NAME] ASC &quot;</span><span class="p">)</span>

                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GetBrokersByShortCode3</span><span class="p">)</span>
                    <span class="n">resultGetBrokersByShortCode3</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">resultGetBrokersByShortCode3</span> <span class="o">!=</span> <span class="p">[]:</span>
                        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultGetBrokersByShortCode3</span><span class="p">):</span>
                            <span class="n">resGetBrokersByShortCode3</span> <span class="o">=</span> <span class="n">resultGetBrokersByShortCode3</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="n">BE_BrokerId3</span> <span class="o">=</span> <span class="n">resGetBrokersByShortCode3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">BE_FundId3</span> <span class="o">=</span> <span class="n">FundID3</span>
                            <span class="n">BE_ShortCode3</span> <span class="o">=</span> <span class="n">BrokerShortCode3</span>
                            <span class="n">BE_Weight3</span> <span class="o">=</span> <span class="n">WeightTot3</span>
                            <span class="n">BE_DateTime3</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m-</span><span class="si">%d</span><span class="s2">-%Y %H:%M:%S.000&quot;</span><span class="p">)</span>
                            <span class="n">BE_ExposureTradeID3</span> <span class="o">=</span> <span class="n">ExposureTradeID</span>
                            <span class="n">BE_FundName3</span> <span class="o">=</span> <span class="s1">&#39;Italy LS&#39;</span>
                            <span class="k">if</span> <span class="n">BrokerShortCode3</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                                <span class="n">BrokerShortCode3</span> <span class="o">=</span> <span class="s1">&#39; - No Broker defined - &#39;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">CreateBrokerExposure3</span> <span class="o">=</span> <span class="p">(</span>
                                        <span class="s2">&quot;INSERT INTO [outsys_prod_qa].DBO.[OSUSR_SKP_BROKEREXPOSURE](BROKERID, FUNDID, BROKERSHORTCODE, WEIGHT, DATETIME, EXPOSURETRADEID, FUNDNAME)values(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">BE_BrokerId3</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BE_FundId3</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BE_ShortCode3</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">BE_Weight3</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BE_DateTime3</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">BE_ExposureTradeID3</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BE_FundName3</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;)&quot;</span><span class="p">)</span>
                                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">CreateBrokerExposure3</span><span class="p">)</span>
                                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="c1"># Frontiers</span>
            <span class="n">Nav4</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; SELECT  [outsys_prod_qa].DBO.[OSUSR_BOL_NEWFRONTIERS].[QUANTITY] AS Q&quot;</span>
                    <span class="s2">&quot; FROM  [outsys_prod_qa].DBO.[OSUSR_BOL_NEWFRONTIERS]&quot;</span>
                    <span class="s2">&quot; WHERE [INSTRTYPE] = &#39;NAV&#39; AND [DATE] =&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">CurDate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; &quot;</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">Nav4</span><span class="p">)</span>
            <span class="n">resultNav4</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">resultNav4</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">rNav4</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rNav4</span> <span class="o">=</span> <span class="n">resultNav4</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Frontiers</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; SELECT [BROKERCODE], &quot;</span>
                         <span class="s2">&quot; SUM (ABS([WEIGHT_ACTUAL])) AS WeightTot &quot;</span>
                         <span class="s2">&quot; FROM  [outsys_prod_qa].DBO.[OSUSR_BOL_NEWFRONTIERS].[QUANTITY] &quot;</span>
                         <span class="s2">&quot; WHERE  [outsys_prod_qa].DBO.[OSUSR_BOL_NEWFRONTIERS].[QUANTITY].[DATE] = &#39;2021-10-25&#39; and  [outsys_prod_qa].DBO.[OSUSR_BOL_NEWFRONTIERS].[QUANTITY].[INSTRTYPE] = &#39;NAV&#39; &quot;</span>
                         <span class="s2">&quot; GROUP BY [BROKERCODE] &quot;</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">Frontiers</span><span class="p">)</span>
            <span class="n">resultFrontiers</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">resultFrontiers</span> <span class="o">!=</span> <span class="p">[]:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultFrontiers</span><span class="p">):</span>
                    <span class="n">resFrontiers</span> <span class="o">=</span> <span class="n">resultFrontiers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">BrokerShortCode4</span> <span class="o">=</span> <span class="n">resFrontiers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">WeightTot4</span> <span class="o">=</span> <span class="n">resFrontiers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">FundID4</span> <span class="o">=</span> <span class="mi">10</span>
                    <span class="n">GetBrokersByShortCode4</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;SELECT  [ENBROKER].[ID] o0, [ENBROKER].[RELATIONTIPE] o1, [ENBROKER].[MACROFUNCTION] o2, [ENBROKER].[NAME] o3, [ENBROKER].[C4F_FUNDSBROKERCODE] o4, [ENBROKER].[SHORTCODE] o5, [ENBROKER].[ASSETCLASS] o6, [ENBROKER].[PHONE] o7, [ENBROKER].[ADDRESS] o8, [ENBROKER].[INFO] o9, [ENBROKER].[MAILINGLIST] o10, [ENBROKER].[MAILINGLIST_SIT_BANORCAP] o11, [ENBROKER].[CREATEDON] o12, [ENBROKER].[UPDATEDON] o13, [ENBROKER].[FAX] o14, [ENBROKER].[CONSISTENCYISSUE] o15, [ENBROKER].[UPDATEDBY] o16, [ENBROKER].[LASTSYSTOSALSEFORCECON] o17, [ENBROKER].[IDWITHISSUES] o18, [ENBROKER].[SF_ID] o19, [ENBROKER].[DELETEDONSF] o20, [ENBROKER].[SF_LASTUPDATING] o21, [ENBROKER].[HEADQUARTER] o22, [ENBROKER].[COMPANYSIZE] o23, [ENBROKER].[WEBSITE] o24, [ENBROKER].[DO_CREATE] o25, [ENBROKER].[DO_UPDATE] o26, [ENBROKER].[KEYWORD] o27, [ENBROKER].[EMAIL] o28, [ENBROKER].[ACTIVEINCONSISTENCY] o29, [ENBROKER].[CREATEDBY] o30, [ENBROKER].[ISDA] o31, [ENBROKER].[SWAPEXPOSURE] o32, [ENBROKER].[SWAPPOOL] o33, [ENBROKER].[DELETEDFROMCRM] o34, [ENBROKER].[SUPPLIER] o35, [ENBROKER].[BIC_CODE_LEVEURO] o36, [ENBROKER].[LEIREPORTINGCODE] o37, [ENBROKER].[BROKERCODE] o38, [ENBROKER].[MASTERAGREEMENT] o39, [ENBROKER].[MASTERAGREEMENTVERSION_DATE] o40, [ENBROKER].[LEIEXPIRYDATE] o41, [ENBROKER].[COUNTRY] o42, [ENBROKER].[SBJREPORTING] o43, [ENBROKER].[NDG] o44 &quot;</span>
                            <span class="s2">&quot;FROM [outsys_prod_qa].DBO.[OSUSR_38P_BROKER] [ENBROKER] &quot;</span>
                            <span class="s2">&quot;WHERE ([ENBROKER].[SHORTCODE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BrokerShortCode4</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;) &quot;</span>
                                                                                          <span class="s2">&quot;ORDER BY [ENBROKER].[NAME] ASC &quot;</span><span class="p">)</span>
                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GetBrokersByShortCode4</span><span class="p">)</span>
                    <span class="n">resultGetBrokersByShortCode4</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">resultGetBrokersByShortCode4</span> <span class="o">!=</span> <span class="p">[]:</span>
                        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultGetBrokersByShortCode4</span><span class="p">):</span>
                            <span class="n">resGetBrokersByShortCode4</span> <span class="o">=</span> <span class="n">resultGetBrokersByShortCode4</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="n">BE_BrokerId4</span> <span class="o">=</span> <span class="n">resGetBrokersByShortCode4</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">BE_FundId4</span> <span class="o">=</span> <span class="n">FundID4</span>
                            <span class="n">BE_ShortCode4</span> <span class="o">=</span> <span class="n">BrokerShortCode4</span>
                            <span class="n">BE_Weight4</span> <span class="o">=</span> <span class="n">WeightTot4</span>
                            <span class="n">BE_DateTime4</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m-</span><span class="si">%d</span><span class="s2">-%Y %H:%M:%S.000&quot;</span><span class="p">)</span>
                            <span class="n">BE_ExposureTradeID4</span> <span class="o">=</span> <span class="n">ExposureTradeID</span>
                            <span class="n">BE_FundName4</span> <span class="o">=</span> <span class="s1">&#39;New Frontiers&#39;</span>
                            <span class="k">if</span> <span class="n">BrokerShortCode4</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                                <span class="n">BrokerShortCode4</span> <span class="o">=</span> <span class="s1">&#39; - No Broker defined - &#39;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">CreateBrokerExposure4</span> <span class="o">=</span> <span class="p">(</span>
                                        <span class="s2">&quot;INSERT INTO [outsys_prod_qa].DBO.[OSUSR_SKP_BROKEREXPOSURE](BROKERID, FUNDID, BROKERSHORTCODE, WEIGHT, DATETIME, EXPOSURETRADEID, FUNDNAME)values(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">BE_BrokerId4</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BE_FundId4</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BE_ShortCode4</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">BE_Weight4</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BE_DateTime4</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">BE_ExposureTradeID4</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BE_FundName4</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;)&quot;</span><span class="p">)</span>
                                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">CreateBrokerExposure4</span><span class="p">)</span>
                                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                                <span class="c1"># Rosemary</span>
            <span class="n">Nav5</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; SELECT  [outsys_prod_qa].DBO.[OSUSR_BOL_ROSEMARY].[QUANTITY] AS Q&quot;</span>
                    <span class="s2">&quot; FROM  [outsys_prod_qa].DBO.[OSUSR_BOL_ROSEMARY]&quot;</span>
                    <span class="s2">&quot; WHERE [INSTRTYPE] = &#39;NAV&#39; AND [DATE] =&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">CurDate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; &quot;</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">Nav5</span><span class="p">)</span>
            <span class="n">resultNav5</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">resultNav5</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">rNav5</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rNav5</span> <span class="o">=</span> <span class="n">resultNav5</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Rosemary</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; SELECT [BROKERCODE], &quot;</span>
                        <span class="s2">&quot; SUM (ABS([WEIGHT_ACTUAL])) AS WeightTot &quot;</span>
                        <span class="s2">&quot; FROM  [outsys_prod_qa].DBO.[OSUSR_BOL_ROSEMARY].[QUANTITY] &quot;</span>
                        <span class="s2">&quot; WHERE  [outsys_prod_qa].DBO.[OSUSR_BOL_ROSEMARY].[QUANTITY].[DATE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">CurDate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; and  [outsys_prod_qa].DBO.[OSUSR_BOL_ROSEMARY].[QUANTITY].[INSTRTYPE] = &#39;NAV&#39; &quot;</span>
                           <span class="s2">&quot; GROUP BY [BROKERCODE] &quot;</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">Rosemary</span><span class="p">)</span>
            <span class="n">resultRosemary</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">resultRosemary</span> <span class="o">!=</span> <span class="p">[]:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultRosemary</span><span class="p">):</span>
                    <span class="n">resRosemary</span> <span class="o">=</span> <span class="n">resultRosemary</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">BrokerShortCode5</span> <span class="o">=</span> <span class="n">resRosemary</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">WeightTot5</span> <span class="o">=</span> <span class="n">resRosemary</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">FundID5</span> <span class="o">=</span> <span class="mi">6</span>
                    <span class="n">GetBrokersByShortCode5</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;SELECT  [ENBROKER].[ID] o0, [ENBROKER].[RELATIONTIPE] o1, [ENBROKER].[MACROFUNCTION] o2, [ENBROKER].[NAME] o3, [ENBROKER].[C4F_FUNDSBROKERCODE] o4, [ENBROKER].[SHORTCODE] o5, [ENBROKER].[ASSETCLASS] o6, [ENBROKER].[PHONE] o7, [ENBROKER].[ADDRESS] o8, [ENBROKER].[INFO] o9, [ENBROKER].[MAILINGLIST] o10, [ENBROKER].[MAILINGLIST_SIT_BANORCAP] o11, [ENBROKER].[CREATEDON] o12, [ENBROKER].[UPDATEDON] o13, [ENBROKER].[FAX] o14, [ENBROKER].[CONSISTENCYISSUE] o15, [ENBROKER].[UPDATEDBY] o16, [ENBROKER].[LASTSYSTOSALSEFORCECON] o17, [ENBROKER].[IDWITHISSUES] o18, [ENBROKER].[SF_ID] o19, [ENBROKER].[DELETEDONSF] o20, [ENBROKER].[SF_LASTUPDATING] o21, [ENBROKER].[HEADQUARTER] o22, [ENBROKER].[COMPANYSIZE] o23, [ENBROKER].[WEBSITE] o24, [ENBROKER].[DO_CREATE] o25, [ENBROKER].[DO_UPDATE] o26, [ENBROKER].[KEYWORD] o27, [ENBROKER].[EMAIL] o28, [ENBROKER].[ACTIVEINCONSISTENCY] o29, [ENBROKER].[CREATEDBY] o30, [ENBROKER].[ISDA] o31, [ENBROKER].[SWAPEXPOSURE] o32, [ENBROKER].[SWAPPOOL] o33, [ENBROKER].[DELETEDFROMCRM] o34, [ENBROKER].[SUPPLIER] o35, [ENBROKER].[BIC_CODE_LEVEURO] o36, [ENBROKER].[LEIREPORTINGCODE] o37, [ENBROKER].[BROKERCODE] o38, [ENBROKER].[MASTERAGREEMENT] o39, [ENBROKER].[MASTERAGREEMENTVERSION_DATE] o40, [ENBROKER].[LEIEXPIRYDATE] o41, [ENBROKER].[COUNTRY] o42, [ENBROKER].[SBJREPORTING] o43, [ENBROKER].[NDG] o44 &quot;</span>
                            <span class="s2">&quot;FROM [outsys_prod_qa].DBO.[OSUSR_38P_BROKER] [ENBROKER] &quot;</span>
                            <span class="s2">&quot;WHERE ([ENBROKER].[SHORTCODE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BrokerShortCode5</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;) &quot;</span>
                                                                                          <span class="s2">&quot;ORDER BY [ENBROKER].[NAME] ASC &quot;</span><span class="p">)</span>
                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GetBrokersByShortCode5</span><span class="p">)</span>
                    <span class="n">resultGetBrokersByShortCode5</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">resultGetBrokersByShortCode5</span> <span class="o">!=</span> <span class="p">[]:</span>
                        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultGetBrokersByShortCode5</span><span class="p">):</span>
                            <span class="n">resGetBrokersByShortCode5</span> <span class="o">=</span> <span class="n">resultGetBrokersByShortCode5</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="n">BE_BrokerId5</span> <span class="o">=</span> <span class="n">resGetBrokersByShortCode5</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">BE_FundId5</span> <span class="o">=</span> <span class="n">FundID5</span>
                            <span class="n">BE_ShortCode5</span> <span class="o">=</span> <span class="n">BrokerShortCode5</span>
                            <span class="n">BE_Weight5</span> <span class="o">=</span> <span class="n">WeightTot5</span>
                            <span class="n">BE_DateTime5</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m-</span><span class="si">%d</span><span class="s2">-%Y %H:%M:%S.000&quot;</span><span class="p">)</span>
                            <span class="n">BE_ExposureTradeID5</span> <span class="o">=</span> <span class="n">ExposureTradeID</span>
                            <span class="n">BE_FundName5</span> <span class="o">=</span> <span class="s1">&#39;Rosemary&#39;</span>
                            <span class="k">if</span> <span class="n">BrokerShortCode5</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                                <span class="n">BrokerShortCode5</span> <span class="o">=</span> <span class="s1">&#39; - No Broker defined - &#39;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">CreateBrokerExposure5</span> <span class="o">=</span> <span class="p">(</span>
                                        <span class="s2">&quot;INSERT INTO [outsys_prod_qa].DBO.[OSUSR_SKP_BROKEREXPOSURE](BROKERID, FUNDID, BROKERSHORTCODE, WEIGHT, DATETIME, EXPOSURETRADEID, FUNDNAME)values(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">BE_BrokerId5</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BE_FundId5</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BE_ShortCode5</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">BE_Weight5</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BE_DateTime5</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">BE_ExposureTradeID5</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BE_FundName5</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;)&quot;</span><span class="p">)</span>
                                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">CreateBrokerExposure5</span><span class="p">)</span>
                                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="n">FindMinimum</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SELECT Min([ENBROKEREXPOSURE].[WEIGHT]) [WEIGHTMIN] &quot;</span>
                           <span class="s2">&quot;FROM ([outsys_prod_qa].DBO.[OSUSR_SKP_BROKEREXPOSURE] [ENBROKEREXPOSURE] &quot;</span>
                           <span class="s2">&quot;Left JOIN [outsys_prod_qa].DBO.[OSUSR_38P_BROKER] [ENBROKER] ON ([ENBROKEREXPOSURE].[BROKERID] = [ENBROKER].[ID]))  &quot;</span>
                           <span class="s2">&quot;WHERE ([ENBROKEREXPOSURE].[EXPOSURETRADEID] = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">ExposureTradeID</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) AND ([ENBROKEREXPOSURE].[FUNDID] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">FundCode</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; &quot;</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">FindMinimum</span><span class="p">)</span>
            <span class="n">resultFindMinimum</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">resultFindMinimum</span> <span class="o">!=</span> <span class="p">[]:</span>
                <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultFindMinimum</span><span class="p">):</span>
                    <span class="n">resFindMinimum</span> <span class="o">=</span> <span class="n">resultFindMinimum</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
                    <span class="n">MinimunWeight</span> <span class="o">=</span> <span class="n">resFindMinimum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">AssignComment</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SELECT [ENBROKEREXPOSURE].[SYSTEMCOMMENT] o0 &quot;</span>
                                     <span class="s2">&quot;FROM ([outsys_prod_qa].DBO.[OSUSR_SKP_BROKEREXPOSURE] [ENBROKEREXPOSURE]  &quot;</span>
                                     <span class="s2">&quot;Left JOIN [outsys_prod_qa].DBO.[OSUSR_38P_BROKER] [ENBROKER] ON ([ENBROKEREXPOSURE].[BROKERID] = [ENBROKER].[ID])) &quot;</span>
                                     <span class="s2">&quot;WHERE ([ENBROKEREXPOSURE].[EXPOSURETRADEID] = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                        <span class="n">ExposureTradeID</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) AND ([ENBROKEREXPOSURE].[WEIGHT] =&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">MinimunWeight</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;)&quot;</span><span class="p">)</span>
                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">AssignComment</span><span class="p">)</span>
                    <span class="n">resultAssignComment</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">resultAssignComment</span> <span class="o">==</span> <span class="p">[]:</span>
                        <span class="k">return</span> <span class="kc">None</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">SystemComment</span> <span class="o">=</span> <span class="s2">&quot;This broker should be used for new position&quot;</span>
                        <span class="n">UpdateBrokerExposure</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="s2">&quot;UPDATE [outsys_prod_qa].DBO.[OSUSR_SKP_BROKEREXPOSURE] set SYSTEMCOMMENT = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">SystemComment</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; &quot;</span>
                                             <span class="s2">&quot;Left JOIN [outsys_prod_qa].DBO.[OSUSR_38P_BROKER] [ENBROKER] ON ([ENBROKEREXPOSURE].[BROKERID] = [ENBROKER].[ID])) &quot;</span>
                                             <span class="s2">&quot;WHERE ([ENBROKEREXPOSURE].[EXPOSURETRADEID] = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">ExposureTradeID</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;) AND ([ENBROKEREXPOSURE].[WEIGHT] =&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">MinimunWeight</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;)&quot;</span><span class="p">)</span>
                        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">UpdateBrokerExposure</span><span class="p">)</span>
                        <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">ExposureTradeID</span></div>


<div class="viewcode-block" id="Broker_Selection"><a class="viewcode-back" href="../python_script_rst/funds.html#funds.Broker_Selection">[docs]</a><span class="k">def</span> <span class="nf">Broker_Selection</span><span class="p">(</span><span class="n">FundCode</span><span class="p">,</span> <span class="n">InstrType</span><span class="p">,</span> <span class="n">SecurityType</span><span class="p">,</span> <span class="n">Ticker</span><span class="p">,</span> <span class="n">BrokerID_fromPortfolio</span><span class="p">,</span> <span class="n">BrokerCode_fromPortfolio</span><span class="p">,</span>
                     <span class="n">BrokerSuggestedByUser</span><span class="p">,</span> <span class="n">FX</span><span class="p">,</span> <span class="n">Bol_BNP</span><span class="p">,</span> <span class="n">Bol_BDL</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function is used to select broker. Based on BrokerID_fromPortfolio and BrokerCode_fromPortfolio</span>

<span class="sd">    :param FundCode:  FundCode</span>
<span class="sd">    :param InstrType:  InstrumentType_1stCol</span>
<span class="sd">    :param SecurityType:  ProductType_2ndCol</span>
<span class="sd">    :param Ticker:  TickerISIN</span>
<span class="sd">    :param BrokerID_fromPortfolio:</span>
<span class="sd">    :param BrokerCode_fromPortfolio:</span>
<span class="sd">    :param BrokerSuggestedByUser: IDcontactSuggestedBroker</span>
<span class="sd">    :param FX:  Boolean field False</span>
<span class="sd">    :param Bol_BNP:  Boolean field False</span>
<span class="sd">    :param Bol_BDL:  Boolean field False</span>

<span class="sd">    :return:  out_BrokerShortCode, out_BrokerID, out_BrokerName, out_C4F_BrokerName, out_JP_MorganAccount, BrokerType_A_B, \</span>
<span class="sd">           NeedComment, BrokerSelReason, ExecutorFactor_Cost, ExposureTradeID, out_UBS_Account, out_LeiReportingCode, \</span>
<span class="sd">           out_BrokerCodeLevEuro, out_masterAgreement, out_masterAgreementVersionDate</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Broker_Selection&quot;</span><span class="p">)</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">database_dev</span><span class="p">()</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">out_BrokerShortCode</span><span class="p">,</span> <span class="n">out_BrokerID</span><span class="p">,</span> <span class="n">out_BrokerName</span><span class="p">,</span> <span class="n">out_C4F_BrokerName</span><span class="p">,</span> <span class="n">out_JP_MorganAccount</span><span class="p">,</span> <span class="n">BrokerType_A_B</span><span class="p">,</span> \
    <span class="n">NeedComment</span><span class="p">,</span> <span class="n">BrokerSelReason</span><span class="p">,</span> <span class="n">ExecutorFactor_Cost</span><span class="p">,</span> <span class="n">ExposureTradeID</span><span class="p">,</span> <span class="n">out_UBS_Account</span><span class="p">,</span> <span class="n">out_LeiReportingCode</span><span class="p">,</span> \
    <span class="n">out_BrokerCodeLevEuro</span><span class="p">,</span> <span class="n">out_masterAgreement</span><span class="p">,</span> <span class="n">out_masterAgreementVersionDate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="n">IDcontactSuggestedBroker</span> <span class="o">=</span> <span class="n">BrokerSuggestedByUser</span>
    <span class="k">if</span> <span class="n">InstrType</span> <span class="o">==</span> <span class="s2">&quot;SW&quot;</span><span class="p">:</span>
        <span class="n">ExposureTradeIDResult</span> <span class="o">=</span> <span class="n">Swap_Exposure</span><span class="p">(</span><span class="n">FundCode</span><span class="p">)</span>
        <span class="n">ExposureTradeID</span> <span class="o">=</span> <span class="n">ExposureTradeIDResult</span><span class="o">.</span><span class="n">ExposureTradeID</span>

    <span class="n">res_from_Order_Type_A_B</span> <span class="o">=</span> <span class="n">Order_Type_A_B</span><span class="p">(</span><span class="n">IDcontactSuggestedBroker</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">FX</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Bol_BNP</span><span class="p">:</span>
            <span class="n">BNP</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SELECT [ENBROKER].[ID] o0, [ENBROKER].[SHORTCODE] o1&quot;</span>
                   <span class="s2">&quot; FROM [outsys_prod_qa].DBO.[OSUSR_38P_BROKER] [ENBROKER]&quot;</span>
                   <span class="s2">&quot; WHERE ([ENBROKER].[ID] = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BrokerSuggestedByUser</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
                                                                               <span class="s2">&quot; ORDER BY [ENBROKER].[NAME] ASC &quot;</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">BNP</span><span class="p">)</span>
            <span class="n">resultBNP</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">resultBNP</span><span class="p">:</span>
                <span class="c1"># Assign FX</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultBNP</span><span class="p">):</span>
                    <span class="n">resBNP</span> <span class="o">=</span> <span class="n">resultBNP</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">out_BrokerID</span> <span class="o">=</span> <span class="n">resBNP</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">out_BrokerShortCode</span> <span class="o">=</span> <span class="n">resBNP</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                    <span class="c1"># return out_BrokerID, out_BrokerShortCode</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Bol_BDL</span><span class="p">:</span>

                <span class="n">BDL</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; SELECT [ENBROKER].[ID] o0, [ENBROKER].[SHORTCODE] o1&quot;</span>
                       <span class="s2">&quot; FROM [outsys_prod_qa].DBO.[OSUSR_38P_BROKER] [ENBROKER]&quot;</span>
                       <span class="s2">&quot; WHERE ([ENBROKER].[ID] = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BrokerSuggestedByUser</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
                                                                                   <span class="s2">&quot; ORDER BY [ENBROKER].[NAME] ASC&quot;</span><span class="p">)</span>

                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">BDL</span><span class="p">)</span>
                <span class="n">resultBDL</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">resultBDL</span><span class="p">:</span>
                    <span class="c1"># Assign FX</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultBDL</span><span class="p">):</span>
                        <span class="n">resBDL</span> <span class="o">=</span> <span class="n">resultBDL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">out_BrokerID</span> <span class="o">=</span> <span class="n">resBDL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">out_BrokerShortCode</span> <span class="o">=</span> <span class="n">resBDL</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="c1"># return out_BrokerID, out_BrokerShortCode</span>
                <span class="k">else</span><span class="p">:</span>

                    <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">GetFundById</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT [ENFUNDS].[ID] o0, [ENFUNDS].[SIMPLENAME] o1, [ENFUNDS].[NAME] o2, [ENFUNDS].[TICKER] o3, [ENFUNDS].[CRNCY] o4, [ENFUNDS].[CLASS] o5, [ENFUNDS].[FUND_CODE] o6, [ENFUNDS].[ID_ISIN] o7, [ENFUNDS].[FRONT_LOAD_FEE] o8, [ENFUNDS].[BACK_LOAD_FEE] o9, [ENFUNDS].[MNG_FEE] o10, [ENFUNDS].[PERF_FEE] o11, [ENFUNDS].[MNG_FEETILLJUNE14] o12, [ENFUNDS].[PERC_FEETILLJUNE14] o13, [ENFUNDS].[COLLOCAMENTOUBS] o14, [ENFUNDS].[COLLOCAMENTOBANORSIM] o15, [ENFUNDS].[MINFIRSTTIME_INVESTMENT] o16, [ENFUNDS].[STRATEGY] o17, [ENFUNDS].[GEOFOCUSREGION] o18, [ENFUNDS].[ASSETCLASS] o19, [ENFUNDS].[INCEPTIONDATE] o20, [ENFUNDS].[SICAV] o21, [ENFUNDS].[BENCHMARK] o22, [ENFUNDS].[DETAILSCUSTOMBENCHMARKS] o23, [ENFUNDS].[SETTLEMENT] o24, [ENFUNDS].[MORNINGSTARCATEGORY] o25, [ENFUNDS].[CUTOFF] o26, [ENFUNDS].[DEALINGPERIOD] o27, [ENFUNDS].[ADVISOR] o28, [ENFUNDS].[FX_BDL_ACCOUNT] o29, [ENFUNDS].[FX_BNP_ACCOUNT] o30, [ENFUNDS].[BASECURRENCY] o31, [ENFUNDS].[CASA4FUND_FUNDNAME] o32, [ENFUNDS].[JPMORGANACCOUNT] o33, [ENFUNDS].[UBSACCOUNT] o34&quot;</span>
                <span class="s2">&quot; FROM [outsys_prod_qa].DBO.[OSUSR_38P_FUNDS] [ENFUNDS]&quot;</span>
                <span class="s2">&quot; WHERE ([ENFUNDS].[FUND_CODE] = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">FundCode</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
                                                                     <span class="s2">&quot; ORDER BY [ENFUNDS].[NAME] ASC &quot;</span><span class="p">)</span>

        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GetFundById</span><span class="p">)</span>
        <span class="n">resultGetFundById</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">resultGetFundById</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultGetFundById</span><span class="p">):</span>
                <span class="n">resGetFundById</span> <span class="o">=</span> <span class="n">resultGetFundById</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">out_JP_MorganAccount</span> <span class="o">=</span> <span class="n">resGetFundById</span><span class="p">[</span><span class="mi">33</span><span class="p">]</span>
                <span class="n">out_UBS_Account</span> <span class="o">=</span> <span class="n">resGetFundById</span><span class="p">[</span><span class="mi">34</span><span class="p">]</span>

                <span class="n">BrokerType_A_B</span> <span class="o">=</span> <span class="n">res_from_Order_Type_A_B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">NeedComment</span> <span class="o">=</span> <span class="n">res_from_Order_Type_A_B</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">BrokerSelReason</span> <span class="o">=</span> <span class="n">res_from_Order_Type_A_B</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">ExecutorFactor_Cost</span> <span class="o">=</span> <span class="n">res_from_Order_Type_A_B</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">BrokerSuggestedByUser</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>

                    <span class="n">BrokerSuggested</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot; SELECT [ENBROKER].[ID] o0, [ENBROKER].[RELATIONTIPE] o1, [ENBROKER].[MACROFUNCTION] o2, [ENBROKER].[NAME] o3, [ENBROKER].[C4F_FUNDSBROKERCODE] o4, [ENBROKER].[SHORTCODE] o5, [ENBROKER].[ASSETCLASS] o6, [ENBROKER].[PHONE] o7, [ENBROKER].[ADDRESS] o8, [ENBROKER].[INFO] o9, [ENBROKER].[MAILINGLIST] o10, [ENBROKER].[MAILINGLIST_SIT_BANORCAP] o11, [ENBROKER].[CREATEDON] o12, [ENBROKER].[UPDATEDON] o13, [ENBROKER].[FAX] o14, [ENBROKER].[CONSISTENCYISSUE] o15, [ENBROKER].[UPDATEDBY] o16, [ENBROKER].[LASTSYSTOSALSEFORCECON] o17, [ENBROKER].[IDWITHISSUES] o18, [ENBROKER].[SF_ID] o19, [ENBROKER].[DELETEDONSF] o20, [ENBROKER].[SF_LASTUPDATING] o21, [ENBROKER].[HEADQUARTER] o22, [ENBROKER].[COMPANYSIZE] o23, [ENBROKER].[WEBSITE] o24, [ENBROKER].[DO_CREATE] o25, [ENBROKER].[DO_UPDATE] o26, [ENBROKER].[KEYWORD] o27, [ENBROKER].[EMAIL] o28, [ENBROKER].[ACTIVEINCONSISTENCY] o29, [ENBROKER].[CREATEDBY] o30, [ENBROKER].[ISDA] o31, [ENBROKER].[SWAPEXPOSURE] o32, [ENBROKER].[SWAPPOOL] o33, [ENBROKER].[DELETEDFROMCRM] o34, [ENBROKER].[SUPPLIER] o35, [ENBROKER].[BIC_CODE_LEVEURO] o36, [ENBROKER].[LEIREPORTINGCODE] o37, [ENBROKER].[BROKERCODE] o38, [ENBROKER].[MASTERAGREEMENT] o39, [ENBROKER].[MASTERAGREEMENTVERSION_DATE] o40, [ENBROKER].[LEIEXPIRYDATE] o41, [ENBROKER].[COUNTRY] o42, [ENBROKER].[SBJREPORTING] o43, [ENBROKER].[NDG] o44&quot;</span>
                            <span class="s2">&quot; FROM [outsys_prod_qa].DBO.[OSUSR_38P_BROKER] [ENBROKER]&quot;</span>
                            <span class="s2">&quot; WHERE ([ENBROKER].[ID] =&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BrokerSuggestedByUser</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
                                                                                       <span class="s2">&quot; ORDER BY [ENBROKER].[NAME] ASC &quot;</span><span class="p">)</span>
                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">BrokerSuggested</span><span class="p">)</span>
                    <span class="n">resultBrokerSuggested</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">resultBrokerSuggested</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultBrokerSuggested</span><span class="p">):</span>
                            <span class="n">resBrokerSuggested</span> <span class="o">=</span> <span class="n">resultBrokerSuggested</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                            <span class="n">out_BrokerID</span> <span class="o">=</span> <span class="n">resBrokerSuggested</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">out_BrokerShortCode</span> <span class="o">=</span> <span class="n">resBrokerSuggested</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                            <span class="n">out_BrokerName</span> <span class="o">=</span> <span class="n">resBrokerSuggested</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                            <span class="n">out_C4F_BrokerName</span> <span class="o">=</span> <span class="n">resBrokerSuggested</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                            <span class="n">out_LeiReportingCode</span> <span class="o">=</span> <span class="n">resBrokerSuggested</span><span class="p">[</span><span class="mi">37</span><span class="p">]</span>
                            <span class="n">out_BrokerCodeLevEuro</span> <span class="o">=</span> <span class="n">resBrokerSuggested</span><span class="p">[</span><span class="mi">38</span><span class="p">]</span>
                            <span class="n">out_masterAgreement</span> <span class="o">=</span> <span class="n">resBrokerSuggested</span><span class="p">[</span><span class="mi">39</span><span class="p">]</span>
                            <span class="n">out_masterAgreementVersionDate</span> <span class="o">=</span> <span class="n">resBrokerSuggested</span><span class="p">[</span><span class="mi">40</span><span class="p">]</span>

                            <span class="c1"># return out_BrokerID, out_BrokerShortCode, out_BrokerName, out_C4F_BrokerName, out_LeiReportingCode, out_BrokerCodeLevEuro, out_masterAgreement, out_masterAgreementVersionDate</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">list_Derivatives_Append</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Option&quot;</span><span class="p">,</span> <span class="s2">&quot;ETF&quot;</span><span class="p">,</span> <span class="s2">&quot;Future&quot;</span><span class="p">,</span> <span class="s2">&quot;Single Stock Future&quot;</span><span class="p">,</span> <span class="s2">&quot;Future Bond&quot;</span><span class="p">]</span>

                    <span class="n">RuleOrder</span> <span class="o">=</span> <span class="mi">1</span>

                    <span class="k">if</span> <span class="n">BrokerID_fromPortfolio</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">InstrType</span> <span class="o">==</span> <span class="s2">&quot;SW&quot;</span> <span class="ow">or</span> <span class="n">BrokerCode_fromPortfolio</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">InstrType</span> <span class="o">==</span> <span class="s2">&quot;SW&quot;</span><span class="p">:</span>

                        <span class="k">if</span> <span class="n">BrokerID_fromPortfolio</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">GetBrokerByShortCode</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="s2">&quot;SELECT [ENBROKER].[ID] o0, [ENBROKER].[RELATIONTIPE] o1, [ENBROKER].[MACROFUNCTION] o2, [ENBROKER].[NAME] o3, [ENBROKER].[C4F_FUNDSBROKERCODE] o4, [ENBROKER].[SHORTCODE] o5, [ENBROKER].[ASSETCLASS] o6, [ENBROKER].[PHONE] o7, [ENBROKER].[ADDRESS] o8, [ENBROKER].[INFO] o9, [ENBROKER].[MAILINGLIST] o10, [ENBROKER].[MAILINGLIST_SIT_BANORCAP] o11, [ENBROKER].[CREATEDON] o12, [ENBROKER].[UPDATEDON] o13, [ENBROKER].[FAX] o14, [ENBROKER].[CONSISTENCYISSUE] o15, [ENBROKER].[UPDATEDBY] o16, [ENBROKER].[LASTSYSTOSALSEFORCECON] o17, [ENBROKER].[IDWITHISSUES] o18, [ENBROKER].[SF_ID] o19, [ENBROKER].[DELETEDONSF] o20, [ENBROKER].[SF_LASTUPDATING] o21, [ENBROKER].[HEADQUARTER] o22, [ENBROKER].[COMPANYSIZE] o23, [ENBROKER].[WEBSITE] o24, [ENBROKER].[DO_CREATE] o25, [ENBROKER].[DO_UPDATE] o26, [ENBROKER].[KEYWORD] o27, [ENBROKER].[EMAIL] o28, [ENBROKER].[ACTIVEINCONSISTENCY] o29, [ENBROKER].[CREATEDBY] o30, [ENBROKER].[ISDA] o31, [ENBROKER].[SWAPEXPOSURE] o32, [ENBROKER].[SWAPPOOL] o33, [ENBROKER].[DELETEDFROMCRM] o34, [ENBROKER].[SUPPLIER] o35, [ENBROKER].[BIC_CODE_LEVEURO] o36, [ENBROKER].[LEIREPORTINGCODE] o37, [ENBROKER].[BROKERCODE] o38, [ENBROKER].[MASTERAGREEMENT] o39, [ENBROKER].[MASTERAGREEMENTVERSION_DATE] o40, [ENBROKER].[LEIEXPIRYDATE] o41, [ENBROKER].[COUNTRY] o42, [ENBROKER].[SBJREPORTING] o43, [ENBROKER].[NDG] o44&quot;</span>
                                    <span class="s2">&quot; FROM [outsys_prod_qa].DBO.[OSUSR_38P_BROKER] [ENBROKER]&quot;</span>
                                    <span class="s2">&quot; WHERE ([ENBROKER].[SHORTCODE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BrokerCode_fromPortfolio</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;)&quot;</span>
                                                                                                           <span class="s2">&quot; ORDER BY [ENBROKER].[NAME] ASC &quot;</span><span class="p">)</span>

                            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GetBrokerByShortCode</span><span class="p">)</span>
                            <span class="n">resultGetBrokerByShortCode</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

                            <span class="k">if</span> <span class="n">resultGetBrokerByShortCode</span> <span class="o">!=</span> <span class="p">[]:</span>
                                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultGetBrokerByShortCode</span><span class="p">):</span>
                                    <span class="n">resGetBrokerByShortCode</span> <span class="o">=</span> <span class="n">resultGetBrokerByShortCode</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                                    <span class="n">out_BrokerID</span> <span class="o">=</span> <span class="n">resGetBrokerByShortCode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                    <span class="n">out_BrokerShortCode</span> <span class="o">=</span> <span class="n">BrokerCode_fromPortfolio</span>
                                    <span class="n">out_BrokerName</span> <span class="o">=</span> <span class="n">resGetBrokerByShortCode</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                                    <span class="n">out_C4F_BrokerName</span> <span class="o">=</span> <span class="n">resGetBrokerByShortCode</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                                    <span class="n">out_LeiReportingCode</span> <span class="o">=</span> <span class="n">resGetBrokerByShortCode</span><span class="p">[</span><span class="mi">37</span><span class="p">]</span>
                                    <span class="n">out_BrokerCodeLevEuro</span> <span class="o">=</span> <span class="n">resGetBrokerByShortCode</span><span class="p">[</span><span class="mi">38</span><span class="p">]</span>
                                    <span class="n">out_masterAgreement</span> <span class="o">=</span> <span class="n">resGetBrokerByShortCode</span><span class="p">[</span><span class="mi">39</span><span class="p">]</span>
                                    <span class="n">out_masterAgreementVersionDate</span> <span class="o">=</span> <span class="n">resGetBrokerByShortCode</span><span class="p">[</span><span class="mi">40</span><span class="p">]</span>

                                    <span class="c1"># return out_BrokerID, out_BrokerShortCode, out_BrokerName, out_C4F_BrokerName, out_LeiReportingCode, out_BrokerCodeLevEuro, out_masterAgreement, out_masterAgreementVersionDate</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">IdFromPortfolfio</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="s2">&quot;SELECT [ENBROKER].[ID] o0, [ENBROKER].[RELATIONTIPE] o1, [ENBROKER].[MACROFUNCTION] o2, [ENBROKER].[NAME] o3, [ENBROKER].[C4F_FUNDSBROKERCODE] o4, [ENBROKER].[SHORTCODE] o5, [ENBROKER].[ASSETCLASS] o6, [ENBROKER].[PHONE] o7, [ENBROKER].[ADDRESS] o8, [ENBROKER].[INFO] o9, [ENBROKER].[MAILINGLIST] o10, [ENBROKER].[MAILINGLIST_SIT_BANORCAP] o11, [ENBROKER].[CREATEDON] o12, [ENBROKER].[UPDATEDON] o13, [ENBROKER].[FAX] o14, [ENBROKER].[CONSISTENCYISSUE] o15, [ENBROKER].[UPDATEDBY] o16, [ENBROKER].[LASTSYSTOSALSEFORCECON] o17, [ENBROKER].[IDWITHISSUES] o18, [ENBROKER].[SF_ID] o19, [ENBROKER].[DELETEDONSF] o20, [ENBROKER].[SF_LASTUPDATING] o21, [ENBROKER].[HEADQUARTER] o22, [ENBROKER].[COMPANYSIZE] o23, [ENBROKER].[WEBSITE] o24, [ENBROKER].[DO_CREATE] o25, [ENBROKER].[DO_UPDATE] o26, [ENBROKER].[KEYWORD] o27, [ENBROKER].[EMAIL] o28, [ENBROKER].[ACTIVEINCONSISTENCY] o29, [ENBROKER].[CREATEDBY] o30, [ENBROKER].[ISDA] o31, [ENBROKER].[SWAPEXPOSURE] o32, [ENBROKER].[SWAPPOOL] o33, [ENBROKER].[DELETEDFROMCRM] o34, [ENBROKER].[SUPPLIER] o35, [ENBROKER].[BIC_CODE_LEVEURO] o36, [ENBROKER].[LEIREPORTINGCODE] o37, [ENBROKER].[BROKERCODE] o38, [ENBROKER].[MASTERAGREEMENT] o39, [ENBROKER].[MASTERAGREEMENTVERSION_DATE] o40, [ENBROKER].[LEIEXPIRYDATE] o41, [ENBROKER].[COUNTRY] o42, [ENBROKER].[SBJREPORTING] o43, [ENBROKER].[NDG] o44&quot;</span>
                                    <span class="s2">&quot; FROM [outsys_prod_qa].DBO.[OSUSR_38P_BROKER] [ENBROKER]&quot;</span>
                                    <span class="s2">&quot; WHERE ([ENBROKER].[ID] =&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BrokerID_fromPortfolio</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
                                                                                                <span class="s2">&quot; ORDER BY [ENBROKER].[NAME] ASC &quot;</span><span class="p">)</span>

                            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">IdFromPortfolfio</span><span class="p">)</span>
                            <span class="n">resultIdFromPortfolfio</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

                            <span class="k">if</span> <span class="n">resultIdFromPortfolfio</span> <span class="o">!=</span> <span class="p">[]:</span>
                                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultIdFromPortfolfio</span><span class="p">):</span>
                                    <span class="n">resIdFromPortfolfio</span> <span class="o">=</span> <span class="n">resultIdFromPortfolfio</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                                    <span class="n">out_BrokerID</span> <span class="o">=</span> <span class="n">resIdFromPortfolfio</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                    <span class="n">out_BrokerShortCode</span> <span class="o">=</span> <span class="n">resIdFromPortfolfio</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                                    <span class="n">out_BrokerName</span> <span class="o">=</span> <span class="n">resIdFromPortfolfio</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                                    <span class="n">out_C4F_BrokerName</span> <span class="o">=</span> <span class="n">resIdFromPortfolfio</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                                    <span class="n">out_LeiReportingCode</span> <span class="o">=</span> <span class="n">resIdFromPortfolfio</span><span class="p">[</span><span class="mi">37</span><span class="p">]</span>
                                    <span class="n">out_BrokerCodeLevEuro</span> <span class="o">=</span> <span class="n">resIdFromPortfolfio</span><span class="p">[</span><span class="mi">38</span><span class="p">]</span>
                                    <span class="n">out_masterAgreement</span> <span class="o">=</span> <span class="n">resIdFromPortfolfio</span><span class="p">[</span><span class="mi">39</span><span class="p">]</span>
                                    <span class="n">out_masterAgreementVersionDate</span> <span class="o">=</span> <span class="n">resIdFromPortfolfio</span><span class="p">[</span><span class="mi">40</span><span class="p">]</span>

                                    <span class="c1"># return out_BrokerID, out_BrokerShortCode, out_BrokerName, out_C4F_BrokerName, out_LeiReportingCode, out_BrokerCodeLevEuro, out_masterAgreement, out_masterAgreementVersionDate</span>

                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">pass</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">GetBrokerSelectionByFundCode</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="s2">&quot; SELECT [ENBROKERSELECTION].[ID] o0, [ENBROKERSELECTION].[FUNDSIMPLENAME] o1, [ENBROKERSELECTION].[FUND_CODE] o2, [ENBROKERSELECTION].[INSTRTYPE] o3, [ENBROKERSELECTION].[SECURITYTYPE] o4, [ENBROKERSELECTION].[BROKERID] o5, [ENBROKERSELECTION].[BROKERSELECTIONMETHOD] o6, [ENBROKERSELECTION].[RULEORDER] o7, [ENBROKERSELECTION].[PARTOFTICKER] o8, [ENBROKERSELECTION].[ANYSECURITYTYPE] o9, [ENBROKERSELECTION].[USEBROKERPORTFOLIO] o10, [ENBROKERSELECTION].[DERIVATIVES] o11&quot;</span>
                                <span class="s2">&quot; FROM [outsys_prod_qa].DBO.[OSUSR_SKP_BROKERSELECTION] [ENBROKERSELECTION]&quot;</span>
                                <span class="s2">&quot; WHERE ([ENBROKERSELECTION].[FUND_CODE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">FundCode</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;) AND ([ENBROKERSELECTION].[INSTRTYPE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">InstrType</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;) AND ([ENBROKERSELECTION].[RULEORDER] = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">RuleOrder</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
                                                                                                         <span class="s2">&quot; ORDER BY [ENBROKERSELECTION].[FUNDSIMPLENAME] ASC &quot;</span><span class="p">)</span>

                        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GetBrokerSelectionByFundCode</span><span class="p">)</span>
                        <span class="n">resultGetBrokerSelectionByFundCode</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

                        <span class="k">if</span> <span class="n">resultGetBrokerSelectionByFundCode</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultGetBrokerSelectionByFundCode</span><span class="p">):</span>
                                <span class="n">resGetBrokerSelectionByFundCode</span> <span class="o">=</span> <span class="n">resultGetBrokerSelectionByFundCode</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>

                                <span class="k">if</span> <span class="n">resGetBrokerSelectionByFundCode</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span>
                                    <span class="k">continue</span>
                                <span class="k">elif</span> <span class="n">resGetBrokerSelectionByFundCode</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span>
                                    <span class="n">PartOfTheTicker</span> <span class="o">=</span> <span class="n">resGetBrokerSelectionByFundCode</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>

                                    <span class="k">if</span> <span class="n">PartOfTheTicker</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                                        <span class="k">if</span> <span class="n">PartOfTheTicker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="p">[</span><span class="mi">0</span><span class="p">:]</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                                            <span class="n">BrokerId</span> <span class="o">=</span> <span class="n">resGetBrokerSelectionByFundCode</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                                            <span class="n">Bol_BrokerAssigned</span> <span class="o">=</span> <span class="kc">True</span>

                                    <span class="k">else</span><span class="p">:</span>

                                        <span class="n">BrokerId</span> <span class="o">=</span> <span class="n">resGetBrokerSelectionByFundCode</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                                        <span class="n">Bol_BrokerAssigned</span> <span class="o">=</span> <span class="kc">True</span>

                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">continue</span>

                            <span class="k">if</span> <span class="n">Bol_BrokerAssigned</span><span class="p">:</span>

                                <span class="n">GetBrokerById</span> <span class="o">=</span> <span class="p">(</span>
                                        <span class="s2">&quot; SELECT [ENBROKER].[ID] o0, [ENBROKER].[RELATIONTIPE] o1, [ENBROKER].[MACROFUNCTION] o2, [ENBROKER].[NAME] o3, [ENBROKER].[C4F_FUNDSBROKERCODE] o4, [ENBROKER].[SHORTCODE] o5, [ENBROKER].[ASSETCLASS] o6, [ENBROKER].[PHONE] o7, [ENBROKER].[ADDRESS] o8, [ENBROKER].[INFO] o9, [ENBROKER].[MAILINGLIST] o10, [ENBROKER].[MAILINGLIST_SIT_BANORCAP] o11, [ENBROKER].[CREATEDON] o12, [ENBROKER].[UPDATEDON] o13, [ENBROKER].[FAX] o14, [ENBROKER].[CONSISTENCYISSUE] o15, [ENBROKER].[UPDATEDBY] o16, [ENBROKER].[LASTSYSTOSALSEFORCECON] o17, [ENBROKER].[IDWITHISSUES] o18, [ENBROKER].[SF_ID] o19, [ENBROKER].[DELETEDONSF] o20, [ENBROKER].[SF_LASTUPDATING] o21, [ENBROKER].[HEADQUARTER] o22, [ENBROKER].[COMPANYSIZE] o23, [ENBROKER].[WEBSITE] o24, [ENBROKER].[DO_CREATE] o25, [ENBROKER].[DO_UPDATE] o26, [ENBROKER].[KEYWORD] o27, [ENBROKER].[EMAIL] o28, [ENBROKER].[ACTIVEINCONSISTENCY] o29, [ENBROKER].[CREATEDBY] o30, [ENBROKER].[ISDA] o31, [ENBROKER].[SWAPEXPOSURE] o32, [ENBROKER].[SWAPPOOL] o33, [ENBROKER].[DELETEDFROMCRM] o34, [ENBROKER].[SUPPLIER] o35, [ENBROKER].[BIC_CODE_LEVEURO] o36, [ENBROKER].[LEIREPORTINGCODE] o37, [ENBROKER].[BROKERCODE] o38, [ENBROKER].[MASTERAGREEMENT] o39, [ENBROKER].[MASTERAGREEMENTVERSION_DATE] o40, [ENBROKER].[LEIEXPIRYDATE] o41, [ENBROKER].[COUNTRY] o42, [ENBROKER].[SBJREPORTING] o43, [ENBROKER].[NDG] o44&quot;</span>
                                        <span class="s2">&quot; FROM [outsys_prod_qa].DBO.[OSUSR_38P_BROKER] [ENBROKER]&quot;</span>
                                        <span class="s2">&quot; WHERE ([ENBROKER].[ID] =&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BrokerId</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
                                                                                      <span class="s2">&quot; ORDER BY [ENBROKER].[NAME] ASC &quot;</span><span class="p">)</span>

                                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GetBrokerById</span><span class="p">)</span>
                                <span class="n">resultGetBrokerById</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

                                <span class="k">if</span> <span class="n">resultGetBrokerById</span> <span class="o">!=</span> <span class="p">[]:</span>
                                    <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultGetBrokerById</span><span class="p">):</span>
                                        <span class="n">resGetBrokerById</span> <span class="o">=</span> <span class="n">resultGetBrokerById</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
                                        <span class="n">out_BrokerID</span> <span class="o">=</span> <span class="n">BrokerId</span>
                                        <span class="n">out_BrokerShortCode</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                                        <span class="n">out_BrokerName</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                                        <span class="n">out_C4F_BrokerName</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                                        <span class="n">out_LeiReportingCode</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">37</span><span class="p">]</span>
                                        <span class="n">out_BrokerCodeLevEuro</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">38</span><span class="p">]</span>
                                        <span class="n">out_masterAgreement</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">39</span><span class="p">]</span>
                                        <span class="n">out_masterAgreementVersionDate</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">40</span><span class="p">]</span>

                                        <span class="c1"># return out_BrokerID, out_BrokerShortCode, out_BrokerName, out_C4F_BrokerName, out_LeiReportingCode, out_BrokerCodeLevEuro, out_masterAgreement, out_masterAgreementVersionDate</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultGetBrokerSelectionByFundCode</span><span class="p">):</span>
                                    <span class="n">resGetBrokerSelectionByFundCode</span> <span class="o">=</span> <span class="n">resultGetBrokerSelectionByFundCode</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>

                                    <span class="k">if</span> <span class="n">resGetBrokerSelectionByFundCode</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span>
                                        <span class="k">continue</span>

                                    <span class="k">elif</span> <span class="n">resGetBrokerSelectionByFundCode</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span>
                                        <span class="k">continue</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="k">if</span> <span class="n">resGetBrokerSelectionByFundCode</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span> <span class="ow">in</span> <span class="n">SecurityType</span><span class="p">[</span><span class="mi">0</span><span class="p">:]</span><span class="o">.</span><span class="n">upper</span><span class="p">:</span>
                                            <span class="n">SearchSecurityType</span> <span class="o">=</span> <span class="mi">1</span>

                                            <span class="k">if</span> <span class="n">SearchSecurityType</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                                                <span class="n">PartOfTheTicker</span> <span class="o">=</span> <span class="n">resGetBrokerSelectionByFundCode</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
                                                <span class="k">if</span> <span class="n">PartOfTheTicker</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                                                    <span class="k">if</span> <span class="n">PartOfTheTicker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="p">[</span><span class="mi">0</span><span class="p">:]</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                                                        <span class="n">BrokerId</span> <span class="o">=</span> <span class="n">resGetBrokerSelectionByFundCode</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                                                        <span class="n">Bol_BrokerAssigned</span> <span class="o">=</span> <span class="kc">True</span>
                                                <span class="k">else</span><span class="p">:</span>
                                                    <span class="n">BrokerId</span> <span class="o">=</span> <span class="n">resGetBrokerSelectionByFundCode</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                                                    <span class="n">Bol_BrokerAssigned</span> <span class="o">=</span> <span class="kc">True</span>


                                            <span class="k">else</span><span class="p">:</span>
                                                <span class="k">continue</span>

                                <span class="k">if</span> <span class="n">Bol_BrokerAssigned</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                                    <span class="n">GetBrokerById</span> <span class="o">=</span> <span class="p">(</span>
                                            <span class="s2">&quot; SELECT [ENBROKER].[ID] o0, [ENBROKER].[RELATIONTIPE] o1, [ENBROKER].[MACROFUNCTION] o2, [ENBROKER].[NAME] o3, [ENBROKER].[C4F_FUNDSBROKERCODE] o4, [ENBROKER].[SHORTCODE] o5, [ENBROKER].[ASSETCLASS] o6, [ENBROKER].[PHONE] o7, [ENBROKER].[ADDRESS] o8, [ENBROKER].[INFO] o9, [ENBROKER].[MAILINGLIST] o10, [ENBROKER].[MAILINGLIST_SIT_BANORCAP] o11, [ENBROKER].[CREATEDON] o12, [ENBROKER].[UPDATEDON] o13, [ENBROKER].[FAX] o14, [ENBROKER].[CONSISTENCYISSUE] o15, [ENBROKER].[UPDATEDBY] o16, [ENBROKER].[LASTSYSTOSALSEFORCECON] o17, [ENBROKER].[IDWITHISSUES] o18, [ENBROKER].[SF_ID] o19, [ENBROKER].[DELETEDONSF] o20, [ENBROKER].[SF_LASTUPDATING] o21, [ENBROKER].[HEADQUARTER] o22, [ENBROKER].[COMPANYSIZE] o23, [ENBROKER].[WEBSITE] o24, [ENBROKER].[DO_CREATE] o25, [ENBROKER].[DO_UPDATE] o26, [ENBROKER].[KEYWORD] o27, [ENBROKER].[EMAIL] o28, [ENBROKER].[ACTIVEINCONSISTENCY] o29, [ENBROKER].[CREATEDBY] o30, [ENBROKER].[ISDA] o31, [ENBROKER].[SWAPEXPOSURE] o32, [ENBROKER].[SWAPPOOL] o33, [ENBROKER].[DELETEDFROMCRM] o34, [ENBROKER].[SUPPLIER] o35, [ENBROKER].[BIC_CODE_LEVEURO] o36, [ENBROKER].[LEIREPORTINGCODE] o37, [ENBROKER].[BROKERCODE] o38, [ENBROKER].[MASTERAGREEMENT] o39, [ENBROKER].[MASTERAGREEMENTVERSION_DATE] o40, [ENBROKER].[LEIEXPIRYDATE] o41, [ENBROKER].[COUNTRY] o42, [ENBROKER].[SBJREPORTING] o43, [ENBROKER].[NDG] o44&quot;</span>
                                            <span class="s2">&quot; FROM [outsys_prod_qa].DBO.[OSUSR_38P_BROKER] [ENBROKER]&quot;</span>
                                            <span class="s2">&quot; WHERE ([ENBROKER].[ID] =&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BrokerId</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
                                                                                          <span class="s2">&quot; ORDER BY [ENBROKER].[NAME] ASC &quot;</span><span class="p">)</span>

                                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GetBrokerById</span><span class="p">)</span>
                                    <span class="n">resultGetBrokerById</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

                                    <span class="k">if</span> <span class="n">resultGetBrokerById</span> <span class="o">!=</span> <span class="p">[]:</span>
                                        <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultGetBrokerById</span><span class="p">):</span>
                                            <span class="n">resGetBrokerById</span> <span class="o">=</span> <span class="n">resultGetBrokerById</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
                                            <span class="n">out_BrokerID</span> <span class="o">=</span> <span class="n">BrokerId</span>
                                            <span class="n">out_BrokerShortCode</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                                            <span class="n">out_BrokerName</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                                            <span class="n">out_C4F_BrokerName</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                                            <span class="n">out_LeiReportingCode</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">37</span><span class="p">]</span>
                                            <span class="n">out_BrokerCodeLevEuro</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">38</span><span class="p">]</span>
                                            <span class="n">out_masterAgreement</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">39</span><span class="p">]</span>
                                            <span class="n">out_masterAgreementVersionDate</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">40</span><span class="p">]</span>

                                            <span class="c1"># return out_BrokerID, out_BrokerShortCode, out_BrokerName, out_C4F_BrokerName, out_LeiReportingCode, out_BrokerCodeLevEuro, out_masterAgreement, out_masterAgreementVersionDate</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultGetBrokerSelectionByFundCode</span><span class="p">):</span>
                                        <span class="n">resGetBrokerSelectionByFundCode</span> <span class="o">=</span> <span class="n">resultGetBrokerSelectionByFundCode</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

                                        <span class="k">if</span> <span class="n">resGetBrokerSelectionByFundCode</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span>
                                            <span class="k">continue</span>
                                        <span class="k">elif</span> <span class="n">resGetBrokerSelectionByFundCode</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span>
                                            <span class="k">continue</span>
                                        <span class="k">elif</span> <span class="n">resGetBrokerSelectionByFundCode</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span>
                                            <span class="n">PartOfTheTicker</span> <span class="o">=</span> <span class="n">resGetBrokerSelectionByFundCode</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
                                            <span class="k">if</span> <span class="n">PartOfTheTicker</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                                                <span class="k">if</span> <span class="n">PartOfTheTicker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Ticker</span><span class="p">[</span><span class="mi">0</span><span class="p">:]</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                                                    <span class="n">SearchSecurityType1</span> <span class="o">=</span> <span class="mi">1</span>
                                                <span class="k">else</span><span class="p">:</span>
                                                    <span class="k">continue</span>

                                            <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_Derivatives_Append</span><span class="p">):</span>
                                                <span class="n">Append_Current_Element</span> <span class="o">=</span> <span class="n">list_Derivatives_Append</span><span class="p">[</span><span class="n">o</span><span class="p">]</span>

                                                <span class="k">if</span> <span class="n">Append_Current_Element</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">SecurityType</span><span class="p">[</span><span class="mi">0</span><span class="p">:]</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                                                    <span class="n">IndexResult</span> <span class="o">=</span> <span class="mi">1</span>
                                                <span class="k">else</span><span class="p">:</span>
                                                    <span class="n">IndexResult</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                                                <span class="k">if</span> <span class="n">IndexResult</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                                                    <span class="n">BrokerId</span> <span class="o">=</span> <span class="n">resGetBrokerSelectionByFundCode</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                                                    <span class="n">Bol_BrokerAssigned</span> <span class="o">=</span> <span class="kc">True</span>

                                    <span class="k">if</span> <span class="n">Bol_BrokerAssigned</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                                        <span class="n">GetBrokerById</span> <span class="o">=</span> <span class="p">(</span>
                                                <span class="s2">&quot; SELECT [ENBROKER].[ID] o0, [ENBROKER].[RELATIONTIPE] o1, [ENBROKER].[MACROFUNCTION] o2, [ENBROKER].[NAME] o3, [ENBROKER].[C4F_FUNDSBROKERCODE] o4, [ENBROKER].[SHORTCODE] o5, [ENBROKER].[ASSETCLASS] o6, [ENBROKER].[PHONE] o7, [ENBROKER].[ADDRESS] o8, [ENBROKER].[INFO] o9, [ENBROKER].[MAILINGLIST] o10, [ENBROKER].[MAILINGLIST_SIT_BANORCAP] o11, [ENBROKER].[CREATEDON] o12, [ENBROKER].[UPDATEDON] o13, [ENBROKER].[FAX] o14, [ENBROKER].[CONSISTENCYISSUE] o15, [ENBROKER].[UPDATEDBY] o16, [ENBROKER].[LASTSYSTOSALSEFORCECON] o17, [ENBROKER].[IDWITHISSUES] o18, [ENBROKER].[SF_ID] o19, [ENBROKER].[DELETEDONSF] o20, [ENBROKER].[SF_LASTUPDATING] o21, [ENBROKER].[HEADQUARTER] o22, [ENBROKER].[COMPANYSIZE] o23, [ENBROKER].[WEBSITE] o24, [ENBROKER].[DO_CREATE] o25, [ENBROKER].[DO_UPDATE] o26, [ENBROKER].[KEYWORD] o27, [ENBROKER].[EMAIL] o28, [ENBROKER].[ACTIVEINCONSISTENCY] o29, [ENBROKER].[CREATEDBY] o30, [ENBROKER].[ISDA] o31, [ENBROKER].[SWAPEXPOSURE] o32, [ENBROKER].[SWAPPOOL] o33, [ENBROKER].[DELETEDFROMCRM] o34, [ENBROKER].[SUPPLIER] o35, [ENBROKER].[BIC_CODE_LEVEURO] o36, [ENBROKER].[LEIREPORTINGCODE] o37, [ENBROKER].[BROKERCODE] o38, [ENBROKER].[MASTERAGREEMENT] o39, [ENBROKER].[MASTERAGREEMENTVERSION_DATE] o40, [ENBROKER].[LEIEXPIRYDATE] o41, [ENBROKER].[COUNTRY] o42, [ENBROKER].[SBJREPORTING] o43, [ENBROKER].[NDG] o44&quot;</span>
                                                <span class="s2">&quot; FROM [outsys_prod_qa].DBO.[OSUSR_38P_BROKER] [ENBROKER]&quot;</span>
                                                <span class="s2">&quot; WHERE ([ENBROKER].[ID] =&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BrokerId</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
                                                                                              <span class="s2">&quot; ORDER BY [ENBROKER].[NAME] ASC &quot;</span><span class="p">)</span>

                                        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GetBrokerById</span><span class="p">)</span>
                                        <span class="n">resultGetBrokerById</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

                                        <span class="k">if</span> <span class="n">resultGetBrokerById</span> <span class="o">!=</span> <span class="p">[]:</span>
                                            <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultGetBrokerById</span><span class="p">):</span>
                                                <span class="n">resGetBrokerById</span> <span class="o">=</span> <span class="n">resultGetBrokerById</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
                                                <span class="n">out_BrokerID</span> <span class="o">=</span> <span class="n">BrokerId</span>
                                                <span class="n">out_BrokerShortCode</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                                                <span class="n">out_BrokerName</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                                                <span class="n">out_C4F_BrokerName</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                                                <span class="n">out_LeiReportingCode</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">37</span><span class="p">]</span>
                                                <span class="n">out_BrokerCodeLevEuro</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">38</span><span class="p">]</span>
                                                <span class="n">out_masterAgreement</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">39</span><span class="p">]</span>
                                                <span class="n">out_masterAgreementVersionDate</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">40</span><span class="p">]</span>

                                                <span class="c1"># return out_BrokerID, out_BrokerShortCode, out_BrokerName, out_C4F_BrokerName, out_LeiReportingCode, out_BrokerCodeLevEuro, out_masterAgreement, out_masterAgreementVersionDate</span>

                                    <span class="k">elif</span> <span class="n">RuleOrder</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                                        <span class="n">GetBrokerById</span> <span class="o">=</span> <span class="p">(</span>
                                                <span class="s2">&quot; SELECT [ENBROKER].[ID] o0, [ENBROKER].[RELATIONTIPE] o1, [ENBROKER].[MACROFUNCTION] o2, [ENBROKER].[NAME] o3, [ENBROKER].[C4F_FUNDSBROKERCODE] o4, [ENBROKER].[SHORTCODE] o5, [ENBROKER].[ASSETCLASS] o6, [ENBROKER].[PHONE] o7, [ENBROKER].[ADDRESS] o8, [ENBROKER].[INFO] o9, [ENBROKER].[MAILINGLIST] o10, [ENBROKER].[MAILINGLIST_SIT_BANORCAP] o11, [ENBROKER].[CREATEDON] o12, [ENBROKER].[UPDATEDON] o13, [ENBROKER].[FAX] o14, [ENBROKER].[CONSISTENCYISSUE] o15, [ENBROKER].[UPDATEDBY] o16, [ENBROKER].[LASTSYSTOSALSEFORCECON] o17, [ENBROKER].[IDWITHISSUES] o18, [ENBROKER].[SF_ID] o19, [ENBROKER].[DELETEDONSF] o20, [ENBROKER].[SF_LASTUPDATING] o21, [ENBROKER].[HEADQUARTER] o22, [ENBROKER].[COMPANYSIZE] o23, [ENBROKER].[WEBSITE] o24, [ENBROKER].[DO_CREATE] o25, [ENBROKER].[DO_UPDATE] o26, [ENBROKER].[KEYWORD] o27, [ENBROKER].[EMAIL] o28, [ENBROKER].[ACTIVEINCONSISTENCY] o29, [ENBROKER].[CREATEDBY] o30, [ENBROKER].[ISDA] o31, [ENBROKER].[SWAPEXPOSURE] o32, [ENBROKER].[SWAPPOOL] o33, [ENBROKER].[DELETEDFROMCRM] o34, [ENBROKER].[SUPPLIER] o35, [ENBROKER].[BIC_CODE_LEVEURO] o36, [ENBROKER].[LEIREPORTINGCODE] o37, [ENBROKER].[BROKERCODE] o38, [ENBROKER].[MASTERAGREEMENT] o39, [ENBROKER].[MASTERAGREEMENTVERSION_DATE] o40, [ENBROKER].[LEIEXPIRYDATE] o41, [ENBROKER].[COUNTRY] o42, [ENBROKER].[SBJREPORTING] o43, [ENBROKER].[NDG] o44&quot;</span>
                                                <span class="s2">&quot; FROM [outsys_prod_qa].DBO.[OSUSR_38P_BROKER] [ENBROKER]&quot;</span>
                                                <span class="s2">&quot; WHERE ([ENBROKER].[ID] =&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BrokerId</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
                                                                                              <span class="s2">&quot; ORDER BY [ENBROKER].[NAME] ASC &quot;</span><span class="p">)</span>

                                        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GetBrokerById</span><span class="p">)</span>
                                        <span class="n">resultGetBrokerById</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                                        <span class="k">if</span> <span class="n">resultGetBrokerById</span><span class="p">:</span>
                                            <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultGetBrokerById</span><span class="p">):</span>
                                                <span class="n">resGetBrokerById</span> <span class="o">=</span> <span class="n">resultGetBrokerById</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
                                                <span class="n">out_BrokerID</span> <span class="o">=</span> <span class="n">BrokerId</span>
                                                <span class="n">out_BrokerShortCode</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                                                <span class="n">out_BrokerName</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                                                <span class="n">out_C4F_BrokerName</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                                                <span class="n">out_LeiReportingCode</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">37</span><span class="p">]</span>
                                                <span class="n">out_BrokerCodeLevEuro</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">38</span><span class="p">]</span>
                                                <span class="n">out_masterAgreement</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">39</span><span class="p">]</span>
                                                <span class="n">out_masterAgreementVersionDate</span> <span class="o">=</span> <span class="n">resGetBrokerById</span><span class="p">[</span><span class="mi">40</span><span class="p">]</span>
                                                <span class="c1"># return out_BrokerID, out_BrokerShortCode, out_BrokerName, out_C4F_BrokerName, out_LeiReportingCode, out_BrokerCodeLevEuro, out_masterAgreement, out_masterAgreementVersionDate</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">RuleOrder</span> <span class="o">=</span> <span class="n">RuleOrder</span> <span class="o">+</span> <span class="mi">1</span>
                                <span class="k">continue</span>
    <span class="k">return</span> <span class="n">out_BrokerShortCode</span><span class="p">,</span> <span class="n">out_BrokerID</span><span class="p">,</span> <span class="n">out_BrokerName</span><span class="p">,</span> <span class="n">out_C4F_BrokerName</span><span class="p">,</span> <span class="n">out_JP_MorganAccount</span><span class="p">,</span> <span class="n">BrokerType_A_B</span><span class="p">,</span> \
           <span class="n">NeedComment</span><span class="p">,</span> <span class="n">BrokerSelReason</span><span class="p">,</span> <span class="n">ExecutorFactor_Cost</span><span class="p">,</span> <span class="n">ExposureTradeID</span><span class="p">,</span> <span class="n">out_UBS_Account</span><span class="p">,</span> <span class="n">out_LeiReportingCode</span><span class="p">,</span> \
           <span class="n">out_BrokerCodeLevEuro</span><span class="p">,</span> <span class="n">out_masterAgreement</span><span class="p">,</span> <span class="n">out_masterAgreementVersionDate</span></div>


<div class="viewcode-block" id="CodesGeneration_Casa_4_Funds"><a class="viewcode-back" href="../python_script_rst/funds.html#funds.CodesGeneration_Casa_4_Funds">[docs]</a><span class="k">def</span> <span class="nf">CodesGeneration_Casa_4_Funds</span><span class="p">(</span><span class="n">Col_1</span><span class="p">,</span> <span class="n">Col_2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function returns Casa4FundsCode</span>

<span class="sd">    :param Col_1: Col_1</span>
<span class="sd">    :param Col_2: Col_2</span>

<span class="sd">    :return:  Casa4FundsCode</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CodesGeneration_Casa_4_Funds&quot;</span><span class="p">)</span>
    <span class="n">Casa4FundsCode</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Option Equity&quot;</span><span class="p">:</span>
        <span class="n">Casa4FundsCode</span> <span class="o">=</span> <span class="s2">&quot;Option Equity&quot;</span>

    <span class="k">elif</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Future_Index&quot;</span> <span class="ow">and</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span>
        <span class="n">Casa4FundsCode</span> <span class="o">=</span> <span class="s2">&quot;Future Index&quot;</span>

    <span class="k">elif</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Bond&quot;</span><span class="p">:</span>
        <span class="n">Casa4FundsCode</span> <span class="o">=</span> <span class="s2">&quot;Bond&quot;</span>

    <span class="k">elif</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;SW&quot;</span><span class="p">:</span>
        <span class="n">Casa4FundsCode</span> <span class="o">=</span> <span class="s2">&quot;Swap&quot;</span>

    <span class="k">elif</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity&quot;</span> <span class="ow">or</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity - REIT&quot;</span> <span class="ow">or</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity - Savings Share&quot;</span> <span class="ow">or</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity - ADR&quot;</span> <span class="ow">or</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Warrant&quot;</span> <span class="ow">or</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity - MLP&quot;</span> <span class="ow">or</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity Preference&quot;</span> <span class="ow">or</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Receipt&quot;</span><span class="p">:</span>
        <span class="n">Casa4FundsCode</span> <span class="o">=</span> <span class="s2">&quot;Equity&quot;</span>

    <span class="k">elif</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Warrant&quot;</span><span class="p">:</span>
        <span class="n">Casa4FundsCode</span> <span class="o">=</span> <span class="s2">&quot;Warrant&quot;</span>

    <span class="k">elif</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity&quot;</span> <span class="ow">or</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity - REIT&quot;</span> <span class="ow">or</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity - Savings Share&quot;</span> <span class="ow">or</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity - ADR&quot;</span> <span class="ow">or</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;ETF&quot;</span><span class="p">:</span>
        <span class="n">Casa4FundsCode</span> <span class="o">=</span> <span class="s2">&quot;ETF&quot;</span>

    <span class="k">elif</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Fund&quot;</span><span class="p">:</span>
        <span class="n">Casa4FundsCode</span> <span class="o">=</span> <span class="s2">&quot;Fund&quot;</span>

    <span class="k">elif</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;FX&quot;</span><span class="p">:</span>
        <span class="n">Casa4FundsCode</span> <span class="o">=</span> <span class="s2">&quot;FX&quot;</span>

    <span class="k">return</span> <span class="n">Casa4FundsCode</span></div>


<div class="viewcode-block" id="Value_Date_Generator"><a class="viewcode-back" href="../python_script_rst/funds.html#funds.Value_Date_Generator">[docs]</a><span class="k">def</span> <span class="nf">Value_Date_Generator</span><span class="p">(</span><span class="n">Col_1</span><span class="p">,</span> <span class="n">Col_2</span><span class="p">,</span> <span class="n">Ticker</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param Col_1: Col_1</span>
<span class="sd">    :param Col_2: Col_2</span>
<span class="sd">    :param Ticker: TickerSINI</span>
<span class="sd">    :return:  t_plus</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Value_Date_Generator&quot;</span><span class="p">)</span>
    <span class="n">t_plus</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">Col_2</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Equity&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Doubt</span>
        <span class="k">pass</span>
    <span class="c1"># elif 1 == 1:</span>
    <span class="c1">#     print(&quot;End&quot;)</span>
    <span class="c1">#     pass</span>
    <span class="k">elif</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot; US&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">t_plus</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">elif</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot; HK&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span>
            <span class="n">t_plus</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t_plus</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">elif</span> <span class="n">Ticker</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot; CH&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">t_plus</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t_plus</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">return</span> <span class="n">t_plus</span></div>


<div class="viewcode-block" id="Owl_Api"><a class="viewcode-back" href="../python_script_rst/funds.html#funds.Owl_Api">[docs]</a><span class="k">def</span> <span class="nf">Owl_Api</span><span class="p">(</span><span class="n">BBG_BrokerCode</span><span class="p">,</span> <span class="n">Col_1</span><span class="p">,</span> <span class="n">Col_2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param BBG_BrokerCode:  BBG_BrokerCode</span>
<span class="sd">    :param Col_1: Col_1</span>
<span class="sd">    :param Col_2:  Col_2</span>
<span class="sd">    :return:  API_Command</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Owl_Api&quot;</span><span class="p">)</span>
    <span class="n">API_Command</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">if</span> <span class="n">BBG_BrokerCode</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">or</span> <span class="n">Col_1</span> <span class="o">==</span> <span class="s2">&quot;SW&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity&quot;</span> <span class="ow">or</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity - REIT&quot;</span> <span class="ow">or</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity - ADR&quot;</span> <span class="ow">or</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity - Savings Share&quot;</span> <span class="ow">or</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity - Right&quot;</span> <span class="ow">or</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity - ETP&quot;</span> <span class="ow">or</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity - MLP&quot;</span> <span class="ow">or</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity B-Shares&quot;</span> <span class="ow">or</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity A-Shares&quot;</span> <span class="ow">or</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Equity Preference&quot;</span> <span class="ow">or</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Option Equity&quot;</span> <span class="ow">or</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Option Index&quot;</span> <span class="ow">or</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;EQ&quot;</span> <span class="ow">or</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;OP&quot;</span> <span class="ow">or</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;CFD&quot;</span> <span class="ow">or</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;FU&quot;</span> <span class="ow">or</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Future Index&quot;</span> <span class="ow">or</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Single stock future&quot;</span><span class="p">:</span>
                <span class="n">API_Command</span> <span class="o">=</span> <span class="s2">&quot;WaitingOwlEmsx&quot;</span>
            <span class="k">elif</span> <span class="n">Col_2</span> <span class="o">==</span> <span class="s2">&quot;Bond&quot;</span><span class="p">:</span>
                <span class="n">API_Command</span> <span class="o">=</span> <span class="s2">&quot;WaitingOwlTSOX&quot;</span>

    <span class="k">return</span> <span class="n">API_Command</span></div>


<div class="viewcode-block" id="Calculations"><a class="viewcode-back" href="../python_script_rst/funds.html#funds.Calculations">[docs]</a><span class="k">def</span> <span class="nf">Calculations</span><span class="p">(</span><span class="n">WeightTarget</span><span class="p">,</span> <span class="n">WeightActual</span><span class="p">,</span> <span class="n">FundCurrency</span><span class="p">,</span> <span class="n">StockCurrency</span><span class="p">,</span> <span class="n">ShowQuantityBox</span><span class="p">,</span> <span class="n">PreciseQuantityIndicated</span><span class="p">,</span>
                 <span class="n">Bbg_Px_Last</span><span class="p">,</span> <span class="n">ProductType_2ndCol</span><span class="p">,</span> <span class="n">NAV_or_PCvalue</span><span class="p">,</span> <span class="n">QuantityToAvoidShortSelling</span><span class="p">,</span> <span class="n">bbgCountryISO</span><span class="p">,</span>
                 <span class="n">MEA_Multiplier</span><span class="p">,</span> <span class="n">BrokeriD</span><span class="p">,</span> <span class="n">Exchange</span><span class="p">,</span> <span class="n">bbgFutContSize</span><span class="p">,</span> <span class="n">bbgOptContSize</span><span class="p">,</span> <span class="n">ExposureCalculationMethod</span><span class="p">,</span>
                 <span class="n">UnderlyingPrice</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    This function used to perform calculations based on WeightTarget,WeightActual and Quantity etc.</span>

<span class="sd">    How the value get calculated.</span>


<span class="sd">    1) CounterValueLocalCurrency = PreciseQuantityIndicated * Bbg_Px_Last / 100 \b</span>
<span class="sd">    2) Quantity = CounterValueLocalCurrency / (UnderlyingPrice / 100 * bbgFutContSize)</span>
<span class="sd">    3) CounterValueLocalCurrency = Hex_To_Decimal(CounterValueLocalCurrency)</span>
<span class="sd">    4) BrokerCommisionsBPS = CounterValueLocalCurrency * (BrokerBps / 10000)</span>
<span class="sd">    5) BrokerCommisionsCENT = QuantityRounded * Decimal(BrokerCentPerShare / 100)</span>


<span class="sd">    :param WeightTarget:  WeightTarget</span>
<span class="sd">    :param WeightActual:  WeightActual</span>
<span class="sd">    :param FundCurrency:  FundCurrency</span>
<span class="sd">    :param StockCurrency:  bbgCrncy</span>
<span class="sd">    :param ShowQuantityBox:  ShowQuantityBox</span>
<span class="sd">    :param PreciseQuantityIndicated:  TradeQuantityPreciseIndicated</span>
<span class="sd">    :param Bbg_Px_Last:  bbg_Px_Last</span>
<span class="sd">    :param ProductType_2ndCol:  ProductType_2ndCol</span>
<span class="sd">    :param NAV_or_PCvalue:  NAV</span>
<span class="sd">    :param QuantityToAvoidShortSelling:  QuantityToAvoidShortSelling</span>
<span class="sd">    :param bbgCountryISO:  bbg_Country_Iso</span>
<span class="sd">    :param MEA_Multiplier:  Multiplier</span>
<span class="sd">    :param BrokeriD:  BrokerID</span>
<span class="sd">    :param Exchange:  bbg_Exchange</span>
<span class="sd">    :param bbgFutContSize: bbg_FutContSize</span>
<span class="sd">    :param bbgOptContSize:  bbg_OptContSize</span>
<span class="sd">    :param ExposureCalculationMethod:  ExposureCalculationMethod</span>
<span class="sd">    :param UnderlyingPrice:  bbg_UnderlyingPrice</span>

<span class="sd">    :return:  CounterValueFundCurrency, CounterValueLocalCurrency, Quantity, QuantityRounded, \</span>
<span class="sd">           BrokerCommisionsBPS, BrokerBps, BrokerCentPerShare, BrokerCommisionsCENT, PotentialError, FX</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculations&quot;</span><span class="p">)</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">database_dev</span><span class="p">()</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">CounterValueFundCurrency</span><span class="p">,</span> <span class="n">CounterValueLocalCurrency</span><span class="p">,</span> <span class="n">BrokerCommisionsBPS</span><span class="p">,</span> <span class="n">BrokerBps</span><span class="p">,</span> \
    <span class="n">BrokerCentPerShare</span><span class="p">,</span> <span class="n">BrokerCommisionsCENT</span><span class="p">,</span> <span class="n">PotentialError</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span>
    <span class="n">QuantityRounded</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">WeightTarget</span> <span class="o">=</span> <span class="n">WeightTarget</span> <span class="o">/</span> <span class="mi">100</span>
    <span class="k">if</span> <span class="n">FundCurrency</span> <span class="o">==</span> <span class="n">StockCurrency</span><span class="p">:</span>
        <span class="n">Fx_FundCrncyVSfundCrncy</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">FX</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT [ENCURRENCY].[ID] o0, [ENCURRENCY].[DATE] o1, [ENCURRENCY].[TIME] o2, [ENCURRENCY].[TICKER] o3,&quot;</span>
                <span class="s2">&quot; [ENCURRENCY].[NAME] o4, [ENCURRENCY].[PX_LAST] o5, [ENCURRENCY].[MARKET_SECOTR_DES] o6, &quot;</span>
                <span class="s2">&quot;[ENCURRENCY].[SECURITY_TYP] o7, [ENCURRENCY].[SETTLE_DT] o8, [ENCURRENCY].[CURRENCY1] o9, &quot;</span>
                <span class="s2">&quot;[ENCURRENCY].[CURRENCY2] o10 FROM [outsys_prod_qa].DBO.[OSUSR_BOL_CURRENCY] [ENCURRENCY]&quot;</span>
                <span class="s2">&quot; WHERE ([ENCURRENCY].[CURRENCY1] = &#39;&quot;</span> <span class="o">+</span> <span class="n">FundCurrency</span> <span class="o">+</span> <span class="s2">&quot;&#39;) AND &quot;</span>
                                                                        <span class="s2">&quot;([ENCURRENCY].[CURRENCY2] = &#39;&quot;</span> <span class="o">+</span> <span class="n">StockCurrency</span> <span class="o">+</span> <span class="s2">&quot;&#39;) ORDER BY [ENCURRENCY].[DATE] DESC&quot;</span><span class="p">)</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">resultGet</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultGet</span><span class="p">):</span>
            <span class="n">Fx_FundCrncyVSfundCrncy</span> <span class="o">=</span> <span class="n">resultGet</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Px_Last</span>
            <span class="n">FX</span> <span class="o">=</span> <span class="n">resultGet</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Px_Last</span>

    <span class="k">if</span> <span class="n">ShowQuantityBox</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Bbg_Px_Last</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">CounterValueLocalCurrency</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Bond&quot;</span><span class="p">:</span>
                <span class="n">CounterValueLocalCurrency</span> <span class="o">=</span> <span class="p">(</span><span class="n">PreciseQuantityIndicated</span> <span class="o">*</span> <span class="n">Bbg_Px_Last</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
            <span class="k">if</span> <span class="n">StockCurrency</span> <span class="o">==</span> <span class="s2">&quot;GBp&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Future Index&quot;</span><span class="p">:</span>
                    <span class="p">(</span><span class="n">PreciseQuantityIndicated</span> <span class="o">*</span> <span class="n">Bbg_Px_Last</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">bbgFutContSize</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Equity&quot;</span><span class="p">:</span>
                    <span class="p">(</span><span class="n">PreciseQuantityIndicated</span> <span class="o">*</span> <span class="n">Bbg_Px_Last</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">bbgOptContSize</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Index&quot;</span><span class="p">:</span>
                    <span class="n">CounterValueLocalCurrency</span> <span class="o">=</span> <span class="p">(</span><span class="n">PreciseQuantityIndicated</span> <span class="o">*</span> <span class="n">Bbg_Px_Last</span> <span class="o">*</span> <span class="n">bbgOptContSize</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">CounterValueLocalCurrency</span> <span class="o">=</span> <span class="n">PreciseQuantityIndicated</span> <span class="o">*</span> <span class="n">Bbg_Px_Last</span> <span class="o">/</span> <span class="mi">100</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Future Index&quot;</span><span class="p">:</span>
                    <span class="n">CounterValueLocalCurrency</span> <span class="o">=</span> <span class="p">(</span><span class="n">PreciseQuantityIndicated</span> <span class="o">*</span> <span class="n">Bbg_Px_Last</span> <span class="o">*</span> <span class="n">bbgFutContSize</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Equity&quot;</span><span class="p">:</span>
                    <span class="n">CounterValueLocalCurrency</span> <span class="o">=</span> <span class="p">(</span><span class="n">PreciseQuantityIndicated</span> <span class="o">*</span> <span class="n">Bbg_Px_Last</span> <span class="o">*</span> <span class="n">bbgOptContSize</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Index&quot;</span><span class="p">:</span>
                    <span class="n">CounterValueLocalCurrency</span> <span class="o">=</span> <span class="n">PreciseQuantityIndicated</span> <span class="o">*</span> <span class="n">Bbg_Px_Last</span> <span class="o">*</span> <span class="n">bbgOptContSize</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">CounterValueLocalCurrency</span> <span class="o">=</span> <span class="n">PreciseQuantityIndicated</span> <span class="o">*</span> <span class="n">Bbg_Px_Last</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">CounterValueLocalCurrency</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">CounterValueLocalCurrency</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">CounterValueLocalCurrency</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">CounterValueLocalCurrency</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">CounterValueFundCurrency</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">Fx_FundCrncyVSfundCrncy</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">CounterValueFundCurrency</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">CounterValueFundCurrency</span> <span class="o">=</span> <span class="n">CounterValueLocalCurrency</span> <span class="o">/</span> <span class="n">Fx_FundCrncyVSfundCrncy</span>

        <span class="n">CounterValueFundCurrency</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">CounterValueFundCurrency</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">WeightTarget</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">bbgFutContSize</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">bbgFutContSize</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">CounterValueLocalCurrency</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">QuantityToAvoidShortSelling</span> <span class="o">*</span> <span class="n">Bbg_Px_Last</span><span class="p">)</span> <span class="o">*</span> <span class="n">bbgFutContSize</span>

        <span class="k">if</span> <span class="n">Fx_FundCrncyVSfundCrncy</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">CounterValueFundCurrency</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">CounterValueFundCurrency</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">CounterValueLocalCurrency</span> <span class="o">/</span> <span class="n">Fx_FundCrncyVSfundCrncy</span><span class="p">)</span>

        <span class="n">Quantity</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">QuantityToAvoidShortSelling</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Quantity</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">QuantityRounded1</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="n">Quantity</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Quantity</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">QuantityRounded1</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="n">Quantity</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Quantity</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">QuantityRounded1</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="n">Quantity</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">QuantityRounded1</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">Quantity</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">QuantityRounded1</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">Quantity</span><span class="p">)</span>
        <span class="n">QuantityRounded</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">QuantityRounded1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Bbg_Px_Last</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">CounterValueFundCurrency</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">CounterValueFundCurrency</span> <span class="o">=</span> <span class="n">NAV_or_PCvalue</span> <span class="o">*</span> <span class="p">(</span><span class="n">WeightTarget</span> <span class="o">-</span> <span class="n">WeightActual</span><span class="p">)</span>
        <span class="n">CounterValueFundCurrency</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">CounterValueFundCurrency</span><span class="p">)</span>

        <span class="n">CounterValueLocalCurrency</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">CounterValueFundCurrency</span> <span class="o">*</span> <span class="n">Fx_FundCrncyVSfundCrncy</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">CounterValueLocalCurrency</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">Quantity</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">StockCurrency</span> <span class="o">==</span> <span class="s2">&quot;GBp&quot;</span> <span class="ow">or</span> <span class="n">StockCurrency</span> <span class="o">==</span> <span class="s2">&quot;ZAr&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ExposureCalculationMethod</span> <span class="o">==</span> <span class="s2">&quot;Underlying&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Future Index&quot;</span> <span class="ow">or</span> \
                    <span class="n">ExposureCalculationMethod</span> <span class="o">==</span> <span class="s2">&quot;Underlying&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Equity&quot;</span> <span class="ow">or</span> \
                    <span class="n">ExposureCalculationMethod</span> <span class="o">==</span> <span class="s2">&quot;Underlying&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Index&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Future Index&quot;</span><span class="p">:</span>
                    <span class="n">Quantity</span> <span class="o">=</span> <span class="n">CounterValueLocalCurrency</span> <span class="o">/</span> <span class="p">(</span><span class="n">UnderlyingPrice</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">bbgFutContSize</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Equity&quot;</span><span class="p">:</span>
                    <span class="n">Quantity</span> <span class="o">=</span> <span class="n">CounterValueLocalCurrency</span> <span class="o">/</span> <span class="p">(</span><span class="n">UnderlyingPrice</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">bbgOptContSize</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Index&quot;</span><span class="p">:</span>
                    <span class="n">Quantity</span> <span class="o">=</span> <span class="n">CounterValueLocalCurrency</span> <span class="o">/</span> <span class="p">(</span><span class="n">UnderlyingPrice</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">bbgOptContSize</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Quantity</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">ExposureCalculationMethod</span> <span class="o">==</span> <span class="s2">&quot;Premium&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Future Index&quot;</span> <span class="ow">or</span> \
                    <span class="n">ExposureCalculationMethod</span> <span class="o">==</span> <span class="s2">&quot;Premium&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Equity&quot;</span> <span class="ow">or</span> \
                    <span class="n">ExposureCalculationMethod</span> <span class="o">==</span> <span class="s2">&quot;Premium&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Index&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Future Index&quot;</span><span class="p">:</span>
                    <span class="n">Quantity</span> <span class="o">=</span> <span class="n">CounterValueLocalCurrency</span> <span class="o">/</span> <span class="p">(</span><span class="n">Bbg_Px_Last</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">bbgFutContSize</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Equity&quot;</span><span class="p">:</span>
                    <span class="n">Quantity</span> <span class="o">=</span> <span class="n">CounterValueLocalCurrency</span> <span class="o">/</span> <span class="p">(</span><span class="n">Bbg_Px_Last</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">bbgOptContSize</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Index&quot;</span><span class="p">:</span>
                    <span class="n">Quantity</span> <span class="o">=</span> <span class="n">CounterValueLocalCurrency</span> <span class="o">/</span> <span class="p">(</span><span class="n">Bbg_Px_Last</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">bbgOptContSize</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Quantity</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">elif</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Bond&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Future Index&quot;</span> <span class="ow">or</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Equity&quot;</span> <span class="ow">or</span> \
                        <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Index&quot;</span><span class="p">:</span>
                    <span class="n">PotentialError</span> <span class="o">=</span> <span class="s2">&quot;This calculation need to be checked, the contract size has not been considered&quot;</span>
                <span class="n">Quantity</span> <span class="o">=</span> <span class="n">CounterValueLocalCurrency</span> <span class="o">/</span> <span class="p">(</span><span class="n">Bbg_Px_Last</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Future Index&quot;</span> <span class="ow">or</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Equity&quot;</span> \
                        <span class="ow">or</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Index&quot;</span><span class="p">:</span>
                    <span class="n">PotentialError</span> <span class="o">=</span> <span class="s2">&quot;This calculation need to be checked, the contract size has not been considered&quot;</span>
                <span class="n">Quantity</span> <span class="o">=</span> <span class="n">CounterValueLocalCurrency</span> <span class="o">/</span> <span class="p">(</span><span class="n">Bbg_Px_Last</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ExposureCalculationMethod</span> <span class="o">==</span> <span class="s2">&quot;Premium&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Future Index&quot;</span> <span class="ow">or</span> \
                    <span class="n">ExposureCalculationMethod</span> <span class="o">==</span> <span class="s2">&quot;Premium&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Equity&quot;</span> <span class="ow">or</span> \
                    <span class="n">ExposureCalculationMethod</span> <span class="o">==</span> <span class="s2">&quot;Premium&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Index&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Future Index&quot;</span><span class="p">:</span>
                    <span class="n">Quantity</span> <span class="o">=</span> <span class="n">CounterValueLocalCurrency</span> <span class="o">/</span> <span class="p">(</span><span class="n">UnderlyingPrice</span> <span class="o">*</span> <span class="n">bbgFutContSize</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Equity&quot;</span><span class="p">:</span>
                    <span class="n">Quantity</span> <span class="o">=</span> <span class="n">CounterValueLocalCurrency</span> <span class="o">/</span> <span class="p">(</span><span class="n">UnderlyingPrice</span> <span class="o">*</span> <span class="n">bbgOptContSize</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Index&quot;</span><span class="p">:</span>
                    <span class="n">Quantity</span> <span class="o">=</span> <span class="n">CounterValueLocalCurrency</span> <span class="o">/</span> <span class="p">(</span><span class="n">UnderlyingPrice</span> <span class="o">*</span> <span class="n">bbgOptContSize</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Quantity</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">ExposureCalculationMethod</span> <span class="o">==</span> <span class="s2">&quot;Underlying&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Future Index&quot;</span> <span class="ow">or</span> \
                    <span class="n">ExposureCalculationMethod</span> <span class="o">==</span> <span class="s2">&quot;Underlying&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Equity&quot;</span> <span class="ow">or</span> \
                    <span class="n">ExposureCalculationMethod</span> <span class="o">==</span> <span class="s2">&quot;Underlying&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Index&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Future Index&quot;</span><span class="p">:</span>
                    <span class="n">Quantity</span> <span class="o">=</span> <span class="n">CounterValueLocalCurrency</span> <span class="o">/</span> <span class="p">(</span><span class="n">Bbg_Px_Last</span> <span class="o">*</span> <span class="n">bbgFutContSize</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Equity&quot;</span><span class="p">:</span>
                    <span class="n">Quantity</span> <span class="o">=</span> <span class="n">CounterValueLocalCurrency</span> <span class="o">/</span> <span class="p">(</span><span class="n">Bbg_Px_Last</span> <span class="o">*</span> <span class="n">bbgOptContSize</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Index&quot;</span><span class="p">:</span>
                    <span class="n">Quantity</span> <span class="o">=</span> <span class="n">CounterValueLocalCurrency</span> <span class="o">/</span> <span class="p">(</span><span class="n">Bbg_Px_Last</span> <span class="o">*</span> <span class="n">bbgOptContSize</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Quantity</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">elif</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Bond&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Future Index&quot;</span> <span class="ow">or</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Equity&quot;</span> <span class="ow">or</span> \
                        <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Index&quot;</span><span class="p">:</span>
                    <span class="n">PotentialError</span> <span class="o">=</span> <span class="s2">&quot;This calculation need to be checked, the contract size has not been considered&quot;</span>
                <span class="n">Quantity</span> <span class="o">=</span> <span class="n">CounterValueLocalCurrency</span> <span class="o">/</span> <span class="p">(</span><span class="n">Bbg_Px_Last</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Future Index&quot;</span> <span class="ow">or</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Equity&quot;</span> <span class="ow">or</span> \
                        <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Index&quot;</span><span class="p">:</span>
                    <span class="n">PotentialError</span> <span class="o">=</span> <span class="s2">&quot;This calculation need to be checked, the contract size has not been considered&quot;</span>
                <span class="n">Quantity</span> <span class="o">=</span> <span class="n">CounterValueLocalCurrency</span> <span class="o">/</span> <span class="p">(</span><span class="n">Bbg_Px_Last</span><span class="p">)</span>

    <span class="n">query1</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SELECT [ENBROKER].[ID] o0, [ENBROKER].[RELATIONTIPE] o1, [ENBROKER].[MACROFUNCTION] o2,&quot;</span>
              <span class="s2">&quot; [ENBROKER].[NAME] o3, [ENBROKER].[C4F_FUNDSBROKERCODE] o4, [ENBROKER].[SHORTCODE] o5, &quot;</span>
              <span class="s2">&quot;[ENBROKER].[ASSETCLASS] o6, [ENBROKER].[PHONE] o7, [ENBROKER].[ADDRESS] o8, [ENBROKER].[INFO] o9, &quot;</span>
              <span class="s2">&quot;[ENBROKER].[MAILINGLIST] o10,[ENEXCHANGEBBG].[EXCHANGENAME] o49, [ENEXCHANGEBBG].[COUNTRY] o50,&quot;</span>
              <span class="s2">&quot; [ENEXCHANGEBBG].[REGION] o51, [ENEXCHANGEBBG].[EXCHANGECODE] o52, [ENEXCHANGEBBG].[COMPOSITECODE] o53, &quot;</span>
              <span class="s2">&quot;[ENEXCHANGEBBG].[MICCODE] o54, [ENTRADINGCOMBPS].[ID] o55, [ENTRADINGCOMBPS].[INSTRUMENT] o56, &quot;</span>
              <span class="s2">&quot;[ENTRADINGCOMBPS].[BROKER] o57, [ENTRADINGCOMBPS].[BPS] o58, [ENTRADINGCOMBPS].[MIMIMUM] o59, &quot;</span>
              <span class="s2">&quot;[ENTRADINGCOMBPS].[CENTPERSHARE] o60, [ENTRADINGCOMBPS].[NOTE] o61, [ENTRADINGCOMBPS].[COUNTRYID] o62, &quot;</span>
              <span class="s2">&quot;[ENTRADINGCOMBPS].[EXCHANGEID] o63 FROM ((([outsys_prod_qa].DBO.[OSUSR_BOL_TRADINGCOMBPS] &quot;</span>
              <span class="s2">&quot;[ENTRADINGCOMBPS] Inner JOIN [outsys_prod_qa].DBO.[OSUSR_38P_BROKER] [ENBROKER] ON&quot;</span>
              <span class="s2">&quot; ([ENTRADINGCOMBPS].[BROKER] = [ENBROKER].[ID]))  Inner JOIN [outsys_prod_qa].DBO.[OSUSR_BOL_COUNTRIESBBG]&quot;</span>
              <span class="s2">&quot; [ENCOUNTRIESBBG] ON ([ENTRADINGCOMBPS].[COUNTRYID] = [ENCOUNTRIESBBG].[ID]))  Left JOIN &quot;</span>
              <span class="s2">&quot;[outsys_prod_qa].DBO.[OSUSR_BOL_EXCHANGEBBG] [ENEXCHANGEBBG] ON &quot;</span>
              <span class="s2">&quot;([ENTRADINGCOMBPS].[EXCHANGEID] = [ENEXCHANGEBBG].[ID])) WHERE&quot;</span>
              <span class="s2">&quot; ([ENTRADINGCOMBPS].[BROKER] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BrokeriD</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;) AND&quot;</span>
                                                                   <span class="s2">&quot; (([ENEXCHANGEBBG].[EXCHANGECODE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
        <span class="n">Exchange</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;) OR&quot;</span>
                    <span class="s2">&quot; ([ENCOUNTRIESBBG].[COUNTRYISO] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
        <span class="n">bbgCountryISO</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;)) ORDER BY [ENTRADINGCOMBPS].[INSTRUMENT] ASC &quot;</span><span class="p">)</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query1</span><span class="p">)</span>
    <span class="n">resultGet1</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultGet1</span><span class="p">):</span>
        <span class="n">BrokerBps</span> <span class="o">=</span> <span class="n">resultGet1</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">58</span><span class="p">]</span>
        <span class="n">BrokerCentPerShare</span> <span class="o">=</span> <span class="n">resultGet1</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">60</span><span class="p">]</span>
        <span class="n">QuantityRounded</span> <span class="o">=</span> <span class="n">Quantity</span>
    <span class="k">if</span> <span class="n">MEA_Multiplier</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">MEA_Multiplier</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Quantity</span> <span class="o">=</span> <span class="n">Quantity</span> <span class="o">*</span> <span class="n">MEA_Multiplier</span>
        <span class="n">QuantityRounded</span> <span class="o">=</span> <span class="n">QuantityRounded</span> <span class="o">*</span> <span class="n">MEA_Multiplier</span>

    <span class="n">CounterValueLocalCurrency</span> <span class="o">=</span> <span class="n">Hex_To_Decimal</span><span class="p">(</span><span class="n">CounterValueLocalCurrency</span><span class="p">)</span>
    <span class="n">BrokerCommisionsBPS</span> <span class="o">=</span> <span class="n">CounterValueLocalCurrency</span> <span class="o">*</span> <span class="p">(</span><span class="n">BrokerBps</span> <span class="o">/</span> <span class="mi">10000</span><span class="p">)</span>
    <span class="n">BrokerCommisionsCENT</span> <span class="o">=</span> <span class="n">QuantityRounded</span> <span class="o">*</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">BrokerCentPerShare</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">CounterValueFundCurrency</span><span class="p">,</span> <span class="n">CounterValueLocalCurrency</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">,</span> <span class="n">QuantityRounded</span><span class="p">,</span> \
           <span class="n">BrokerCommisionsBPS</span><span class="p">,</span> <span class="n">BrokerBps</span><span class="p">,</span> <span class="n">BrokerCentPerShare</span><span class="p">,</span> <span class="n">BrokerCommisionsCENT</span><span class="p">,</span> <span class="n">PotentialError</span><span class="p">,</span> <span class="n">FX</span></div>


<div class="viewcode-block" id="TraderNotes"><a class="viewcode-back" href="../python_script_rst/funds.html#funds.TraderNotes">[docs]</a><span class="k">def</span> <span class="nf">TraderNotes</span><span class="p">(</span><span class="n">Ticker_ISIN</span><span class="p">,</span> <span class="n">FundID</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    This function used to get trader notes</span>

<span class="sd">    :param Ticker_ISIN:  TickerISIN</span>
<span class="sd">    :param FundID:  FundsID</span>
<span class="sd">    :return:  TraderNote</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TraderNotes&quot;</span><span class="p">)</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">database_dev</span><span class="p">()</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">FundID</span> <span class="ow">or</span> <span class="n">FundID</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">FundID</span> <span class="o">=</span> <span class="s2">&quot;NULL&quot;</span>
    <span class="n">TickerISIN</span> <span class="o">=</span> <span class="n">Ticker_ISIN</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; Equity&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; Corp&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; Index&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; Govt&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; Cmdty&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">query1</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SELECT [ENTRADERNOTES].[ID] o0, [ENTRADERNOTES].[TICKER_ISIN] o1, [ENTRADERNOTES].[NOTE] o2,&quot;</span>
              <span class="s2">&quot; [ENTRADERNOTES].[FUNDID] o3, [ENTRADERNOTES].[USERID] o4, [ENTRADERNOTES].[DATE] o5 &quot;</span>
              <span class="s2">&quot;FROM [outsys_prod_qa].DBO.[OSUSR_BOL_TRADERNOTES] [ENTRADERNOTES] WHERE &quot;</span>
              <span class="s2">&quot;(([ENTRADERNOTES].[TICKER_ISIN] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
        <span class="n">TickerISIN</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;) OR ([ENTRADERNOTES].[FUNDID] = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">FundID</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)) ORDER BY&quot;</span>
                                                                           <span class="s2">&quot; [ENTRADERNOTES].[TICKER_ISIN] ASC&quot;</span><span class="p">)</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query1</span><span class="p">)</span>
    <span class="n">GetResult1</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="n">TraderNote</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">GetResult1</span><span class="p">):</span>
        <span class="n">TraderNote_val</span> <span class="o">=</span> <span class="n">GetResult1</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">TraderNote</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TraderNote_val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">TraderNote</span></div>


<div class="viewcode-block" id="Order_Changes"><a class="viewcode-back" href="../python_script_rst/funds.html#funds.Order_Changes">[docs]</a><span class="k">def</span> <span class="nf">Order_Changes</span><span class="p">(</span><span class="n">OrderID</span><span class="p">,</span> <span class="n">UserID</span><span class="p">,</span> <span class="n">TimeCreation</span><span class="p">,</span> <span class="n">TickerISIN</span><span class="p">,</span> <span class="n">LimitPriceChanges</span><span class="p">,</span> <span class="n">ExecutedQuantity</span><span class="p">,</span> <span class="n">ChangeBroker</span><span class="p">,</span>
                  <span class="n">NewBrokerShortCode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    In this function data inserting into OSUSR_SKP_ORDERCHANGES table.</span>

<span class="sd">    :param OrderID: order id</span>
<span class="sd">    :param UserID: GetUserId</span>
<span class="sd">    :param TimeCreation: CurrTime()</span>
<span class="sd">    :param TickerISIN: TickerISIN</span>
<span class="sd">    :param LimitPriceChanges: Limit</span>
<span class="sd">    :param ExecutedQuantity: 0</span>
<span class="sd">    :param ChangeBroker: False (Boolean type)</span>
<span class="sd">    :param NewBrokerShortCode: BrokerShortCode</span>

<span class="sd">    :return: return last object id as process id.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Order_Changes ---- last process&quot;</span><span class="p">)</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">database_dev</span><span class="p">()</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">CurrTime</span> <span class="o">=</span> <span class="n">get_current_date</span><span class="p">()</span>
    <span class="n">ExecutedQuantity</span> <span class="o">=</span> <span class="n">Hex_To_Decimal</span><span class="p">(</span><span class="n">ExecutedQuantity</span><span class="p">)</span>
    <span class="n">insert_q</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;INSERT INTO [outsys_prod_qa].DBO.[OSUSR_SKP_ORDERCHANGES]([OrdersID],[TimeCreation],[TickerISIN],&quot;</span>
            <span class="s2">&quot;[LimitPriceChanges],[TimeOfChange],[ExecutedQuantity],[UserID],[BrokerHasBeenChanged],[BrokerShortCode])&quot;</span>
            <span class="s2">&quot;VALUES (&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">OrderID</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">TimeCreation</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">TickerISIN</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
        <span class="n">LimitPriceChanges</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">CurrTime</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ExecutedQuantity</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
        <span class="n">ChangeBroker</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">NewBrokerShortCode</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;)&quot;</span><span class="p">)</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">insert_q</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">OSUSR_BOL_CONTROLTICKER_ISIN_ID</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">lastrowid</span>
    <span class="k">return</span> <span class="n">OSUSR_BOL_CONTROLTICKER_ISIN_ID</span></div>


<div class="viewcode-block" id="Fund_Send"><a class="viewcode-back" href="../python_script_rst/funds.html#funds.Fund_Send">[docs]</a><span class="k">def</span> <span class="nf">Fund_Send</span><span class="p">(</span><span class="n">sStockName</span><span class="p">,</span> <span class="n">TickerISIN</span><span class="p">,</span> <span class="n">MultiplierQuantity</span><span class="p">,</span> <span class="n">lastPrice</span><span class="p">,</span> <span class="n">TradeQuantityPreciseIndicated</span><span class="p">,</span> <span class="n">fund_id</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span>
              <span class="n">userId</span><span class="p">,</span> <span class="n">cashOrSwap</span><span class="p">,</span> <span class="n">securityType</span><span class="p">,</span> <span class="n">weight_Target</span><span class="p">,</span> <span class="n">instructions</span><span class="p">,</span> <span class="n">settleDate</span><span class="p">,</span> <span class="n">suggestedBroker</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span>
              <span class="n">userName</span><span class="p">,</span> <span class="n">urgency</span><span class="p">,</span> <span class="n">expiry</span><span class="p">,</span> <span class="n">userComment</span><span class="p">,</span> <span class="n">fund</span><span class="p">,</span> <span class="n">FundNumber</span><span class="p">,</span> <span class="n">FundCurrency</span><span class="p">,</span> <span class="n">ShowQuantityBox</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    This Process get called after api get triggered.</span>

<span class="sd">    :param sStockName:  stock name ( This is the stock name)</span>
<span class="sd">    :param TickerISIN:  TickerISIN (This is the ticker input para from form)</span>
<span class="sd">    :param MultiplierQuantity:  multiplier (This will define no. stocks want to purchase)</span>
<span class="sd">    :param lastPrice:  last price (Privious closing price)</span>
<span class="sd">    :param TradeQuantityPreciseIndicated:  quantity (Qauntity take from user)</span>
<span class="sd">    :param fund_id:  fund id initially must be None</span>
<span class="sd">    :param side:  BUY Or SELL</span>
<span class="sd">    :param userId:  user id (user who gonna purchase stock)</span>
<span class="sd">    :param cashOrSwap:  cash Or Swap (The transaction type for a new position will be CASH for long and SWAP for short.)</span>
<span class="sd">    :param securityType:  securityType</span>
<span class="sd">    :param weight_Target:  weight_Target (Max target price)</span>
<span class="sd">    :param instructions:  instructions (User given instructions)</span>
<span class="sd">    :param settleDate:   settleDate</span>
<span class="sd">    :param suggestedBroker:  suggestedBroker (Consultancy broker)</span>
<span class="sd">    :param limit: limit (set limit for stop loss)</span>
<span class="sd">    :param userName: userName</span>
<span class="sd">    :param urgency:  urgency Normal,High, Urgent</span>
<span class="sd">    :param expiry:  expiry</span>
<span class="sd">    :param userComment: user comment</span>
<span class="sd">    :param fund:  Fund Name</span>
<span class="sd">    :param FundNumber:  Fund Number</span>
<span class="sd">    :param FundCurrency:  Currency</span>
<span class="sd">    :param ShowQuantityBox:  ShowQuantityBox Boolean type</span>

<span class="sd">    :return: return id once the order get inserted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fund_Send&quot;</span><span class="p">)</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">database_dev</span><span class="p">()</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">isRepoLevEuro</span><span class="p">,</span> <span class="n">Pair</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">bol_wrongTicker</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">BolUndefinedMethodDeriv</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">Comment</span> <span class="o">=</span> <span class="n">userComment</span>
    <span class="n">Loading</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">Multiplier</span> <span class="o">=</span> <span class="n">MultiplierQuantity</span>
    <span class="n">ProductType_2ndCol</span><span class="p">,</span> <span class="n">InstrumentType_1stCol</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
    <span class="n">ForcingTtype</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Not sure about this variable</span>
    <span class="n">processid</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">gcashORswap</span> <span class="o">=</span> <span class="n">cashOrSwap</span>
    <span class="n">IDcontactSuggestedBroker</span><span class="p">,</span> <span class="n">PortfolioBrokerCode</span><span class="p">,</span> <span class="n">NAV</span> <span class="o">=</span> <span class="n">suggestedBroker</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span>  <span class="c1"># need to find reference</span>
    <span class="n">CurDate</span> <span class="o">=</span> <span class="n">get_current_date</span><span class="p">()</span>
    <span class="n">Name</span> <span class="o">=</span> <span class="n">sStockName</span>
    <span class="n">gUrgency</span> <span class="o">=</span> <span class="n">urgency</span>
    <span class="n">Limit</span> <span class="o">=</span> <span class="n">limit</span>
    <span class="n">WeightTarget</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">weight_Target</span><span class="p">)</span>
    <span class="n">WeightActual</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">LineID</span> <span class="o">=</span> <span class="n">fund_id</span>

    <span class="n">user_given_quantity</span> <span class="o">=</span> <span class="n">TradeQuantityPreciseIndicated</span>
    <span class="n">OptionExposureBox</span><span class="p">,</span> <span class="n">ExposureCalculationMethod</span><span class="p">,</span> <span class="n">BBGhttpError</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span>  <span class="c1"># Those method have doubt</span>
    <span class="n">TradeQuantityPreciseIndicated</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">MultiplierQuantity</span> <span class="o">*</span> <span class="n">TradeQuantityPreciseIndicated</span><span class="p">)</span>
    <span class="n">TickerISIN</span> <span class="o">=</span> <span class="n">TickerISIN</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;  Equity&quot;</span><span class="p">,</span> <span class="s2">&quot; Equity&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;  Corp&quot;</span><span class="p">,</span> <span class="s2">&quot; Corp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;  Index&quot;</span><span class="p">,</span>
                                                                                              <span class="s2">&quot; Index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="s2">&quot;  Govt&quot;</span><span class="p">,</span> <span class="s2">&quot; Govt&quot;</span><span class="p">)</span>
    <span class="n">GetSr3</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;SELECT [ENSR].[ID] o0, [ENSR].[SUB_OR_RED] o1, [ENSR].[BUY_OR_SELL] o2, [ENSR].[TICKERCHECK] o3, [ENSR].[BBGHTTPERROR] o4, [ENSR].[ENHANCEDCASHREPORTDATE] o5, [ENSR].[FROMEMAILSERVICES] o6, [ENSR].[TIMERSERVICES] o7, [ENSR].[TESTMODE] o8, [ENSR].[COUNTERPARTY] o9, [ENSR].[DAYBACKENCASH] o10, [ENSR].[EMAILENHANCEDCASH] o11, [ENSR].[FILEPRICEMASTERNUMBER] o12, [ENSR].[SICAVNAME] o13, [ENSR].[MAILLISTID] o14, [ENSR].[DEFAULTBBGWST] o15, [ENSR].[RISKMANAGEMENTAPI] o16, [ENSR].[MODELPORTFOLIOSTRATEGY] o17, [ENSR].[MODELREQUESTSTATUS] o18, [ENSR].[CALCULATIONSTATUS] o19, [ENSR].[MODELBASKETNUMBER] o20, [ENSR].[STRATEGYDATE] o21, [ENSR].[STRATEGYTIME] o22, [ENSR].[PORTFOLIOID] o23, [ENSR].[ONGOINGCALCULATION] o24&quot;</span>
        <span class="s2">&quot; FROM [outsys_prod_qa].DBO.[OSUSR_38P_SR] [ENSR]&quot;</span>
        <span class="s2">&quot; WHERE ([ENSR].[ID] = (1))&quot;</span>
        <span class="s2">&quot; ORDER BY [ENSR].[SUB_OR_RED] ASC &quot;</span><span class="p">)</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GetSr3</span><span class="p">)</span>
    <span class="n">resultGetSr3</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultGetSr3</span><span class="p">):</span>
        <span class="n">resGetSr3</span> <span class="o">=</span> <span class="n">resultGetSr3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">resGetSr3</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span>
            <span class="n">ToWithMax</span> <span class="o">=</span> <span class="s2">&quot;james.george@banorcapital.com; simone.cavallarin@banorcapital.com; david.howells@banorcapital.com; Oliver.Silvey@banorcapital.com; james.grant@banorcapital.com; wst01@banorcapital.com; wst02@banorcapital.com&quot;</span>
            <span class="n">ToTest</span> <span class="o">=</span> <span class="s2">&quot;simone.cavallarin@banorcapital.com; Oliver.Silvey@banorcapital.com; david.howells@banorcapital.com; james.grant@banorcapital.com; wenyan.hao@banorcapital.com&quot;</span>
            <span class="n">ToBanorCapital</span> <span class="o">=</span> <span class="s2">&quot;james.george@banorcapital.com; simone.cavallarin@banorcapital.com; Oliver.Silvey@banorcapital.com; david.howells@banorcapital.com; james.grant@banorcapital.com; wst01@banorcapital.com; wst02@banorcapital.com; wenyan.hao@banorcapital.com&quot;</span>
            <span class="n">ToTomNick</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">ToTomNickDario</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">ToJamesMorton</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">ToKallisto</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ToWithMax</span> <span class="o">=</span> <span class="s2">&quot;james.george@banorcapital.com; lorenzo.bombarda@banorcapital.com;  simone.cavallarin@banorcapital.com; giacomo.mergoni@banorcapital.com; massimiliano.cagliero@banor.it; david.howells@banorcapital.com; andrew.sandler@banorcapital.com; banorsicav@banorcapital.com; james.george349@gmail.com; wenyan.hao@banorcapital.com&quot;</span>
            <span class="n">ToTest</span> <span class="o">=</span> <span class="s2">&quot;james.george@banorcapital.com; simone.cavallarin@banorcapital.com; david.howells@banorcapital.com; james.grant@banorcapital.com&quot;</span>
            <span class="n">ToBanorCapital</span> <span class="o">=</span> <span class="s2">&quot;james.george@banorcapital.com; lorenzo.bombarda@banorcapital.com;  simone.cavallarin@banorcapital.com; giacomo.mergoni@banorcapital.com; david.howells@banorcapital.com; banorsicav@banorcapital.com; wenyan.hao@banorcapital.com &quot;</span>
            <span class="n">ToTomNick</span> <span class="o">=</span> <span class="s2">&quot;tomaso.mariotti@banor.it; nicolo.digiacomo@banor.it&quot;</span>
            <span class="n">ToTomNickDario</span> <span class="o">=</span> <span class="s2">&quot;dario.giannini@banor.it; tomaso.mariotti@banor.it; nicolo.digiacomo@banor.it&quot;</span>
            <span class="n">ToJamesMorton</span> <span class="o">=</span> <span class="s2">&quot;jamesm@slam.com.sg&quot;</span>
            <span class="n">ToKallisto</span> <span class="o">=</span> <span class="s2">&quot;luca.clementoni@kallistopartners.com; Andrea.Federici@banorcapital.com&quot;</span>
            <span class="n">BEB_emailList</span> <span class="o">=</span> <span class="s2">&quot;davide.verardi@banor.it; Tomaso.Mariotti@banor.it; nicolo.digiacomo@banor.it&quot;</span>

    <span class="k">if</span> <span class="n">ShowQuantityBox</span> <span class="ow">and</span> <span class="n">TradeQuantityPreciseIndicated</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Please double check the quantity&#39;</span>
        <span class="k">return</span> <span class="n">msg</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger_sqlalchemy</span> <span class="o">=</span> <span class="n">logg_Handler</span><span class="p">(</span><span class="n">fund</span><span class="p">,</span> <span class="n">logger_name</span><span class="o">=</span><span class="s1">&#39;ShowQuantityBox and TradeQuantityPreciseIndicated check &#39;</span><span class="p">)</span>
        <span class="n">logger_sqlalchemy</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;ShowQuantityBox and TradeQuantityPreciseIndicated is false&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ShowQuantityBox</span><span class="p">:</span>
            <span class="n">OrderQtyType</span> <span class="o">=</span> <span class="s2">&quot;Quantity&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">OrderQtyType</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">% E</span><span class="s2">xp of Nav&quot;</span>
            <span class="k">if</span> <span class="n">OptionExposureBox</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ExposureCalculationMethod</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span> <span class="ow">or</span> <span class="n">ExposureCalculationMethod</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">BolUndefinedMethodDeriv</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">BBGhttpError</span><span class="p">:</span>
                <span class="n">GetSrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SELECT  top 1 * FROM [outsys_prod_qa].DBO.[OSUSR_38P_SR] [ENSR] order by id desc&quot;</span><span class="p">)</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GetSrs</span><span class="p">)</span>
                <span class="n">resultGetSrs</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultGetSrs</span><span class="p">):</span>
                    <span class="n">resGetSrs</span> <span class="o">=</span> <span class="n">resultGetSrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">BBGhttpError</span> <span class="o">=</span> <span class="n">resGetSrs</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">isRepoLevEuro</span><span class="p">:</span>
                        <span class="n">ProductType_2ndCol</span> <span class="o">=</span> <span class="s1">&#39;REPO&#39;</span>
                        <span class="n">InstrumentType_1stCol</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">GetSrs2</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SELECT top 1  * FROM [outsys_prod_qa].DBO.[OSUSR_38P_SR] [ENSR] order by id desc&quot;</span><span class="p">)</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GetSrs2</span><span class="p">)</span>
                <span class="n">resultGetSrs2</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">gs2</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resultGetSrs2</span><span class="p">):</span>
                    <span class="n">resGetSrs2</span> <span class="o">=</span> <span class="n">resultGetSrs2</span><span class="p">[</span><span class="n">gs2</span><span class="p">]</span>
                    <span class="n">BBGhttpError</span> <span class="o">=</span> <span class="n">resGetSrs2</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

                <span class="n">Http_Server_wst01_repose</span> <span class="o">=</span> <span class="n">Http_Server_wst01</span><span class="p">(</span><span class="n">TickerISIN</span><span class="p">,</span> <span class="n">fund</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">Http_Server_wst01_repose</span><span class="p">:</span>
                    <span class="n">sStockName</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
                    <span class="n">bbgCrncy</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Crncy&#39;</span><span class="p">]</span>
                    <span class="n">bbgCountry</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Country&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Id_Isin</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Id_Isin&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Security_Typ</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Security_typ&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Ticker_And_Exch_Code</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Ticker_And_Exch_Code&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Country_Iso</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Country_Iso&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Country_Full_Name</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Country_Full_Name&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Issuer_Industry</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Issuer_Industry&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Parent_Ticker_Exchange</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Parent_Ticker_Exchange&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Px_Last</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Px_Last&#39;</span><span class="p">]</span>
                    <span class="n">ShowPriceBox</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">TickerISIN</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;TickerIsinUpperCase&#39;</span><span class="p">]</span>
                    <span class="n">bbg_SecurityName</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;SecurityName&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Exchange</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Eqy_Prim_Exch_Shrt&#39;</span><span class="p">]</span>
                    <span class="n">bbg_SettleDate</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Settle_Date&#39;</span><span class="p">]</span>
                    <span class="n">bbg_OptContSize</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Opt_Cont_Size&#39;</span><span class="p">]</span>
                    <span class="n">bbg_FutContSize</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Fut_Cont_Size&#39;</span><span class="p">]</span>
                    <span class="n">bbg_IDUltimateParentCo</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Id_bb_Ultimate_Parent_Co&#39;</span><span class="p">]</span>
                    <span class="n">bbg_lotSize</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;lot_size&#39;</span><span class="p">]</span>
                    <span class="n">bbg_MarketStartTime</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;StartTime&#39;</span><span class="p">]</span>
                    <span class="n">bbg_MarketEndTime</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;EndTime&#39;</span><span class="p">]</span>
                    <span class="n">bbg_UnderlyingPrice</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;UnderlayPrcie&#39;</span><span class="p">]</span>
                    <span class="n">bbg_MaturityDate</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;MaturityDate&#39;</span><span class="p">]</span>
                    <span class="n">bbg_IDUltimateParentCoName</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Id_bb_Ultimate_Parent_Co_Name&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Name</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Short_Name</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Short_Name&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Market_Sector_Des</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Market_sector_des&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Chg_Pct_Ytd</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Chg_Pct_Ytd&#39;</span><span class="p">]</span>
                    <span class="n">bbg_TickerIsinUpperCase</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;TickerIsinUpperCase&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Eqy_Sh_Out</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Eqy_sh_out&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Amt_Outstanding</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Amt_Outstanding&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Volume_Avg_20D</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Volume_avg_20d&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Cntry_Of_Risk</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Cntry_of_Risk&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Payment_Rank</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Payment_Rank&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Capital_Contingent_Security</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Capital_Contingent_Security&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Registered_Country_Location</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Registered_Country_Location&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Country_Of_Largest_Revenue</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Country_of_largest_Revenue&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Underlying_Isin</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Underlying_Isin&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Opt_Strike_Px</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Opt_strike_Px&#39;</span><span class="p">]</span>
                    <span class="n">bbg_Next_Call_Dt</span> <span class="o">=</span> <span class="n">Http_Server_wst01_repose</span><span class="p">[</span><span class="s1">&#39;Next_Call_Dt&#39;</span><span class="p">]</span>

                    <span class="n">GetControlTickerISINsByTickerRequested</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;SELECT [ENCONTROLTICKER_ISIN].[ID] o0, [ENCONTROLTICKER_ISIN].[BOLEANAPIREQUESTSENT] o1, [ENCONTROLTICKER_ISIN].[BOLEANAPIREQUESTSENTAGAIN] o2, [ENCONTROLTICKER_ISIN].[APIDATETIMEREQUEST] o3, [ENCONTROLTICKER_ISIN].[TICKERREQUESTED] o4, [ENCONTROLTICKER_ISIN].[DATETIME] o5, [ENCONTROLTICKER_ISIN].[ERROR] o6, [ENCONTROLTICKER_ISIN].[SECURITYNAME] o7, [ENCONTROLTICKER_ISIN].[NAME] o8, [ENCONTROLTICKER_ISIN].[SHORT_NAME] o9, [ENCONTROLTICKER_ISIN].[CRNCY] o10,&quot;</span>
                            <span class="s2">&quot; [ENCONTROLTICKER_ISIN].[COUNTRY] o11, [ENCONTROLTICKER_ISIN].[ID_ISIN] o12, [ENCONTROLTICKER_ISIN].[MARKET_SECTOR_DES] o13, [ENCONTROLTICKER_ISIN].[SECURITY_TYP] o14, [ENCONTROLTICKER_ISIN].[TICKER_AND_EXCH_CODE] o15, [ENCONTROLTICKER_ISIN].[COUNTRY_ISO] o16, [ENCONTROLTICKER_ISIN].[COUNTRY_FULL_NAME] o17, [ENCONTROLTICKER_ISIN].[ISSUER_INDUSTRY] o18, [ENCONTROLTICKER_ISIN].[PARENT_TICKER_EXCHANGE] o19, [ENCONTROLTICKER_ISIN].[CHG_PCT_YTD] o20, [ENCONTROLTICKER_ISIN].[PX_LAST] o21, [ENCONTROLTICKER_ISIN].[TICKERISINUPPERCASE] o22, [ENCONTROLTICKER_ISIN].[EQY_PRIM_EXCH_SHRT] o23, [ENCONTROLTICKER_ISIN].[SETTLE_DATE] o24, [ENCONTROLTICKER_ISIN].[OPT_CONT_SIZE] o25, [ENCONTROLTICKER_ISIN].[FUT_CONT_SIZE] o26, [ENCONTROLTICKER_ISIN].[ID_BB_ULTIMATE_PARENT_CO] o27, [ENCONTROLTICKER_ISIN].[MATURITYDATE] o28, [ENCONTROLTICKER_ISIN].[STARTTIME] o29, [ENCONTROLTICKER_ISIN].[ENDTIME] o30, [ENCONTROLTICKER_ISIN].[UNDERLAYPRCIE] o31, [ENCONTROLTICKER_ISIN].[LOT_SIZE] o32, [ENCONTROLTICKER_ISIN].[ID_BB_ULTIMATE_PARENT_CO_NAM] o33, [ENCONTROLTICKER_ISIN].[CURRENCY1] o34, [ENCONTROLTICKER_ISIN].[CURRENCY2] o35, [ENCONTROLTICKER_ISIN].[HIST_PX_ENDMONTH] o36, [ENCONTROLTICKER_ISIN].[HIST_ERROR] o37, [ENCONTROLTICKER_ISIN].[HIST_DATE] o38, [ENCONTROLTICKER_ISIN].[HIST_BOLAPIREQUESTSENT] o39, [ENCONTROLTICKER_ISIN].[HIST_BOLAPIREQUESTSENTAG] o40, [ENCONTROLTICKER_ISIN].[EQY_SH_OUT] o41, [ENCONTROLTICKER_ISIN].[AMT_OUTSTANDING] o42, [ENCONTROLTICKER_ISIN].[VOLUME_AVG_20D] o43, [ENCONTROLTICKER_ISIN].[CNTRY_OF_RISK] o44, [ENCONTROLTICKER_ISIN].[PAYMENT_RANK] o45, [ENCONTROLTICKER_ISIN].[CAPITAL_CONTINGENT_SECURITY] o46, [ENCONTROLTICKER_ISIN].[REGISTERED_COUNTRY_LOCATION] o47, [ENCONTROLTICKER_ISIN].[COUNTRY_OF_LARGEST_REVENUE] o48, [ENCONTROLTICKER_ISIN].[UNDERLYING_ISIN] o49, [ENCONTROLTICKER_ISIN].[OPT_STRIKE_PX] o50, [ENCONTROLTICKER_ISIN].[MATURITY_DATE_ESTIMATED] o51, [ENCONTROLTICKER_ISIN].[NEXT_CALL_DT] o52, [ENCONTROLTICKER_ISIN].[DELTA] o53, [ENCONTROLTICKER_ISIN].[OPT_PUT_CALL] o54, [ENCONTROLTICKER_ISIN].[ERRORTEXT] o55, [ENCONTROLTICKER_ISIN].[INDUSTRY_GROUP] o56, [ENCONTROLTICKER_ISIN].[INDUSTRY_SECTOR] o57, [ENCONTROLTICKER_ISIN].[VOLUME_AVG_30D] o58, [ENCONTROLTICKER_ISIN].[CUR_MKT_CAP] o59, [ENCONTROLTICKER_ISIN].[VOLATILITY_30D] o60, [ENCONTROLTICKER_ISIN].[EQY_BETA] o61, [ENCONTROLTICKER_ISIN].[EQY_ALPHA] o62, [ENCONTROLTICKER_ISIN].[COUPON] o63, [ENCONTROLTICKER_ISIN].[ACCRUEDINTEREST] o64, [ENCONTROLTICKER_ISIN].[YELD] o65 &quot;</span>
                            <span class="s2">&quot;FROM [outsys_prod_qa].DBO.[OSUSR_BOL_CONTROLTICKER_ISIN] [ENCONTROLTICKER_ISIN] &quot;</span>
                            <span class="s2">&quot;WHERE ([ENCONTROLTICKER_ISIN].[TICKERREQUESTED] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                        <span class="n">TickerISIN</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;)&quot;</span><span class="p">)</span>
                    <span class="n">current_date</span> <span class="o">=</span> <span class="n">get_current_date</span><span class="p">()</span>
                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">GetControlTickerISINsByTickerRequested</span><span class="p">)</span>
                    <span class="n">rGetControlTickerISINsByTickerRequested</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">rGetControlTickerISINsByTickerRequested</span><span class="p">:</span>
                        <span class="n">updateContrTick</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="s2">&quot;UPDATE [outsys_prod_qa].DBO.[OSUSR_BOL_CONTROLTICKER_ISIN] set [BOLEANAPIREQUESTSENT] = 0, [BOLEANAPIREQUESTSENTAGAIN] = 0, [APIDATETIMEREQUEST] =&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">CurDate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [TICKERREQUESTED] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">TickerISIN</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [DATETIME] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">current_date</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [ERROR] = 0, [SECURITYNAME] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_SecurityName</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [NAME] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bbg_Name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [SHORT_NAME] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Short_Name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [CRNCY] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bbgCrncy</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [COUNTRY] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbgCountry</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [ID_ISIN] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Id_Isin</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [MARKET_SECTOR_DES] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Market_Sector_Des</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [SECURITY_TYP] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Security_Typ</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [TICKER_AND_EXCH_CODE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Ticker_And_Exch_Code</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [COUNTRY_ISO] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Country_Iso</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [COUNTRY_FULL_NAME]= &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Country_Full_Name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [ISSUER_INDUSTRY] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Issuer_Industry</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [PARENT_TICKER_EXCHANGE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Parent_Ticker_Exchange</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [CHG_PCT_YTD] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Chg_Pct_Ytd</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [PX_LAST] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Px_Last</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [TICKERISINUPPERCASE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_TickerIsinUpperCase</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [EQY_PRIM_EXCH_SHRT] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Exchange</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [SETTLE_DATE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_SettleDate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [OPT_CONT_SIZE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_OptContSize</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [FUT_CONT_SIZE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_FutContSize</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [ID_BB_ULTIMATE_PARENT_CO]= &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_IDUltimateParentCo</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [MATURITYDATE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_MaturityDate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [STARTTIME] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_MarketStartTime</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [ENDTIME] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_MarketEndTime</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [UNDERLAYPRCIE] =&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_UnderlyingPrice</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [LOT_SIZE] =&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_lotSize</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [ID_BB_ULTIMATE_PARENT_CO_NAM] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_IDUltimateParentCoName</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,[HIST_PX_ENDMONTH] = 0, [HIST_ERROR] = 0, [HIST_BOLAPIREQUESTSENT] = 0, [HIST_BOLAPIREQUESTSENTAG] = 0, [EQY_SH_OUT] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Eqy_Sh_Out</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [AMT_OUTSTANDING] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Amt_Outstanding</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [VOLUME_AVG_20D] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Volume_Avg_20D</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [CNTRY_OF_RISK] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Cntry_Of_Risk</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [PAYMENT_RANK] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Payment_Rank</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [CAPITAL_CONTINGENT_SECURITY] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Capital_Contingent_Security</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [REGISTERED_COUNTRY_LOCATION] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Registered_Country_Location</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [COUNTRY_OF_LARGEST_REVENUE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Country_Of_Largest_Revenue</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [UNDERLYING_ISIN] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Underlying_Isin</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [OPT_STRIKE_PX] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Opt_Strike_Px</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [MATURITY_DATE_ESTIMATED] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_MaturityDate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [NEXT_CALL_DT] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Next_Call_Dt</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; Where ([TICKERREQUESTED] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">TickerISIN</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;)&quot;</span><span class="p">)</span>
                        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">updateContrTick</span><span class="p">)</span>
                        <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">iGetControlTickerISINsByTickerRequested</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="s2">&quot;INSERT INTO [outsys_prod_qa].DBO.[OSUSR_BOL_CONTROLTICKER_ISIN]( [BOLEANAPIREQUESTSENT],  [BOLEANAPIREQUESTSENTAGAIN],  [APIDATETIMEREQUEST],  [TICKERREQUESTED],  [DATETIME],  [ERROR],  [SECURITYNAME],  [NAME],  [SHORT_NAME],  [CRNCY],  [COUNTRY],  [ID_ISIN],  [MARKET_SECTOR_DES],  [SECURITY_TYP],  [TICKER_AND_EXCH_CODE],  [COUNTRY_ISO],  [COUNTRY_FULL_NAME],  [ISSUER_INDUSTRY],  [PARENT_TICKER_EXCHANGE],  [CHG_PCT_YTD],  [PX_LAST],  [TICKERISINUPPERCASE],  [EQY_PRIM_EXCH_SHRT],  [SETTLE_DATE],  [OPT_CONT_SIZE],  [FUT_CONT_SIZE],  [ID_BB_ULTIMATE_PARENT_CO],  [MATURITYDATE],  [STARTTIME],  [ENDTIME],  [UNDERLAYPRCIE],  [LOT_SIZE],  [ID_BB_ULTIMATE_PARENT_CO_NAM],  [CURRENCY1],  [CURRENCY2],  [HIST_PX_ENDMONTH],  [HIST_ERROR],  [HIST_DATE],  [HIST_BOLAPIREQUESTSENT],  [HIST_BOLAPIREQUESTSENTAG],  [EQY_SH_OUT],  [AMT_OUTSTANDING],  [VOLUME_AVG_20D],  [CNTRY_OF_RISK],  [PAYMENT_RANK],  [CAPITAL_CONTINGENT_SECURITY],  [REGISTERED_COUNTRY_LOCATION],  [COUNTRY_OF_LARGEST_REVENUE],  [UNDERLYING_ISIN],  [OPT_STRIKE_PX],  [MATURITY_DATE_ESTIMATED],  [NEXT_CALL_DT],  [DELTA],  [OPT_PUT_CALL],  [ERRORTEXT],  [INDUSTRY_GROUP],  [INDUSTRY_SECTOR],  [VOLUME_AVG_30D],  [CUR_MKT_CAP],  [VOLATILITY_30D],  [EQY_BETA],  [EQY_ALPHA],  [COUPON], [ACCRUEDINTEREST]) values&quot;</span>
                                <span class="s2">&quot;(0, 0, &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">CurDate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">TickerISIN</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, getdate(),0,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_SecurityName</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bbg_Name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Short_Name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbgCrncy</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bbgCountry</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bbg_Id_Isin</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Market_Sector_Des</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bbg_Security_Typ</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Ticker_And_Exch_Code</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bbg_Country_Iso</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Country_Full_Name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bbg_Issuer_Industry</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Parent_Ticker_Exchange</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bbg_Chg_Pct_Ytd</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Px_Last</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bbg_TickerIsinUpperCase</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Exchange</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bbg_SettleDate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_OptContSize</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_FutContSize</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bbg_IDUltimateParentCo</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_MaturityDate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bbg_MarketStartTime</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_MarketEndTime</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bbg_UnderlyingPrice</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_lotSize</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_IDUltimateParentCoName</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, &quot;&quot;, &quot;&quot;, 0,  0, 0,  0, &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Eqy_Sh_Out</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bbg_Amt_Outstanding</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Volume_Avg_20D</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bbg_Cntry_Of_Risk</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Payment_Rank</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bbg_Capital_Contingent_Security</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Registered_Country_Location</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Country_Of_Largest_Revenue</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bbg_Underlying_Isin</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Opt_Strike_Px</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bbg_MaturityDate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">bbg_Next_Call_Dt</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
                        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">iGetControlTickerISINsByTickerRequested</span><span class="p">)</span>
                        <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                        <span class="c1"># BBG Refresh here</span>
                    <span class="k">if</span> <span class="n">LineID</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">resCol1_col2_with_auto_correction</span> <span class="o">=</span> <span class="n">col1_col2_with_auto_correction</span><span class="p">(</span><span class="n">Ticker</span><span class="o">=</span><span class="n">TickerISIN</span><span class="p">,</span>
                                                                                           <span class="n">FundNumber</span><span class="o">=</span><span class="n">FundNumber</span><span class="p">,</span>
                                                                                           <span class="n">Col_1_Ready</span><span class="o">=</span><span class="n">InstrumentType_1stCol</span><span class="p">,</span>
                                                                                           <span class="n">CurrencyIN</span><span class="o">=</span><span class="n">bbgCrncy</span><span class="p">,</span>
                                                                                           <span class="n">ForcingInstrumentTypecol1</span><span class="o">=</span><span class="n">ForcingTtype</span><span class="p">,</span>
                                                                                           <span class="n">FundName</span><span class="o">=</span><span class="n">fund</span><span class="p">)</span>
                        <span class="n">InstrumentType_1stCol</span> <span class="o">=</span> <span class="n">resCol1_col2_with_auto_correction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">ProductType_2ndCol</span> <span class="o">=</span> <span class="n">resCol1_col2_with_auto_correction</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">InstrumentType_1stCol</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                            <span class="n">gDateTime</span> <span class="o">=</span> <span class="n">CurDate</span>
                            <span class="n">OrderStage</span> <span class="o">=</span> <span class="s2">&quot;Pending Suggestion&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">resCol_1_and_2_Using_Ticker_2</span> <span class="o">=</span> <span class="n">Col_1_and_2_Using_Ticker_2</span><span class="p">(</span><span class="n">Ticker</span><span class="o">=</span><span class="n">TickerISIN</span><span class="p">,</span>
                                                                                       <span class="n">Col_1_Ready</span><span class="o">=</span><span class="n">InstrumentType_1stCol</span><span class="p">)</span>
                            <span class="n">InstrumentType_1stCol</span> <span class="o">=</span> <span class="n">resCol_1_and_2_Using_Ticker_2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">ProductType_2ndCol</span> <span class="o">=</span> <span class="n">resCol_1_and_2_Using_Ticker_2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">InstrumentType_1stCol</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                                <span class="n">gDateTime</span> <span class="o">=</span> <span class="n">CurDate</span>
                                <span class="n">OrderStage</span> <span class="o">=</span> <span class="s2">&quot;Pending Suggestion&quot;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">Col_1_and_2_Using_Weight_3_rec</span> <span class="o">=</span> <span class="n">Col_1_and_2_Using_Weight_3</span><span class="p">(</span><span class="n">Ticker</span><span class="o">=</span><span class="n">TickerISIN</span><span class="p">,</span>
                                                                                            <span class="n">Weight</span><span class="o">=</span><span class="n">WeightTarget</span><span class="p">,</span>
                                                                                            <span class="n">CashORswap</span><span class="o">=</span><span class="n">gcashORswap</span><span class="p">,</span>
                                                                                            <span class="n">StockName</span><span class="o">=</span><span class="n">sStockName</span><span class="p">,</span>
                                                                                            <span class="n">BbgSecurityTyp</span><span class="o">=</span><span class="n">bbg_Security_Typ</span><span class="p">,</span>
                                                                                            <span class="n">FundName</span><span class="o">=</span><span class="n">fund</span><span class="p">)</span>
                                <span class="n">InstrumentType_1stCol</span> <span class="o">=</span> <span class="n">Col_1_and_2_Using_Weight_3_rec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                <span class="n">ProductType_2ndCol</span> <span class="o">=</span> <span class="n">Col_1_and_2_Using_Weight_3_rec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">gDateTime</span> <span class="o">=</span> <span class="n">CurDate</span>
                    <span class="n">OrderStage</span> <span class="o">=</span> <span class="s2">&quot;Pending Suggestion&quot;</span>
                    <span class="k">if</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Equity&quot;</span> <span class="ow">or</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> \
                            <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Equity - REIT&quot;</span> <span class="ow">or</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> \
                            <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Equity - Savings Share&quot;</span> <span class="ow">or</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> \
                            <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Equity - ADR&quot;</span> <span class="ow">or</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> \
                            <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;ETF&quot;</span> <span class="ow">or</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> \
                            <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Warrant&quot;</span> <span class="ow">or</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> \
                            <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Equity - Right&quot;</span> <span class="ow">or</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> \
                            <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Fund&quot;</span> <span class="ow">or</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Equity - MLP&quot;</span> \
                            <span class="ow">or</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Equity - Right&quot;</span> <span class="ow">or</span> \
                            <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Equity Preference&quot;</span> <span class="ow">or</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> \
                            <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Equity A-Shares&quot;</span> <span class="ow">or</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> \
                            <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Equity B-Shares&quot;</span> <span class="ow">or</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> \
                            <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Dutch Cert&quot;</span> <span class="ow">or</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> \
                            <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Equity - GDR&quot;</span> <span class="ow">or</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> \
                            <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Equity - Receipt&quot;</span><span class="p">:</span>

                        <span class="n">BrokerName</span><span class="p">,</span> <span class="n">BrokerShortCode</span><span class="p">,</span> <span class="n">Custodian</span><span class="p">,</span> <span class="n">Account</span><span class="p">,</span> <span class="n">C4FBrokerName</span><span class="p">,</span> <span class="n">BrokerID</span><span class="p">,</span> <span class="n">BrokerType_A_B</span><span class="p">,</span> \
                        <span class="n">NeedComment</span><span class="p">,</span> <span class="n">BrokerSelReason</span><span class="p">,</span> <span class="n">ExecutorFactor_Cost</span><span class="p">,</span> <span class="n">JP_MorganAccount</span> <span class="o">=</span> \
                            <span class="n">Trading_Equity_Fund_ETF_Cash</span><span class="p">(</span><span class="n">FundNumber</span><span class="o">=</span><span class="n">FundNumber</span><span class="p">,</span> <span class="n">Ticker</span><span class="o">=</span><span class="n">TickerISIN</span><span class="p">,</span>
                                                         <span class="n">IDcontactSuggestedBroker</span><span class="o">=</span><span class="n">IDcontactSuggestedBroker</span><span class="p">,</span>
                                                         <span class="n">Col_2</span><span class="o">=</span><span class="n">ProductType_2ndCol</span><span class="p">,</span>
                                                         <span class="n">PortfolioBrokerCode</span><span class="o">=</span><span class="n">PortfolioBrokerCode</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Bond&quot;</span><span class="p">:</span>
                            <span class="n">BrokerName</span><span class="p">,</span> <span class="n">BrokerShortCode</span><span class="p">,</span> <span class="n">Custodian</span><span class="p">,</span> <span class="n">C4FBrokerName</span><span class="p">,</span> <span class="n">Account</span><span class="p">,</span> <span class="n">BrokerID</span><span class="p">,</span> \
                            <span class="n">BrokerType_A_B</span><span class="p">,</span> <span class="n">NeedComment</span><span class="p">,</span> <span class="n">BrokerSelReason</span><span class="p">,</span> <span class="n">ExecutorFactor_Cost</span> <span class="o">=</span> <span class="n">Trading_Bond_Cash</span><span class="p">(</span>
                                <span class="n">FundNumber</span><span class="o">=</span><span class="n">FundNumber</span><span class="p">,</span> <span class="n">Ticker</span><span class="o">=</span><span class="n">TickerISIN</span><span class="p">,</span>
                                <span class="n">IDcontactSuggestedBroker</span><span class="o">=</span><span class="n">IDcontactSuggestedBroker</span><span class="p">,</span>
                                <span class="n">PortfolioBrokerCode</span><span class="o">=</span><span class="n">PortfolioBrokerCode</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;SW&quot;</span><span class="p">:</span>
                                <span class="n">BrokerName</span><span class="p">,</span> <span class="n">BrokerShortCode</span><span class="p">,</span> <span class="n">Custodian</span><span class="p">,</span> <span class="n">Account</span><span class="p">,</span> <span class="n">C4FBroker</span><span class="p">,</span> \
                                <span class="n">BrokerID</span><span class="p">,</span> \
                                <span class="n">BrokerType_A_B</span><span class="p">,</span> <span class="n">NeedComment</span><span class="p">,</span> <span class="n">BrokerSelReason</span><span class="p">,</span> <span class="n">ExecutorFactor_Cost</span><span class="p">,</span> <span class="n">JP_MorganAccount</span> \
                                    <span class="o">=</span> <span class="n">Trading_Swap</span><span class="p">(</span><span class="n">FundNumber</span><span class="o">=</span><span class="n">FundNumber</span><span class="p">,</span>
                                                   <span class="n">IDcontactSuggestedBroker</span><span class="o">=</span><span class="n">IDcontactSuggestedBroker</span><span class="p">,</span>
                                                   <span class="n">PortfolioBrokerCode</span><span class="o">=</span><span class="n">PortfolioBrokerCode</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Equity&quot;</span> <span class="ow">or</span> \
                                        <span class="s2">&quot;InstrumentType_1stCol&quot;</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Option Index&quot;</span> <span class="ow">or</span> \
                                        <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Future Index&quot;</span> <span class="ow">or</span> \
                                        <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Future Bond&quot;</span> <span class="ow">or</span> \
                                        <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">ProductType_2ndCol</span> <span class="o">==</span> <span class="s2">&quot;Single stock future&quot;</span><span class="p">:</span>
                                    <span class="n">BrokerName</span><span class="p">,</span> <span class="n">BrokerShortCode</span><span class="p">,</span> <span class="n">C4FBrokerName</span><span class="p">,</span> <span class="n">BrokerID</span><span class="p">,</span> <span class="n">BrokerType_A_B</span><span class="p">,</span> <span class="n">NeedComment</span><span class="p">,</span> <span class="n">BrokerSelReason</span><span class="p">,</span> \
                                    <span class="n">ExecutorFactor_Cost</span><span class="p">,</span> <span class="n">Custodian</span><span class="p">,</span> <span class="n">Account</span><span class="p">,</span> <span class="n">C4FBroker</span> <span class="o">=</span> <span class="n">Trading_Derivative_Cash</span><span class="p">(</span>
                                        <span class="n">FundNumber</span><span class="o">=</span><span class="n">FundNumber</span><span class="p">,</span>
                                        <span class="n">PortfolioBrokerCode</span><span class="o">=</span><span class="n">PortfolioBrokerCode</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">BrokerName</span> <span class="o">=</span> <span class="s2">&quot;Broker has not been identified&quot;</span>

                    <span class="c1"># Ajax refresh here</span>

                    <span class="n">ArborProductType_</span> <span class="o">=</span> <span class="n">CodesGeneration_Arbor</span><span class="p">(</span><span class="n">Col_1</span><span class="o">=</span><span class="n">InstrumentType_1stCol</span><span class="p">,</span> <span class="n">Col_2</span><span class="o">=</span><span class="n">ProductType_2ndCol</span><span class="p">)</span>

                    <span class="n">out_BrokerShortCode</span><span class="p">,</span> <span class="n">out_BrokerID</span><span class="p">,</span> <span class="n">out_BrokerName</span><span class="p">,</span> <span class="n">out_C4F_BrokerName</span><span class="p">,</span> <span class="n">out_JP_MorganAccount</span><span class="p">,</span> <span class="n">BrokerType_A_B</span><span class="p">,</span> \
                    <span class="n">NeedComment</span><span class="p">,</span> <span class="n">BrokerSelReason</span><span class="p">,</span> <span class="n">ExecutorFactor_Cost</span><span class="p">,</span> <span class="n">ExposureTradeID</span><span class="p">,</span> <span class="n">out_UBS_Account</span><span class="p">,</span> <span class="n">out_LeiReportingCode</span><span class="p">,</span> \
                    <span class="n">out_BrokerCodeLevEuro</span><span class="p">,</span> <span class="n">out_masterAgreement</span><span class="p">,</span> <span class="n">out_masterAgreementVersionDate</span> <span class="o">=</span> \
                        <span class="n">Broker_Selection</span><span class="p">(</span><span class="n">FundCode</span><span class="o">=</span><span class="n">FundNumber</span><span class="p">,</span> <span class="n">InstrType</span><span class="o">=</span><span class="n">InstrumentType_1stCol</span><span class="p">,</span>
                                         <span class="n">SecurityType</span><span class="o">=</span><span class="n">ProductType_2ndCol</span><span class="p">,</span>
                                         <span class="n">Ticker</span><span class="o">=</span><span class="n">TickerISIN</span><span class="p">,</span> <span class="n">BrokerID_fromPortfolio</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                         <span class="n">BrokerCode_fromPortfolio</span><span class="o">=</span><span class="n">PortfolioBrokerCode</span><span class="p">,</span>
                                         <span class="n">BrokerSuggestedByUser</span><span class="o">=</span><span class="n">IDcontactSuggestedBroker</span><span class="p">,</span> <span class="n">FX</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">Bol_BNP</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                         <span class="n">Bol_BDL</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">BrokerName</span> <span class="o">=</span> <span class="n">out_BrokerName</span>
                    <span class="n">BrokerShortCode</span> <span class="o">=</span> <span class="n">out_BrokerShortCode</span>
                    <span class="n">ArborProductType</span> <span class="o">=</span> <span class="n">ArborProductType_</span>
                    <span class="n">Casa4FundsCode</span> <span class="o">=</span> <span class="n">CodesGeneration_Casa_4_Funds</span><span class="p">(</span><span class="n">Col_1</span><span class="o">=</span><span class="n">InstrumentType_1stCol</span><span class="p">,</span>
                                                                  <span class="n">Col_2</span><span class="o">=</span><span class="n">ProductType_2ndCol</span><span class="p">)</span>
                    <span class="n">C4FSecurityType</span> <span class="o">=</span> <span class="n">Casa4FundsCode</span>
                    <span class="n">t_plus</span> <span class="o">=</span> <span class="n">Value_Date_Generator</span><span class="p">(</span><span class="n">Col_1</span><span class="o">=</span><span class="n">InstrumentType_1stCol</span><span class="p">,</span> <span class="n">Col_2</span><span class="o">=</span><span class="n">ProductType_2ndCol</span><span class="p">,</span>
                                                  <span class="n">Ticker</span><span class="o">=</span><span class="n">TickerISIN</span><span class="p">)</span>
                    <span class="n">ValueDate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                    <span class="n">ValueDate</span> <span class="o">=</span> <span class="n">ValueDate</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">t_plus</span><span class="p">)</span>
                    <span class="n">ValueDate</span> <span class="o">=</span> <span class="n">ValueDate</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">API_Command</span> <span class="o">=</span> <span class="n">Owl_Api</span><span class="p">(</span><span class="n">BBG_BrokerCode</span><span class="o">=</span><span class="n">BrokerShortCode</span><span class="p">,</span> <span class="n">Col_1</span><span class="o">=</span><span class="n">InstrumentType_1stCol</span><span class="p">,</span>
                                          <span class="n">Col_2</span><span class="o">=</span><span class="n">ProductType_2ndCol</span><span class="p">)</span>

                    <span class="c1"># Line Id is nothing but id for NALineID ans so on</span>
                    <span class="n">LineID</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">FundCode</span> <span class="o">=</span> <span class="n">FundNumber</span>
                    <span class="n">Ticker_ISIN</span> <span class="o">=</span> <span class="n">TickerISIN</span>
                    <span class="n">Weight_Target</span><span class="p">,</span> <span class="n">xPairTrade</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>  <span class="c1"># Need to find out its reference</span>
                    <span class="n">database_name</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="k">if</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">database_name</span> <span class="o">=</span> <span class="s1">&#39;OSUSR_38P_NORTHAMERICALS&#39;</span>
                        <span class="n">col_name</span> <span class="o">=</span> <span class="s1">&#39;NorthAmericaLS_ID&#39;</span>
                        <span class="n">To</span> <span class="o">=</span> <span class="n">ToWithMax</span>
                        <span class="n">FundName</span> <span class="o">=</span> <span class="s2">&quot;BANOR SICAV NORTH AMERICA LONG SHORT EQUITY&quot;</span>
                        <span class="n">Fund</span> <span class="o">=</span> <span class="s2">&quot;BANOR SICAV NORTH AMERICA LONG SHORT EQUITY&quot;</span>
                        <span class="n">FundNameShort</span> <span class="o">=</span> <span class="s2">&quot;North America l/s&quot;</span>
                    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">database_name</span> <span class="o">=</span> <span class="s1">&#39;OSUSR_38P_GREATERCHINALS&#39;</span>
                        <span class="n">col_name</span> <span class="o">=</span> <span class="s1">&#39;GREATERCHINALS_ID&#39;</span>
                        <span class="n">To</span> <span class="o">=</span> <span class="n">ToBanorCapital</span>
                        <span class="n">FundName</span> <span class="o">=</span> <span class="s2">&quot;BANOR SICAV GREATER CHINA LONG SHORT EQUITY&quot;</span>
                        <span class="n">Fund</span> <span class="o">=</span> <span class="s2">&quot;BANOR SICAV GREATER CHINA LONG SHORT EQUITY&quot;</span>
                        <span class="n">FundNameShort</span> <span class="o">=</span> <span class="s2">&quot;Greater China l/s&quot;</span>
                    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">database_name</span> <span class="o">=</span> <span class="s1">&#39;OSUSR_38P_ITALYLS&#39;</span>
                        <span class="n">col_name</span> <span class="o">=</span> <span class="s1">&#39;ItalyLS_ID&#39;</span>
                        <span class="n">To</span> <span class="o">=</span> <span class="n">ToBanorCapital</span>
                        <span class="n">FundName</span> <span class="o">=</span> <span class="s2">&quot;BANOR SICAV ITALY LONG SHORT EQUITY&quot;</span>
                        <span class="n">Fund</span> <span class="o">=</span> <span class="s2">&quot;BANOR SICAV ITALY LONG SHORT EQUITY&quot;</span>
                        <span class="n">FundNameShort</span> <span class="o">=</span> <span class="s2">&quot;Italy l/s&quot;</span>
                    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">database_name</span> <span class="o">=</span> <span class="s1">&#39;OSUSR_38P_EUROPEANVALUE&#39;</span>
                        <span class="n">col_name</span> <span class="o">=</span> <span class="s1">&#39;EUROPENVALUE_ID&#39;</span>
                        <span class="n">FundName</span> <span class="o">=</span> <span class="s2">&quot;BANOR SICAV EUROPEAN VALUE&quot;</span>
                        <span class="n">Fund</span> <span class="o">=</span> <span class="s2">&quot;BANOR SICAV EUROPEAN VALUE&quot;</span>
                        <span class="n">FundNameShort</span> <span class="o">=</span> <span class="s2">&quot;European Value&quot;</span>
                    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                        <span class="n">database_name</span> <span class="o">=</span> <span class="s1">&#39;OSUSR_BOL_CHIRON&#39;</span>
                        <span class="n">col_name</span> <span class="o">=</span> <span class="s1">&#39;CHIRON_ID&#39;</span>
                        <span class="n">To</span> <span class="o">=</span> <span class="n">ToTomNick</span>
                        <span class="n">FundName</span> <span class="o">=</span> <span class="s2">&quot;ARISTEA SICAV CHIRON&quot;</span>
                        <span class="n">Fund</span> <span class="o">=</span> <span class="s2">&quot;ARISTEA SICAV CHIRON&quot;</span>
                        <span class="n">FundNameShort</span> <span class="o">=</span> <span class="s2">&quot;ARISTEA_CHIRON&quot;</span>
                    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">database_name</span> <span class="o">=</span> <span class="s1">&#39;OSUSR_BOL_EUROBOND&#39;</span>
                        <span class="n">To</span> <span class="o">=</span> <span class="n">BEB_emailList</span>
                        <span class="n">col_name</span> <span class="o">=</span> <span class="s1">&#39;EUROBOND_ID&#39;</span>
                        <span class="n">FundName</span> <span class="o">=</span> <span class="s2">&quot;BANOR SICAV EURO BOND&quot;</span>
                        <span class="n">Fund</span> <span class="o">=</span> <span class="s2">&quot;BANOR SICAV EURO BOND&quot;</span>
                        <span class="n">FundNameShort</span> <span class="o">=</span> <span class="s2">&quot;Euro Bond&quot;</span>
                    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                        <span class="n">database_name</span> <span class="o">=</span> <span class="s1">&#39;OSUSR_BOL_NEWFRONTIERS&#39;</span>
                        <span class="n">To</span> <span class="o">=</span> <span class="n">ToBanorCapital</span>
                        <span class="n">col_name</span> <span class="o">=</span> <span class="s1">&#39;NEWFRONTIERSID&#39;</span>
                        <span class="n">FundName</span> <span class="o">=</span> <span class="s2">&quot;ARISTEA SICAV NEW FRONTIERS&quot;</span>
                        <span class="n">Fund</span> <span class="o">=</span> <span class="s2">&quot;ARISTEA SICAV NEW FRONTIERS&quot;</span>
                        <span class="n">FundNameShort</span> <span class="o">=</span> <span class="s2">&quot;New Frontiers&quot;</span>
                    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                        <span class="n">database_name</span> <span class="o">=</span> <span class="s1">&#39;OSUSR_BOL_ROSEMARY&#39;</span>
                        <span class="n">To</span> <span class="o">=</span> <span class="n">ToKallisto</span>
                        <span class="n">col_name</span> <span class="o">=</span> <span class="s1">&#39;ROSEMARYID&#39;</span>
                        <span class="n">FundName</span> <span class="o">=</span> <span class="s2">&quot;BANOR SICAV ROSEMARY&quot;</span>
                        <span class="n">Fund</span> <span class="o">=</span> <span class="s2">&quot;BANOR SICAV ROSEMARY&quot;</span>
                        <span class="n">FundNameShort</span> <span class="o">=</span> <span class="s2">&quot;Rosemary&quot;</span>
                    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
                        <span class="n">database_name</span> <span class="o">=</span> <span class="s1">&#39;OSUSR_BOL_ASIANALPHA&#39;</span>
                        <span class="n">To</span> <span class="o">=</span> <span class="n">ToJamesMorton</span>
                        <span class="n">col_name</span> <span class="o">=</span> <span class="s1">&#39;ASIANALPHAID&#39;</span>
                        <span class="n">FundName</span> <span class="o">=</span> <span class="s2">&quot;ARISTEA SICAV ASIAN ALPHA&quot;</span>
                        <span class="n">Fund</span> <span class="o">=</span> <span class="s2">&quot;ASIAN ALPHA&quot;</span>
                        <span class="n">FundNameShort</span> <span class="o">=</span> <span class="s2">&quot;AsianAlpha&quot;</span>
                    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
                        <span class="n">database_name</span> <span class="o">=</span> <span class="s1">&#39;OSUSR_SKP_HIGHFOCUS&#39;</span>
                        <span class="n">To</span> <span class="o">=</span> <span class="n">ToBanorCapital</span>
                        <span class="n">col_name</span> <span class="o">=</span> <span class="s1">&#39;HIGHFOCUSID&#39;</span>
                        <span class="n">FundName</span> <span class="o">=</span> <span class="s2">&quot;BANOR A. A. S. HIGH FOCUS&quot;</span>
                        <span class="n">Fund</span> <span class="o">=</span> <span class="s2">&quot;BANOR A. A. S. HIGH FOCUS&quot;</span>
                        <span class="n">FundNameShort</span> <span class="o">=</span> <span class="s2">&quot;HighFocus&quot;</span>
                    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">13</span><span class="p">:</span>
                        <span class="n">database_name</span> <span class="o">=</span> <span class="s1">&#39;OSUSR_SKP_MEAOPPORTUNITIES&#39;</span>
                        <span class="n">To</span> <span class="o">=</span> <span class="n">ToBanorCapital</span>
                        <span class="n">col_name</span> <span class="o">=</span> <span class="s1">&#39;MEAOPPORTUNITIESID&#39;</span>
                        <span class="n">FundName</span> <span class="o">=</span> <span class="s2">&quot;ARISTEA SICAV M&amp;A OPPORTUNITIES&quot;</span>
                        <span class="n">Fund</span> <span class="o">=</span> <span class="s2">&quot;M&amp;A Opportunities&quot;</span>
                        <span class="n">FundNameShort</span> <span class="o">=</span> <span class="s2">&quot;M&amp;A Opportunities&quot;</span>
                    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">14</span><span class="p">:</span>
                        <span class="n">database_name</span> <span class="o">=</span> <span class="s1">&#39;OSUSR_SKP_LEVEURO&#39;</span>
                        <span class="n">To</span> <span class="o">=</span> <span class="n">ToBanorCapital</span>
                        <span class="n">col_name</span> <span class="o">=</span> <span class="s1">&#39;LEVEUROID&#39;</span>
                        <span class="n">FundName</span> <span class="o">=</span> <span class="s2">&quot;LevEuro&quot;</span>
                        <span class="n">Fund</span> <span class="o">=</span> <span class="s2">&quot;LevEuro&quot;</span>
                        <span class="n">FundNameShort</span> <span class="o">=</span> <span class="s2">&quot;LevEuro&quot;</span>
                    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">16</span><span class="p">:</span>
                        <span class="n">database_name</span> <span class="o">=</span> <span class="s1">&#39;OSUSR_SKP_ASIMOCCO&#39;</span>
                        <span class="n">To</span> <span class="o">=</span> <span class="n">ToBanorCapital</span>
                        <span class="n">col_name</span> <span class="o">=</span> <span class="s1">&#39;ASIMOCCOID&#39;</span>
                        <span class="n">FundName</span> <span class="o">=</span> <span class="s2">&quot;Assimoco&quot;</span>
                        <span class="n">Fund</span> <span class="o">=</span> <span class="s2">&quot;Assimoco&quot;</span>
                        <span class="n">FundNameShort</span> <span class="o">=</span> <span class="s2">&quot;Assimoco&quot;</span>
                    <span class="k">elif</span> <span class="n">FundNumber</span> <span class="o">==</span> <span class="mi">18</span><span class="p">:</span>
                        <span class="n">database_name</span> <span class="o">=</span> <span class="s1">&#39;OSUSR_SKP_RAFFAELLO&#39;</span>
                        <span class="n">To</span> <span class="o">=</span> <span class="n">ToBanorCapital</span>
                        <span class="n">col_name</span> <span class="o">=</span> <span class="s1">&#39;RAFFAELLO&#39;</span>
                        <span class="n">FundName</span> <span class="o">=</span> <span class="s2">&quot;Raffaello&quot;</span>
                        <span class="n">Fund</span> <span class="o">=</span> <span class="s2">&quot;Raffaello&quot;</span>
                        <span class="n">FundNameShort</span> <span class="o">=</span> <span class="s2">&quot;Raffaello&quot;</span>

                    <span class="c1"># perform operation for region</span>
                    <span class="n">qepCurrdate</span> <span class="o">=</span> <span class="n">get_current_date</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">ForcingTtype</span><span class="p">:</span>
                        <span class="n">xSystemMessageAutoGenerated</span> <span class="o">=</span> <span class="s2">&quot;New Instr Type for a name that we already hold.&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">LineID</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">query1</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SELECT * FROM [outsys_prod_qa].DBO.&quot;</span> <span class="o">+</span> <span class="n">database_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
                                                                                              <span class="s2">&quot;WHERE ([DATE] = (convert(datetime, substring(&quot;</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                <span class="n">qepCurrdate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;, 1, 10), 120))) AND&quot;</span>
                                                     <span class="s2">&quot; ([TICKER_ISIN] = &quot;</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                <span class="n">Ticker_ISIN</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;) ORDER BY [NAME] ASC &quot;</span><span class="p">)</span>
                            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query1</span><span class="p">)</span>
                            <span class="n">GetAllRecords</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">GetAllRecords</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">OrderStage</span> <span class="o">=</span> <span class="s2">&quot;Pending with error!&quot;</span>
                                <span class="n">subject</span> <span class="o">=</span> <span class="s2">&quot;The last trade is using a name that is contained two times in the portfolio!&quot;</span>
                                <span class="n">Title</span> <span class="o">=</span> <span class="kc">None</span>
                                <span class="c1"># Email_Send_ErrorAlarm(subject, Title)</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">GetAllRecords</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">GetAllRecords</span><span class="p">):</span>
                                    <span class="n">LineID</span> <span class="o">=</span> <span class="n">GetAllRecords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">LineID</span><span class="p">:</span>
                                <span class="n">xSystemMessageAutoGenerated</span> <span class="o">=</span> <span class="s2">&quot;New position&quot;</span>
                            <span class="k">if</span> <span class="n">Pair</span><span class="p">:</span>
                                <span class="n">xSystemMessageAutoGenerated</span> <span class="o">=</span> <span class="s2">&quot;PairTrade has been changed&quot;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">xSystemMessageAutoGenerated</span> <span class="o">=</span> <span class="s2">&quot;Changed weight in a existing position&quot;</span>
                            <span class="k">if</span> <span class="n">LineID</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">LineID</span> <span class="o">=</span> <span class="s2">&quot;NULL&quot;</span>

                            <span class="n">QuantityToAvoidShortSelling</span> <span class="o">=</span> <span class="n">MultiplierQuantity</span>

                            <span class="n">WeightTarget_para</span> <span class="o">=</span> <span class="n">WeightTarget</span> <span class="o">/</span> <span class="mi">100</span>
                            <span class="k">if</span> <span class="n">WeightTarget</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">&gt;</span> <span class="n">WeightActual</span> <span class="ow">and</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;SW&quot;</span> <span class="ow">and</span> <span class="n">WeightTarget</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">BuySellCoverShort</span> <span class="o">=</span> <span class="s2">&quot;BCOV&quot;</span>
                                <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot;limit: 1</span><span class="si">% a</span><span class="s2">bove latest availalbe price&quot;</span>
                                <span class="k">if</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;Urgent&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot; 20</span><span class="si">% o</span><span class="s2">f Vol, Limit 1% ABOVE latest available price&quot;</span>
                                    <span class="n">Limit</span> <span class="o">=</span> <span class="n">bbg_Px_Last</span> <span class="o">*</span> <span class="mf">1.01</span>
                                <span class="k">elif</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;High&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot; 30</span><span class="si">% o</span><span class="s2">f Vol, Limit 5% ABOVE latest available price&quot;</span>
                                    <span class="n">Limit</span> <span class="o">=</span> <span class="n">bbg_Px_Last</span> <span class="o">*</span> <span class="mf">1.05</span>
                                <span class="k">elif</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;Normal&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot;start with 50</span><span class="si">% o</span><span class="s2">f Vol, NO limit, get it done today!&quot;</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">WeightActual</span> <span class="o">=</span> <span class="n">WeightActual</span>

                            <span class="k">elif</span> <span class="n">WeightTarget</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">&lt;</span> <span class="n">WeightActual</span> <span class="ow">and</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;SW&quot;</span> <span class="ow">and</span> <span class="n">WeightTarget</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">BuySellCoverShort</span> <span class="o">=</span> <span class="s2">&quot;SSELL&quot;</span>
                                <span class="k">if</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;Urgent&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot; 20</span><span class="si">% o</span><span class="s2">f Vol, Limit 1% BELOW latest available price&quot;</span>
                                    <span class="n">Limit</span> <span class="o">=</span> <span class="n">bbg_Px_Last</span> <span class="o">*</span> <span class="mf">0.99</span>
                                <span class="k">elif</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;High&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot; 30</span><span class="si">% o</span><span class="s2">f Vol, Limit 5% BELOW latest available price&quot;</span>
                                    <span class="n">Limit</span> <span class="o">=</span> <span class="n">bbg_Px_Last</span> <span class="o">*</span> <span class="mf">0.95</span>
                                <span class="k">elif</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;Normal&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot;start with 50</span><span class="si">% o</span><span class="s2">f Vol, NO limit, get it done today!&quot;</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">WeightActual</span> <span class="o">=</span> <span class="n">WeightActual</span>

                            <span class="k">elif</span> <span class="n">WeightTarget</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">&gt;</span> <span class="n">WeightActual</span> <span class="ow">and</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span>
                                <span class="n">BuySellCoverShort</span> <span class="o">=</span> <span class="s2">&quot;SELL&quot;</span>
                                <span class="k">if</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;Urgent&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot; 20</span><span class="si">% o</span><span class="s2">f Vol, Limit 1% BELOW latest available price&quot;</span>
                                    <span class="n">Limit</span> <span class="o">=</span> <span class="n">bbg_Px_Last</span> <span class="o">*</span> <span class="mf">0.99</span>
                                <span class="k">elif</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;High&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot; 30</span><span class="si">% o</span><span class="s2">f Vol, Limit 5% BELOW  latest available price&quot;</span>
                                    <span class="n">Limit</span> <span class="o">=</span> <span class="n">bbg_Px_Last</span> <span class="o">*</span> <span class="mf">0.95</span>
                                <span class="k">elif</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;Normal&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot;start with 50</span><span class="si">% o</span><span class="s2">f Vol, NO limit, get it done today!&quot;</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">WeightActual</span> <span class="o">=</span> <span class="n">WeightActual</span>

                            <span class="k">elif</span> <span class="n">WeightTarget</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">&lt;</span> <span class="n">WeightActual</span> <span class="ow">and</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span>
                                <span class="n">BuySellCoverShort</span> <span class="o">=</span> <span class="s2">&quot;SELL&quot;</span>
                                <span class="k">if</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;Urgent&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot;20</span><span class="si">% o</span><span class="s2">f Vol, Limit 1% BELOW latest available price&quot;</span>
                                    <span class="n">Limit</span> <span class="o">=</span> <span class="n">bbg_Px_Last</span> <span class="o">*</span> <span class="mf">0.99</span>
                                <span class="k">elif</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;High&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot;30</span><span class="si">% o</span><span class="s2">f Vol, Limit 5% BELOW  latest available price&quot;</span>
                                    <span class="n">Limit</span> <span class="o">=</span> <span class="n">bbg_Px_Last</span> <span class="o">*</span> <span class="mf">0.95</span>
                                <span class="k">elif</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;Normal&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot;start with 50</span><span class="si">% o</span><span class="s2">f Vol, NO limit, get it done today!&quot;</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">WeightActual</span> <span class="o">=</span> <span class="n">WeightActual</span>

                            <span class="k">elif</span> <span class="n">WeightTarget</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">WeightActual</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;SW&quot;</span><span class="p">:</span>

                                <span class="n">BuySellCoverShort</span> <span class="o">=</span> <span class="s2">&quot;SSELL&quot;</span>
                                <span class="k">if</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;Urgent&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot; 20</span><span class="si">% o</span><span class="s2">f Vol, Limit 1% BELOW latest available price&quot;</span>
                                    <span class="n">Limit</span> <span class="o">=</span> <span class="n">bbg_Px_Last</span> <span class="o">*</span> <span class="mf">0.99</span>
                                <span class="k">elif</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;High&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot; 30</span><span class="si">% o</span><span class="s2">f Vol, Limit 5% BELOW latest available price&quot;</span>
                                    <span class="n">Limit</span> <span class="o">=</span> <span class="n">bbg_Px_Last</span> <span class="o">*</span> <span class="mf">0.95</span>
                                <span class="k">elif</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;Normal&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot;start with 50</span><span class="si">% o</span><span class="s2">f Vol, NO limit, get it done today!&quot;</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">WeightActual</span> <span class="o">=</span> <span class="n">WeightActual</span>

                            <span class="k">elif</span> <span class="n">WeightTarget</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">WeightActual</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">BuySellCoverShort</span> <span class="o">=</span> <span class="s2">&quot;BUY&quot;</span>
                                <span class="k">if</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;Urgent&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot; 20</span><span class="si">% o</span><span class="s2">f Vol, Limit 1% BELOW latest available price&quot;</span>
                                    <span class="n">Limit</span> <span class="o">=</span> <span class="n">bbg_Px_Last</span> <span class="o">*</span> <span class="mf">1.01</span>
                                <span class="k">elif</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;High&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot; 30</span><span class="si">% o</span><span class="s2">f Vol, Limit 5% ABOVE latest available price&quot;</span>
                                    <span class="n">Limit</span> <span class="o">=</span> <span class="n">bbg_Px_Last</span> <span class="o">*</span> <span class="mf">1.05</span>
                                <span class="k">elif</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;Normal&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot;start with 50</span><span class="si">% o</span><span class="s2">f Vol, NO limit, get it done today!&quot;</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">WeightActual</span> <span class="o">=</span> <span class="n">WeightActual</span>

                            <span class="k">elif</span> <span class="n">WeightTarget</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">&gt;</span> <span class="n">WeightActual</span> <span class="ow">and</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;SW&quot;</span> <span class="ow">and</span> <span class="n">WeightTarget</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">BuySellCoverShort</span> <span class="o">=</span> <span class="s2">&quot;BUY&quot;</span>
                                <span class="k">if</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;Urgent&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot;25</span><span class="si">% o</span><span class="s2">f Vol, Limit 1% ABOVE latest available price&quot;</span>
                                    <span class="n">Limit</span> <span class="o">=</span> <span class="n">bbg_Px_Last</span> <span class="o">*</span> <span class="mf">1.05</span>
                                <span class="k">elif</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;High&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot;30</span><span class="si">% o</span><span class="s2">f Vol, Limit 5% ABOVE  latest available price&quot;</span>
                                    <span class="n">Limit</span> <span class="o">=</span> <span class="n">bbg_Px_Last</span> <span class="o">*</span> <span class="mf">1.05</span>
                                <span class="k">elif</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;Normal&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot;start with 50</span><span class="si">% o</span><span class="s2">f Vol, NO limit, get it done today!&quot;</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">WeightActual</span> <span class="o">=</span> <span class="n">WeightActual</span>

                            <span class="k">elif</span> <span class="n">WeightTarget</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">&lt;</span> <span class="n">WeightActual</span> <span class="ow">and</span> <span class="n">InstrumentType_1stCol</span> <span class="o">==</span> <span class="s2">&quot;SW&quot;</span> <span class="ow">and</span> <span class="n">WeightTarget</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">BuySellCoverShort</span> <span class="o">=</span> <span class="s2">&quot;SELL&quot;</span>
                                <span class="k">if</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;Urgent&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot; 25</span><span class="si">% o</span><span class="s2">f Vol, Limit 1% BELOW latest available price&quot;</span>
                                    <span class="n">Limit</span> <span class="o">=</span> <span class="n">bbg_Px_Last</span> <span class="o">*</span> <span class="mf">0.99</span>
                                <span class="k">elif</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;High&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot;30</span><span class="si">% o</span><span class="s2">f Vol, Limit 5% ABOVE  latest available price&quot;</span>
                                    <span class="n">Limit</span> <span class="o">=</span> <span class="n">bbg_Px_Last</span> <span class="o">*</span> <span class="mf">1.05</span>
                                <span class="k">elif</span> <span class="n">gUrgency</span> <span class="o">==</span> <span class="s2">&quot;Normal&quot;</span><span class="p">:</span>
                                    <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot;start with 50</span><span class="si">% o</span><span class="s2">f Vol, NO limit, get it done today!&quot;</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">WeightActual</span> <span class="o">=</span> <span class="n">WeightActual</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">WeightActual</span> <span class="o">=</span> <span class="n">WeightActual</span>
                                <span class="n">SuggestionPreciseInstruction</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                                <span class="n">BuySellCoverShort</span> <span class="o">=</span> <span class="n">side</span>

                            <span class="c1"># checking for record present or not</span>
                            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                                <span class="s2">&quot;SELECT  * FROM [outsys_prod_qa].DBO.&quot;</span> <span class="o">+</span> <span class="n">database_name</span> <span class="o">+</span> <span class="s2">&quot;  WHERE ([TICKER_ISIN] = &#39;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">TickerISIN</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&#39; And [DATE]= &#39;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">qepCurrdate</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&#39; ) ORDER BY [NAME] ASC &quot;</span><span class="p">)</span>

                            <span class="n">ChkRecords</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                            <span class="k">if</span> <span class="n">ChkRecords</span><span class="p">:</span>
                                <span class="n">LineID</span> <span class="o">=</span> <span class="n">ChkRecords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                                <span class="n">Update_query</span> <span class="o">=</span> <span class="p">(</span>
                                        <span class="s2">&quot;UPDATE [outsys_prod_qa].DBO.&quot;</span> <span class="o">+</span> <span class="n">database_name</span> <span class="o">+</span> <span class="s2">&quot; SET  [DATE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">qepCurrdate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [INSTRTYPE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">InstrumentType_1stCol</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [TICKER_ISIN] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">TickerISIN</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,	[NAME] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">sStockName</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,	[WEIGHT_ACTUAL] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">WeightActual</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,	[WEIGHT_TARGET]=&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">WeightTarget_para</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,	[PAIRTRADE]= &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">xPairTrade</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [SECURITYTYPE]=&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">ProductType_2ndCol</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;, [Quantity]=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">TradeQuantityPreciseIndicated</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,[DB_LASTPRICE]=&#39;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">lastPrice</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&#39;,[Currency]=&#39;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">bbgCrncy</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&#39;	 WHERE [ID] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">LineID</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
                                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">Update_query</span><span class="p">)</span>
                                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                                <span class="n">logger_sqlalchemy</span> <span class="o">=</span> <span class="n">logg_Handler</span><span class="p">(</span><span class="n">fund</span><span class="p">,</span>
                                                                 <span class="n">logger_name</span><span class="o">=</span><span class="s2">&quot;Update_query for different funds&quot;</span><span class="p">)</span>
                                <span class="n">logger_sqlalchemy</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Database&quot;</span> <span class="o">+</span> <span class="n">database_name</span> <span class="o">+</span> <span class="s2">&quot; entry updated&quot;</span><span class="p">)</span>

                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">Insert_query</span> <span class="o">=</span> <span class="p">(</span>
                                        <span class="s2">&quot;INSERT INTO [outsys_prod_qa].DBO.&quot;</span> <span class="o">+</span> <span class="n">database_name</span> <span class="o">+</span> <span class="s2">&quot; ([DATE],[INSTRTYPE],[TICKER_ISIN],[NAME],[WEIGHT_ACTUAL],[WEIGHT_TARGET],[PAIRTRADE],[SECURITYTYPE],[Quantity],[ORDERSTAGE],[DB_LASTPRICE],[Currency]) VALUES &quot;</span>
                                                                                              <span class="s2">&quot;(&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">qepCurrdate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">InstrumentType_1stCol</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&quot;</span>
                                                                                        <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">TickerISIN</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sStockName</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">WeightActual</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">WeightTarget_para</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">xPairTrade</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">ProductType_2ndCol</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">TradeQuantityPreciseIndicated</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                    <span class="n">OrderStage</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">lastPrice</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">bbgCrncy</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&#39;) &quot;</span><span class="p">)</span>
                                <span class="nb">print</span><span class="p">(</span><span class="n">Insert_query</span><span class="p">)</span>
                                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">Insert_query</span><span class="p">)</span>
                                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                                <span class="n">new_id</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">lastrowid</span>
                                <span class="n">logger_sqlalchemy</span> <span class="o">=</span> <span class="n">logg_Handler</span><span class="p">(</span><span class="n">fund</span><span class="p">,</span><span class="n">logger_name</span><span class="o">=</span><span class="s2">&quot;Insert query for different funds&quot;</span><span class="p">)</span>
                                <span class="n">logger_sqlalchemy</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                                    <span class="s2">&quot;Database&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">database_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; new entry added with &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                        <span class="n">new_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; as id.&quot;</span><span class="p">)</span>
                                <span class="c1"># new_id = 428800</span>

                            <span class="k">if</span> <span class="n">LineID</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">LineID</span> <span class="o">==</span> <span class="s2">&quot;NULL&quot;</span> <span class="ow">or</span> <span class="n">LineID</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                                <span class="n">LineID</span> <span class="o">=</span> <span class="n">new_id</span>

                            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="s2">&quot;SELECT [ENORDERS].[ID] o0, [ENORDERS].[DATE] o1, [ENORDERS].[SIDE] o2, [ENORDERS].[PRODUCTTYPE] o3, [ENORDERS].[PRODUCTID] o4, [ENORDERS].[SETTLECCY] o5, [ENORDERS].[SETTLEDATE] o6, [ENORDERS].[ORDERTYPE] o7, [ENORDERS].[LIMIT] o8, [ENORDERS].[BROKER] o9, [ENORDERS].[EXPIRY] o10, [ENORDERS].[EXPIRYDATE] o11, [ENORDERS].[ROUTING] o12, [ENORDERS].[OPERATOR] o13, [ENORDERS].[FUNDCODE] o14, [ENORDERS].[FUND] o15, [ENORDERS].[CUSTODIAN] o16, [ENORDERS].[ACCOUNT] o17, [ENORDERS].[STRATEGY] o18, [ENORDERS].[BOOK] o19, [ENORDERS].[ORDERQTYTYPE] o20, [ENORDERS].[ORDERQTYVALUE] o21, [ENORDERS].[ORDERQTYVALUELONGLEG] o22, [ENORDERS].[USERCOMMENT] o23, [ENORDERS].[LIMITONVOLUME] o24, [ENORDERS].[CREATIONTIME] o25, [ENORDERS].[INVESTMENTMANAGER] o26, [ENORDERS].[APPROVED] o27, [ENORDERS].[APPROVALTIME] o28, [ENORDERS].[TRADER] o29, [ENORDERS].[SENTTOTRADINGDESKTIME] o30, [ENORDERS].[NATUREOFTHEORDER] o31, [ENORDERS].[COUNTERVALUE] o32, [ENORDERS].[SUGGESTEDBROKER] o33, [ENORDERS].[TICKERISIN] o34, [ENORDERS].[CHANGINGMODIFICATIONTIME] o35, [ENORDERS].[ACTUALWEIGHT] o36, [ENORDERS].[NEWTARGETWEIGHT] o37, [ENORDERS].[INSTRUCTIONS] o38, [ENORDERS].[FUNDNAME] o39, [ENORDERS].[TRADINGDESKCONFIRMATION] o40, [ENORDERS].[TRADINGDESKRECEPTIONTIME] o41, [ENORDERS].[BNRPRODUCTTYPE] o42, [ENORDERS].[BNRBROKER] o43, [ENORDERS].[BNRORDERPRECISEQUANTITY] o44, [ENORDERS].[FUNDNAMESHORT] o45, [ENORDERS].[STOCKNAME] o46, [ENORDERS].[INTRUMENTTYPE] o47, [ENORDERS].[TRANSACTIONTYPE] o48, [ENORDERS].[ORDERSTAGE] o49, [ENORDERS].[EXECUTIONPRICE] o50, [ENORDERS].[EXECUTIONPRICENET] o51, [ENORDERS].[ADVISOR] o52, [ENORDERS].[EUROPENVALUE_ID] o53, [ENORDERS].[BROKERID_CONTACTTAB] o54, [ENORDERS].[ITALYLS_ID] o55, [ENORDERS].[GREATERCHINALS_ID] o56, [ENORDERS].[NORTHAMERICALS_ID] o57, [ENORDERS].[EUROBOND_ID] o58, [ENORDERS].[CURRENCY_ID] o59, [ENORDERS].[EQUITY_ID] o60, [ENORDERS].[BOND_ID] o61, [ENORDERS].[DERIVATIVE_ID] o62, [ENORDERS].[CHIRON_ID] o63, [ENORDERS].[NEWFRONTIERSID] o64, [ENORDERS].[ROSEMARYID] o65, [ENORDERS].[GLOBALFLEXIBLEID] o66, [ENORDERS].[ASIANALPHAID] o67, [ENORDERS].[MEAOPPORTUNITIESID] o68, [ENORDERS].[HIGHFOCUSID] o69, [ENORDERS].[FUNDSID] o70, [ENORDERS].[ORDERSUPDATING] o71, [ENORDERS].[USERID] o72, [ENORDERS].[LEVEUROID] o73, [ENORDERS].[ASSIMOCOID] o74, [ENORDERS].[RAFFAELLO] o75, [ENORDERS].[CASA4FUND_FUNDNAME] o76, [ENORDERS].[CURRENCY] o77, [ENORDERS].[CASA4FUNDSECURITYTYPE] o78, [ENORDERS].[EXECUTEDQUANTITY] o79, [ENORDERS].[PENDINGQUANTITY] o80, [ENORDERS].[ORDERFROMDAYBEFORE] o81, [ENORDERS].[REBALANCE] o82, [ENORDERS].[ISFROMYESTERDAY] o83, [ENORDERS].[LAST_PRICE] o84, [ENORDERS].[C4F_BROKERCODE] o85, [ENORDERS].[FUNDNAV] o86, [ENORDERS].[FUNDCURRENCY] o87, [ENORDERS].[STOCKCURRENCY] o88, [ENORDERS].[SETTLEMENTCURRENCY] o89, [ENORDERS].[URGENCY] o90, [ENORDERS].[COUNTERVALUEINFUNDCRNCY] o91, [ENORDERS].[FX_FUNDCRNCYVSFUNDCRNCY] o92, [ENORDERS].[COUNTERVALUEINLOCALCRNCY] o93, [ENORDERS].[TRADEQUANTITYCALCULATED] o94, [ENORDERS].[TRADEQUANTITYCALCULATEDROUND] o95, [ENORDERS].[BBGSECURITYNAME] o96, [ENORDERS].[BBGEXCHANGE] o97, [ENORDERS].[ORDERCLOSE] o98, [ENORDERS].[PRECISEINSTRUCTIONS] o99, [ENORDERS].[ISIN] o100, [ENORDERS].[COUNTRY] o101, [ENORDERS].[ORDERSTAGEOWL] o102, [ENORDERS].[APICORRELATIONID] o103, [ENORDERS].[APIORDERREFID] o104, [ENORDERS].[SETTLEMENTDATE] o105, [ENORDERS].[BBGMESS1] o106, [ENORDERS].[BBGSETTLEDATE] o107, [ENORDERS].[BBGEMSXSTATUS] o108, [ENORDERS].[BBGEMSXSEQUENCE] o109, [ENORDERS].[BBGEMSXROUTEID] o110, [ENORDERS].[BBGCOUNTRYISO] o111, [ENORDERS].[BROKERBPS] o112, [ENORDERS].[BROKERCENTPERSHARE] o113, [ENORDERS].[TRADINGCOMMISSIONSBPS] o114, [ENORDERS].[TRADINGCOMMISSIONSCENT] o115, [ENORDERS].[BBG_OPTCONTSIZE] o116, [ENORDERS].[BBG_FUTCONTSIZE] o117, [ENORDERS].[BBG_IDPARENTCO] o118, [ENORDERS].[BBG_LOTSIZE] o119, [ENORDERS].[BBG_MARKETOPENINGTIME] o120, [ENORDERS].[BBG_MARKETCLOSINGTIME] o121, [ENORDERS].[BBG_PRICEINVALID] o122, [ENORDERS].[BBG_OPT_UNDL_PX] o123, [ENORDERS].[EXPOSURECALCULATIONMETHOD] o124, [ENORDERS].[POTENTIALERROR] o125, [ENORDERS].[RMSTATUS] o126, [ENORDERS].[ACTUALQUANTITY] o127, [ENORDERS].[RM1] o128, [ENORDERS].[RM2] o129, [ENORDERS].[RM3] o130, [ENORDERS].[RM4] o131, [ENORDERS].[RM5] o132, [ENORDERS].[RM6] o133, [ENORDERS].[RM7] o134, [ENORDERS].[RM8] o135, [ENORDERS].[RM9] o136, [ENORDERS].[RM10] o137, [ENORDERS].[BBG_PARENTCOID] o138, [ENORDERS].[BBG_PARENTCONAME] o139, [ENORDERS].[TRADERNOTES] o140, [ENORDERS].[PORTFOLIOUPDATED] o141, [ENORDERS].[UPDALREADYADDED] o142, [ENORDERS].[UPDALREADYSUBTRACTED] o143, [ENORDERS].[BROKERSELMETHOD] o144, [ENORDERS].[BROKERSELREASON] o145, [ENORDERS].[EXECUTORFACTOR_COST] o146, [ENORDERS].[EXECUTORFACTOR_SPEED] o147, [ENORDERS].[EXECUTORFACTOR_LIKELIHOOD] o148, [ENORDERS].[EXECUTORFACTOR_SETTLEMENT] o149, [ENORDERS].[EXECUTORFACTOR_ORDERSIZE] o150, [ENORDERS].[EXECUTORFACTOR_NATURE] o151, [ENORDERS].[EXECUTORFACTOR_VENUE] o152, [ENORDERS].[EXECUTORFACTOR_CONSIDERATION] o153, [ENORDERS].[NEEDCOMMENT] o154, [ENORDERS].[FX_BASKETRUNID] o155, [ENORDERS].[FIX_CONF] o156, [ENORDERS].[FIX_CIORDID] o157, [ENORDERS].[FIX_EXECUTIONID] o158, [ENORDERS].[FIX_AVGPX] o159, [ENORDERS].[FIX_FAR_AVGPX] o160, [ENORDERS].[FIX_LASTQTY] o161, [ENORDERS].[FIX_FAR_LASTQTY] o162, [ENORDERS].[FIX_LEAVESQTY] o163, [ENORDERS].[OUTRIGHTORSWAP] o164, [ENORDERS].[CURRENCY_2] o165, [ENORDERS].[JPMORGANACCOUNT] o166, [ENORDERS].[BROKERCODEAUTO] o167, [ENORDERS].[EXPOSURETRADEID] o168, [ENORDERS].[BROKERHASBEENCHANGED] o169, [ENORDERS].[UBSACCOUNT] o170, [ENORDERS].[RISKMANAGEMENTRESULT] o171, [ENORDERS].[ARRIVALPRICE] o172, [ENORDERS].[ADV20D] o173, [ENORDERS].[MEAMULTIPLIER] o174, [ENORDERS].[LEVEUROSTATEGYID] o175, [ENORDERS].[ISREPO] o176, [ENORDERS].[REPOEPIRYDATE] o177, [ENORDERS].[REPO_CODEDOSSIER] o178, [ENORDERS].[REPO_VALEURTAUX] o179, [ENORDERS].[REPO_BICSENDER] o180, [ENORDERS].[REPO_CODECONTREPARTIE] o181, [ENORDERS].[REPO_COMPARTIMENT] o182, [ENORDERS].[REPO_EXPRESSIONQUANTITESJ] o183, [ENORDERS].[REPO_NOMTAUX] o184, [ENORDERS].[REPO_REFERENCEEXTERNE] o185, [ENORDERS].[REPO_BASECALCULINTERET] o186, [ENORDERS].[REPO_TERMDATE] o187, [ENORDERS].[REPO_HAIRCUT] o188, [ENORDERS].[REPO_INTEREST_RATE] o189, [ENORDERS].[LEVEUROSETTLEDATE] o190, [ENORDERS].[REPO_2RDLEG_PRICE] o191, [ENORDERS].[REPO_BROKERLOCALCUSTODIABIC] o192, [ENORDERS].[REPO_BROKERBENIFICIARYBIC] o193, [ENORDERS].[LEIREPORTINGCODE] o194, [ENORDERS].[BROKERCODE] o195, [ENORDERS].[MASTERAGREEMENT] o196, [ENORDERS].[MASTERAGREEMENTVERSION_DATE] o197, [ENORDERS].[REPO_SFTR] o198, [ENORDERS].[REPO_REAL] o199, [ENORDERS].[APPROVALDATETIMEMILLI] o200, [ENORDERS].[REPO_UTI] o201 &quot;</span>
                                    <span class="s2">&quot;FROM [outsys_prod_qa].DBO.[OSUSR_38P_ORDERS] [ENORDERS] WHERE ([ENORDERS].[DATE] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                <span class="n">qepCurrdate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;) AND ([ENORDERS].[FUNDCODE] = convert(varchar(11), &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                <span class="n">FundNumber</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;)) AND ([ENORDERS].[TICKERISIN] = &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                <span class="n">TickerISIN</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;) ORDER BY [ENORDERS].[SIDE] ASC &quot;</span><span class="p">)</span>
                            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
                            <span class="n">FundsIDs</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="n">getRecords</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">getRecords</span><span class="p">):</span>
                                <span class="n">FundsIDs</span> <span class="o">=</span> <span class="n">getRecords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">70</span><span class="p">]</span>

                            <span class="n">CounterValueFundCurrency</span><span class="p">,</span> <span class="n">CounterValueLocalCurrency</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">,</span> <span class="n">QuantityRounded</span><span class="p">,</span> \
                            <span class="n">BrokerCommisionsBPS</span><span class="p">,</span> <span class="n">BrokerBps</span><span class="p">,</span> <span class="n">BrokerCentPerShare</span><span class="p">,</span> <span class="n">BrokerCommisionsCENT</span><span class="p">,</span> <span class="n">PotentialError</span><span class="p">,</span> <span class="n">FX</span> \
                                <span class="o">=</span> <span class="n">Calculations</span><span class="p">(</span><span class="n">WeightTarget</span><span class="o">=</span><span class="n">WeightTarget</span><span class="p">,</span> <span class="n">WeightActual</span><span class="o">=</span><span class="n">WeightActual</span><span class="p">,</span>
                                               <span class="n">FundCurrency</span><span class="o">=</span><span class="n">FundCurrency</span><span class="p">,</span>
                                               <span class="n">StockCurrency</span><span class="o">=</span><span class="n">bbgCrncy</span><span class="p">,</span> <span class="n">ShowQuantityBox</span><span class="o">=</span><span class="n">ShowQuantityBox</span><span class="p">,</span>
                                               <span class="n">PreciseQuantityIndicated</span><span class="o">=</span><span class="n">TradeQuantityPreciseIndicated</span><span class="p">,</span>
                                               <span class="n">Bbg_Px_Last</span><span class="o">=</span><span class="n">bbg_Px_Last</span><span class="p">,</span>
                                               <span class="n">ProductType_2ndCol</span><span class="o">=</span><span class="n">ProductType_2ndCol</span><span class="p">,</span>
                                               <span class="n">NAV_or_PCvalue</span><span class="o">=</span><span class="n">NAV</span><span class="p">,</span>
                                               <span class="n">QuantityToAvoidShortSelling</span><span class="o">=</span><span class="n">QuantityToAvoidShortSelling</span><span class="p">,</span>
                                               <span class="n">bbgCountryISO</span><span class="o">=</span><span class="n">bbg_Country_Iso</span><span class="p">,</span> <span class="n">BrokeriD</span><span class="o">=</span><span class="n">BrokerID</span><span class="p">,</span>
                                               <span class="n">Exchange</span><span class="o">=</span><span class="n">bbg_Exchange</span><span class="p">,</span>
                                               <span class="n">bbgFutContSize</span><span class="o">=</span><span class="n">bbg_FutContSize</span><span class="p">,</span>
                                               <span class="n">bbgOptContSize</span><span class="o">=</span><span class="n">bbg_OptContSize</span><span class="p">,</span>
                                               <span class="n">ExposureCalculationMethod</span><span class="o">=</span><span class="n">ExposureCalculationMethod</span><span class="p">,</span>
                                               <span class="n">UnderlyingPrice</span><span class="o">=</span><span class="n">bbg_UnderlyingPrice</span><span class="p">,</span> <span class="n">MEA_Multiplier</span><span class="o">=</span><span class="n">Multiplier</span><span class="p">)</span>
                            <span class="n">TradeQuantityCalculated</span> <span class="o">=</span> <span class="n">Quantity</span>
                            <span class="n">CounterValueInLocal</span> <span class="o">=</span> <span class="n">CounterValueLocalCurrency</span>
                            <span class="n">TradeQuantityCalculatedRounded</span> <span class="o">=</span> <span class="n">QuantityRounded</span>
                            <span class="n">CounterValueFundCurrency</span> <span class="o">=</span> <span class="n">CounterValueFundCurrency</span>

                            <span class="n">TraderNote_s</span> <span class="o">=</span> <span class="n">TraderNotes</span><span class="p">(</span><span class="n">Ticker_ISIN</span><span class="o">=</span><span class="n">TickerISIN</span><span class="p">,</span> <span class="n">FundID</span><span class="o">=</span><span class="n">FundsIDs</span><span class="p">)</span>
                            <span class="n">calFx</span> <span class="o">=</span> <span class="n">FX</span>
                            <span class="n">TraderNote</span> <span class="o">=</span> <span class="n">TraderNote_s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">TraderNote_s</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

                            <span class="n">ctime</span> <span class="o">=</span> <span class="n">get_current_time</span><span class="p">()</span>

                            <span class="n">aCurrentDate</span> <span class="o">=</span> <span class="n">get_current_date</span><span class="p">()</span>
                            <span class="n">NewTargetWeight</span> <span class="o">=</span> <span class="n">WeightTarget</span> <span class="o">/</span> <span class="mi">100</span>
                            <span class="n">OrderType</span> <span class="o">=</span> <span class="s2">&quot;Limit&quot;</span> <span class="k">if</span> <span class="n">Limit</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;Market&quot;</span>
                            <span class="n">Username</span> <span class="o">=</span> <span class="n">userName</span>
                            <span class="n">OrderQtyValue</span> <span class="o">=</span> <span class="n">TradeQuantityCalculatedRounded</span> <span class="k">if</span> <span class="n">TradeQuantityPreciseIndicated</span> <span class="k">else</span> <span class="n">TradeQuantityPreciseIndicated</span>
                            <span class="c1"># ------------------------------------------ Create order query add here --------------------------</span>

                            <span class="n">CreateOrders</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="s2">&quot;INSERT INTO [outsys_prod_qa].DBO.[OSUSR_38P_ORDERS]([CreationTime],[TickerISIN],[FundCode],[ActualWeight],&quot;</span>
                                    <span class="s2">&quot;[NewTargetWeight],[Side],[Approved],[ProductType],[FundName],[Broker],[TradingDeskConfirmation],[bnrProductType],&quot;</span>
                                    <span class="s2">&quot;[ProductID],[Limit],[OrderType],[bnrBroker],[Expiry],[Routing],[Fund],[Custodian],[OrderQtyType],[UserComment],[Account],&quot;</span>
                                    <span class="s2">&quot;[Date],[FundNameShort],[StockName],[IntrumentType],[BrokerID_contactTAB],[SettleDate],&quot;</span>
                                    <span class="s2">&quot;[TransactionType],&quot;&quot;[&quot;</span> <span class="o">+</span> <span class="n">col_name</span> <span class="o">+</span> <span class="s2">&quot;]&quot;&quot;,[OrderStage],[BnrOrderPreciseQuantity],[Last_Price],[Currency],[FundCurrency],[Urgency],[Fx_FundCrncyVSfundCrncy],[PreciseInstructions],[ORDERQTYVALUE],[OPERATOR],[INSTRUCTIONS]) VALUES (&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                <span class="n">ctime</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">TickerISIN</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">FundCode</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                <span class="n">WeightActual</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">NewTargetWeight</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                <span class="n">BuySellCoverShort</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;Pending&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ArborProductType</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                <span class="n">FundName</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">out_BrokerShortCode</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                <span class="n">ProductType_2ndCol</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">TickerISIN</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                <span class="n">Limit</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">OrderType</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">out_BrokerName</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                <span class="n">expiry</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;Automated&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Fund</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Custodian</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                <span class="n">OrderQtyType</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Comment</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Account</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                <span class="n">aCurrentDate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">FundNameShort</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                <span class="n">InstrumentType_1stCol</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">out_BrokerID</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                <span class="n">settleDate</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">InstrumentType_1stCol</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                <span class="n">LineID</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;Pending&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">TradeQuantityPreciseIndicated</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                <span class="n">bbg_Px_Last</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bbgCrncy</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">FundCurrency</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                                <span class="n">gUrgency</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">calFx</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">SuggestionPreciseInstruction</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">user_given_quantity</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Username</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">instructions</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&#39;)&quot;</span><span class="p">)</span>
                            <span class="c1"># print(CreateOrders)</span>
                            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">CreateOrders</span><span class="p">)</span>
                            <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                            <span class="n">OrderID</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">lastrowid</span>
                            <span class="n">logger_sqlalchemy</span> <span class="o">=</span> <span class="n">logg_Handler</span><span class="p">(</span><span class="n">fund</span><span class="p">,</span> <span class="n">logger_name</span><span class="o">=</span><span class="s2">&quot;Insert data into orders table&quot;</span><span class="p">)</span>
                            <span class="n">logger_sqlalchemy</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                                <span class="s2">&quot;In order table new entry added with &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">OrderID</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; as id.&quot;</span><span class="p">)</span>
                            <span class="c1"># OrderID = 11110</span>
                            <span class="n">UserID</span> <span class="o">=</span> <span class="n">userId</span>
                            <span class="n">OSUSR_BOL_CONTROLTICKER_ISIN_ID</span> <span class="o">=</span> <span class="n">Order_Changes</span><span class="p">(</span><span class="n">OrderID</span><span class="p">,</span> <span class="n">UserID</span><span class="p">,</span> <span class="n">TimeCreation</span><span class="o">=</span><span class="n">ctime</span><span class="p">,</span>
                                                                            <span class="n">TickerISIN</span><span class="o">=</span><span class="n">TickerISIN</span><span class="p">,</span>
                                                                            <span class="n">LimitPriceChanges</span><span class="o">=</span><span class="n">Limit</span><span class="p">,</span>
                                                                            <span class="n">ExecutedQuantity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ChangeBroker</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                                            <span class="n">NewBrokerShortCode</span><span class="o">=</span><span class="n">BrokerShortCode</span><span class="p">)</span>
                            <span class="n">processid</span> <span class="o">=</span> <span class="n">OSUSR_BOL_CONTROLTICKER_ISIN_ID</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;processid--&gt;&quot;</span><span class="p">,</span><span class="n">processid</span><span class="p">)</span>
                            <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                            <span class="c1"># Email_Send_Advisory(IsLogContent=False, FundName=sFundName,</span>
                            <span class="c1">#                     BuySell=BuySellCoverShort, Ticker=TickerISIN,</span>
                            <span class="c1">#                     StockName=sStockName, To=To,</span>
                            <span class="c1">#                     PreviousWeight=WeightActual, NewWeight=WeightTarget,</span>
                            <span class="c1">#                     IntrumentType=InstrumentType_1stCol,</span>
                            <span class="c1">#                     Message=xSystemMessageAutoGenerated, Urgency=gUrgency,</span>
                            <span class="c1">#                     SuggestionGenerated=gDateTime, PairTrade=xPairTrade,</span>
                            <span class="c1">#                     QuantityIndicated=TradeQuantityPreciseIndicated,</span>
                            <span class="c1">#                     )</span>


        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">processid</span><span class="p">)</span></div>

<span class="c1"># Fund_Send(sStockName=&quot;APPLE INC&quot;,</span>
<span class="c1">#          bol_wrongTicker=False,</span>
<span class="c1">#          TickerISIN=&quot;AAPL US Equity&quot;,</span>
<span class="c1">#          BolUndefinedMethodDeriv=False,</span>
<span class="c1">#          Loading=False,</span>
<span class="c1">#          TradeQuantityPreciseIndicated=5, MultiplierQuantity=2,</span>
<span class="c1">#          NALineID=None, Pair=False, CHLineID=None, FundNumber=1,</span>
<span class="c1">#          ITLineID=None, EVLineID=None, NAV=None, EBLineID=None, ACLineID=None, NFLineID=None, ROLineID=None,</span>
<span class="c1">#          ASALLineID=None, HFLineID=None, MEALineID=None,</span>
<span class="c1">#          LEVeuroLineID=None, ASSLineID=None, isRepoLevEuro=False, RaffaID=None)</span>

<span class="c1"># Col_1_and_2_Using_Ticker_2(Ticker = 1 , Col_1_Ready = None)</span>

<span class="c1"># Col_1_and_2_Using_Weight_3(Ticker=&#39;PROLSSU LX EQUITY&#39;, Weight=0, CashORswap=&#39;SWAP&#39;,</span>
<span class="c1">#                            StockName=&#39;BANOR-NORTH AMER L/S EQ-SUSD&#39;, BbgSecurityTyp=None)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, shraddha joshi.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>